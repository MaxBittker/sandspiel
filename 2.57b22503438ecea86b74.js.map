{"version":3,"sources":["webpack:///./js/api.js","webpack:///./js/render.js","webpack:///./js/fps.js","webpack:///./js/components/menu.js","webpack:///./js/components/ui.js","webpack:///./js/paint.js","webpack:///./js/components/info.js","webpack:///./js/components/hypertext.js","webpack:///./js/components/signin.js","webpack:///./js/components/browse.js","webpack:///./js/components/admin.js","webpack:///./js/app.js","webpack:///./js/fluidShaders.js","webpack:///./js/fluid.js","webpack:///./js/index.js","webpack:///./crate/pkg/sandtable.js","webpack:///./js/glsl/sand.glsl","webpack:///./js/glsl/sandVertex.glsl","webpack:///./js/glsl/baseVertex.glsl","webpack:///./js/glsl/clear.glsl","webpack:///./js/glsl/display.glsl","webpack:///./js/glsl/splat.glsl","webpack:///./js/glsl/advectionManualFilter.glsl","webpack:///./js/glsl/advection.glsl","webpack:///./js/glsl/divergence.glsl","webpack:///./js/glsl/curl.glsl","webpack:///./js/glsl/vorticity.glsl","webpack:///./js/glsl/pressure.glsl","webpack:///./js/glsl/gradientSubtract.glsl","webpack:///./js/glsl/velocityOut.glsl"],"names":["window","firebase","apiKey","storageBucket","authDomain","projectId","appId","messagingSenderId","storage","functions","reglBuilder","require","fsh","vsh","startWebGL","_ref","canvas","universe","_ref$isSnapshot","isSnapshot","regl","attributes","preserveDrawingBuffer","width","height","cell_pointer","cells","Uint8Array","memory","buffer","dataTexture","texture","data","drawSand","frag","uniforms","t","_ref2","tick","resolution","_ref3","viewportWidth","viewportHeight","dpi","devicePixelRatio","vert","position","count","poll","fps","_class","_classCallCheck","this","document","getElementById","frames","lastFrameTimeStamp","performance","now","key","value","delta","push","length","shift","min","Infinity","max","sum","i","Math","mean","textContent","concat","round","Menu","close","children","react_default","a","createElement","className","react_router_dom","to","onClick","species","Species","pallette_data","Object","values","range","apply","_toConsumableArray","Universe","reset","forEach","id","paint","render","ctx","getContext","readPixels","RGBA","UNSIGNED_BYTE","colors","index","color","pallette","sizeMap","Index","props","_this","ui_classCallCheck","_getPrototypeOf","call","state","submissionMenuOpen","paused","submitting","size","dataURL","currentSubmission","selectedElement","Water","UI","_assertThisInitialized","location","pathname","setTimeout","pause","load","React","Component","prevProps","hash","setState","event","preventDefault","confirm","play","toDataURL","snapshot","context","imgData","createImageData","putImageData","cellData","_this2","_this$state","title","payload","image","fetch","_url","method","body","JSON","stringify","headers","Content-Type","then","res","json","response","console","log","error","_this3","replace","refFromURL","getDownloadURL","dlurl","blob","url","URL","createObjectURL","img","Image","src","onload","drawImage","getImageData","cellsData","flush_undos","push_undo","_this4","auth","currentUser","getIdToken","token","Authorization","_objectSpread","e","_this5","_this$state2","Fragment","togglePause","viewBox","points","upload","map","v","setSize","style","padding","cx","cy","r","pop_undo","fontSize","name","keys","n","setElement","elementID","selected","background","backgroundColor","ElementButton","incScore","score","menu","closeMenu","display","placeholder","onChange","target","disabled","submit","eventDistance","b","sqrt","pow","clientX","clientY","norm","mag","magnitude","scale","s","add","sub","painting","lastPaint","repeat","smoothPaint","clearInterval","setInterval","startEvent","d","addEventListener","cancelable","handleTouches","touches","Array","from","boundingRect","getBoundingClientRect","scaleX","ceil","scaleY","canvasLeft","left","canvasTop","top","x","floor","y","Info","href","HyperText","nodes","text","split","startsWith","search","slice","SignInScreen","isSignedIn","expanded","signInFlow","signInOptions","GoogleAuthProvider","PROVIDER_ID","GithubAuthProvider","provider","EmailAuthProvider","requireDisplayName","callbacks","signInSuccessWithAuthResult","unregisterAuthObserver","onAuthStateChanged","user","StyledFirebaseAuth_default","uiConfig","firebaseAuth","alignItems","borderRadius","photoURL","emailVerified","email","signOut","ago","timeago","Submissions","nextProps","_this$props","submissions","browseVotes","_this$props2","voteFromBrowse","report","submission","displayTime","Date","timestamp","toLocaleDateString","getTime","format","flexGrow","wordWrap","hypertext","Browse","browse_classCallCheck","browse_possibleConstructorReturn","browse_getPrototypeOf","loadSubmissions","param","browse_objectSpread","browse_defineProperty","signin","exact","onKeyDown","keyCode","history","browse_Submissions","withRouter","judge","reports","AdminBrowse","admin_classCallCheck","admin_possibleConstructorReturn","admin_getPrototypeOf","decidedIds","admin_objectSpread","admin_defineProperty","ruling","admin_toConsumableArray","signInWithRedirect","filter","includes","admin_Submissions","BrowseRouter","match","browse","AdminRouter","admin","SigninRouter","ReactDOM","react_router","path","component","info","baseVertex","clearShaderString","displayShaderString","splatShaderString","advectionManualFilteringShaderString","advectionShaderString","divergenceShaderString","curlShaderString","vorticityShaderString","pressureShaderString","gradientSubtractShaderString","velocityOutShaderString","check","sandCanvas","fluidColor","__webpack_require__","__webpack_exports__","js_canvas","js_width","js_height","js_universe","js_reset","safari","pushState","onpopstate","go","navigator","userAgent","vendor","opera","test","substr","onbeforeunload","serviceWorker","register","registration","registrationError","canvas2","ui","resize","screen_width","innerWidth","canvasStyle","uiStyle","adStyle","innerHeight","getElementsByClassName","fluid","gui","config","TEXTURE_DOWNSAMPLE","DENSITY_DISSIPATION","VELOCITY_DISSIPATION","PRESSURE_DISSIPATION","PRESSURE_ITERATIONS","CURL","SPLAT_RADIUS","pointers","splatStack","_getWebGLContext","halfFloat","supportLinearFiltering","params","alpha","depth","stencil","antialias","gl","isWebGL2","getExtension","clearColor","formatRGBA","formatRG","formatR","halfFloatTexType","HALF_FLOAT","HALF_FLOAT_OES","getSupportedFormat","RGBA16F","RG16F","RG","R16F","RED","ext","getWebGLContext","_compileShaders","compileShader","type","source","shader","createShader","shaderSource","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","baseVertexShader","VERTEX_SHADER","clearShader","FRAGMENT_SHADER","displayShader","splatShader","advectionManualFilteringShader","advectionShader","divergenceShader","curlShader","vorticityShader","pressureShader","gradientSubtractShader","velocityOutShader","compileShaders","internalFormat","createTexture","bindTexture","TEXTURE_2D","texParameteri","TEXTURE_MIN_FILTER","NEAREST","TEXTURE_MAG_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","texImage2D","fbo","createFramebuffer","bindFramebuffer","FRAMEBUFFER","framebufferTexture2D","COLOR_ATTACHMENT0","checkFramebufferStatus","FRAMEBUFFER_COMPLETE","supportRenderTextureFormat","pointerPrototype","dx","dy","down","moved","dat","Full","Half","Quarter","onFinishChange","initFramebuffers","step","fun","parseInt","random","texWidth","texHeight","density","velocity","velocityOut","burns","divergence","curl","pressure","GLProgram","vertexShader","fragmentShader","fluid_classCallCheck","program","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","uniformCount","ACTIVE_UNIFORMS","uniformName","getActiveUniform","getUniformLocation","useProgram","clearProgram","displayProgram","velocityOutProgram","splatProgram","advectionProgram","divergenceProgram","curlProgram","vorticityProgram","pressureProgram","gradientSubtractProgram","drawingBufferWidth","drawingBufferHeight","texType","rgba","rg","createDoubleFBO","LINEAR","createFBO","texId","w","h","activeTexture","TEXTURE0","viewport","clear","COLOR_BUFFER_BIT","fbo1","fbo2","read","write","swap","temp","blit","bindBuffer","ARRAY_BUFFER","createBuffer","bufferData","Float32Array","STATIC_DRAW","ELEMENT_ARRAY_BUFFER","Uint16Array","vertexAttribPointer","FLOAT","enableVertexAttribArray","destination","drawElements","TRIANGLES","UNSIGNED_SHORT","lastTime","winds","burnsData","splat","bind","texUnit","uniform1i","uTarget","uniform1f","aspectRatio","uniform2f","point","uniform3f","radius","targetTouches","pointer","identifier","changedTouches","j","update","dt","amount","multipleSplats","pressureTexId","uVelocity","uSource","texelSize","dissipation","uWind","uCurl","uTexture","uDivergence","uPressure","uCells","startFluid","renderLoop","animationId","requestAnimationFrame","u","adsbygoogle","cachedTextDecoder","TextDecoder","cachegetUint8Memory","getStringFromWasm","ptr","len","decode","wasm","subarray","what","freeze","Empty","Wall","Sand","Stone","Ice","Gas","Cloner","Mite","Wood","Plant","Fungus","Seed","Fire","Lava","Acid","Dust","Oil","Rocket","_createClass","obj","create","prototype","ret","__wrap","__wbg_random_09364f2d8647f133","Error","__wbindgen_throw","arg0","arg1","module","exports"],"mappings":"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","file":"2.57b22503438ecea86b74.js","sourcesContent":["// Firebase App (the core Firebase SDK) is always required and must be listed first\nimport * as firebase from \"firebase/app\";\n\n// Add the Firebase products that you want to use\nimport \"firebase/auth\";\nimport \"firebase/storage\";\nimport \"firebase/functions\";\n\nwindow.firebase = firebase;\n\nfirebase.initializeApp({\n  apiKey: \"AIzaSyD2APPEyxCi9vB2olvUgzSsbgH1Pyz-as0\",\n  storageBucket: \"sandtable-8d0f7.appspot.com\",\n  authDomain: \"sandspiel.club\",\n  projectId: \"sandtable-8d0f7\",\n  appId: \"1:239719651525:web:80d3674408670521\",\n  messagingSenderId: \"239719651525\"\n});\n\nconst storage = firebase.storage();\nconst functions = firebase.functions();\n\nexport { functions, storage };\n","const reglBuilder = require(\"regl\");\nimport { memory } from \"../crate/pkg/sandtable_bg\";\nimport { Species } from \"../crate/pkg/sandtable\";\nimport { Universe } from \"../crate/pkg\";\n\nlet fsh = require(\"./glsl/sand.glsl\");\nlet vsh = require(\"./glsl/sandVertex.glsl\");\n\nlet startWebGL = ({ canvas, universe, isSnapshot = false }) => {\n  const regl = reglBuilder({\n    canvas,\n    attributes: { preserveDrawingBuffer: isSnapshot }\n  });\n  // const lastFrame = regl.texture();\n  const width = universe.width();\n  const height = universe.height();\n  let cell_pointer = universe.cells();\n  let cells = new Uint8Array(memory.buffer, cell_pointer, width * height * 4);\n  const dataTexture = regl.texture({ width, height, data: cells });\n\n  let drawSand = regl({\n    frag: fsh,\n    uniforms: {\n      t: ({ tick }) => tick,\n      data: () => {\n        // if (cell_pointer != universe.cells()) {\n        //   console.log(cell_pointer);\n        // }\n        cell_pointer = universe.cells();\n        cells = new Uint8Array(memory.buffer, cell_pointer, width * height * 4);\n        // }\n\n        return dataTexture({ width, height, data: cells });\n      },\n      resolution: ({ viewportWidth, viewportHeight }) => [\n        viewportWidth,\n        viewportHeight\n      ],\n      dpi: window.devicePixelRatio * 2,\n      isSnapshot\n      // backBuffer: lastFrame\n    },\n\n    vert: vsh,\n    attributes: {\n      // Full screen triangle\n      position: [[-1, 4], [-1, -1], [4, -1]]\n    },\n    // Our triangle has 3 vertices\n    count: 3\n  });\n\n  return () => {\n    regl.poll();\n    drawSand();\n  };\n};\n\nlet snapshot = universe => {\n  let canvas = document.createElement(\"canvas\");\n  canvas.width = universe.width() / 2;\n  canvas.height = universe.height() / 2;\n  let render = startWebGL({ universe, canvas, isSnapshot: true });\n  render();\n\n  return canvas.toDataURL(\"image/png\");\n};\n\nlet pallette = () => {\n  let canvas = document.createElement(\"canvas\");\n\n  let species = Object.values(Species);\n  let range = Math.max(...species) + 1;\n  let universe = Universe.new(range, 1);\n  canvas.width = range;\n  canvas.height = 3;\n  universe.reset();\n\n  species.forEach(id => universe.paint(id, 0, 2, id));\n\n  let render = startWebGL({ universe, canvas, isSnapshot: true });\n  render();\n  let ctx = canvas.getContext(\"webgl\");\n  let data = new Uint8Array(range * 4);\n  ctx.readPixels(0, 0, range, 1, ctx.RGBA, ctx.UNSIGNED_BYTE, data);\n  let colors = {};\n  species.forEach(id => {\n    let index = id * 4;\n    let color = `rgba(${data[index]},${data[index + 1]}, ${\n      data[index + 2]\n    }, 0.25)`;\n    colors[id] = color;\n  });\n  return colors;\n};\n\nexport { startWebGL, snapshot, pallette };\n","const fps = new class {\n  constructor() {\n    this.fps = document.getElementById(\"fps\");\n    this.frames = [];\n    this.lastFrameTimeStamp = performance.now();\n  }\n\n  render() {\n    // Convert the delta time since the last frame render into a measure\n    // of frames per second.\n    const now = performance.now();\n    const delta = now - this.lastFrameTimeStamp;\n    this.lastFrameTimeStamp = now;\n    const fps = (1 / delta) * 1000;\n\n    // Save only the latest 100 timings.\n    this.frames.push(fps);\n    if (this.frames.length > 30) {\n      this.frames.shift();\n    }\n\n    // Find the max, min, and mean of our 100 latest timings.\n    let min = Infinity;\n    let max = -Infinity;\n    let sum = 0;\n    for (let i = 0; i < this.frames.length; i++) {\n      sum += this.frames[i];\n      min = Math.min(this.frames[i], min);\n      max = Math.max(this.frames[i], max);\n    }\n    let mean = sum / this.frames.length;\n\n    // Render the statistics.\n    this.fps.textContent = `FPS:${Math.round(mean)}`;\n  }\n}();\n\nexport { fps };\n","import React from \"react\";\nimport { Link } from \"react-router-dom\";\n\nconst Menu = ({ close, children }) => {\n  return (\n    <div className=\"menu-scrim\">\n      <div className={\"menu\"}>\n        {children}\n        <Link to=\"/\" className=\"x\" onClick={close}>\n          <button> x</button>\n        </Link>\n      </div>\n    </div>\n  );\n};\nexport default Menu;\n","import React from \"react\";\nimport { Link } from \"react-router-dom\";\n\nimport { memory } from \"../../crate/pkg/sandtable_bg\";\nimport { Species } from \"../../crate/pkg/sandtable\";\n\nimport { height, universe, width, reset } from \"../index.js\";\nimport { snapshot, pallette } from \"../render.js\";\nimport { functions, storage } from \"../api.js\";\n\nimport Menu from \"./menu\";\n\nwindow.species = Species;\nlet pallette_data = pallette();\n\nconst ElementButton = (name, selectedElement, setElement) => {\n  let elementID = Species[name];\n\n  let color = pallette_data[elementID];\n  let selected = elementID == selectedElement;\n\n  let background = \"inherit\";\n  if (elementID == 14) {\n    background = `linear-gradient(45deg, \n    rgba(202, 121, 125, 0.25), \n    rgba(169, 120, 200, 0.25), \n    rgba(117, 118, 195, 0.25), \n    rgba(117, 196, 193, 0.25), \n    rgba(122, 203, 168, 0.25), \n    rgba(185, 195, 117, 0.25), \n    rgba(204, 186, 122, 0.25))`;\n    if (selected) {\n      background = background.replace(/0.25/g, \"1.0\");\n    }\n  }\n  return (\n    <button\n      className={selected ? \"selected\" : \"\"}\n      key={name}\n      onClick={() => {\n        setElement(elementID);\n      }}\n      style={{\n        background,\n        backgroundColor: selected ? color.replace(\"0.25\", \"1.5\") : color\n      }}\n    >\n      {\"  \"}\n      {name}\n      {\"  \"}\n    </button>\n  );\n};\n\nlet sizeMap = [2, 5, 10, 18, 30, 45];\n\nclass Index extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      submissionMenuOpen: false,\n      paused: false,\n      submitting: false,\n      size: 2,\n      dataURL: {},\n      currentSubmission: null,\n      selectedElement: Species.Water\n    };\n    window.UI = this;\n    //if we start in the background, pause;\n    if (this.props.location.pathname !== \"/\") {\n      window.setTimeout(() => this.pause(), 50);\n    }\n\n    this.load();\n  }\n\n  componentDidUpdate(prevProps) {\n    if (\n      this.props.location.pathname === \"/\" &&\n      prevProps.location.pathname !== \"/\" &&\n      this.state.currentSubmission\n    ) {\n      window.location = `#${this.state.currentSubmission.id}`;\n      return;\n    }\n    if (\n      this.props.location.pathname !== \"/\" &&\n      prevProps.location.pathname == \"/\"\n    ) {\n      this.pause();\n    }\n    if (\n      prevProps.location.hash === \"\" ||\n      prevProps.location.hash != this.props.location.hash\n    ) {\n      this.load();\n    }\n  }\n  togglePause() {\n    window.paused = !this.state.paused;\n    this.setState({ paused: !this.state.paused });\n  }\n  play() {\n    window.paused = false;\n    this.setState({ paused: false });\n  }\n  pause() {\n    window.paused = true;\n    this.setState({ paused: true });\n  }\n\n  setSize(event, size) {\n    event.preventDefault();\n    this.setState({\n      size\n    });\n  }\n  reset() {\n    if (window.confirm(\"Reset?\")) {\n      this.play();\n      window.location = \"#\";\n      this.setState({ currentSubmission: null });\n      reset();\n    }\n  }\n  menu() {\n    this.pause();\n    this.setState({ submissionMenuOpen: true });\n  }\n\n  closeMenu() {\n    this.play();\n    this.setState({ submissionMenuOpen: false });\n  }\n  upload() {\n    let dataURL = snapshot(universe);\n    const cells = new Uint8Array(\n      memory.buffer,\n      universe.cells(),\n      width * height * 4\n    );\n\n    // Create canvas\n    let canvas = document.createElement(\"canvas\"),\n      context = canvas.getContext(\"2d\"),\n      imgData = context.createImageData(width, height);\n\n    canvas.height = height;\n    canvas.width = width;\n\n    // fill imgData with data from cells\n    for (var i = 0; i < width * height * 4; i++) {\n      if (i % 4 == 3) {\n        imgData.data[i] = 255;\n      } else {\n        imgData.data[i] = cells[i];\n      }\n    }\n    // put data to context at (0, 0)\n    context.putImageData(imgData, 0, 0);\n\n    let cellData = canvas.toDataURL(\"image/png\");\n\n    this.pause();\n    this.setState({\n      data: { dataURL, cells: cellData },\n      submissionMenuOpen: true\n    });\n  }\n  submit() {\n    let { title, data } = this.state;\n    let { dataURL, cells } = data;\n    let payload = { title, image: dataURL, cells };\n    this.setState({ submitting: true });\n\n    fetch(functions._url(\"api/creations\"), {\n      method: \"POST\",\n      body: JSON.stringify(payload), // data can be `string` or {object}!\n      headers: {\n        \"Content-Type\": \"application/json\"\n      }\n    })\n      .then(res => res.json())\n      .then(response => {\n        console.log(\"Success:\", JSON.stringify(response));\n        this.play();\n      })\n      .catch(error => console.error(\"Error:\", error))\n      .then(() => {\n        this.setState({ submissionMenuOpen: false, submitting: false });\n      });\n  }\n\n  load() {\n    let { location } = this.props;\n    let id = location.hash.replace(/#/, \"\");\n    if (id === \"\") {\n      return;\n    }\n\n    if (this.state.currentSubmission && this.state.currentSubmission.id == id) {\n      return;\n    }\n\n    fetch(functions._url(`api/creations/${id}`), {\n      method: \"GET\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      }\n    })\n      .then(res => res.json())\n      .then(data => {\n        storage\n          .refFromURL(\n            `gs://sandtable-8d0f7.appspot.com/creations/${data.id}.data.png`\n          )\n          .getDownloadURL()\n          .then(dlurl => {\n            fetch(dlurl, {\n              method: \"GET\"\n            })\n              .then(res => res.blob())\n              .then(blob => {\n                // console.log(response);\n                this.setState({ currentSubmission: { id, data } });\n\n                var url = URL.createObjectURL(blob);\n                var img = new Image();\n                img.src = url;\n                img.onload = () => {\n                  var canvas = document.createElement(\"canvas\");\n                  canvas.width = width;\n                  canvas.height = height;\n                  var ctx = canvas.getContext(\"2d\");\n                  ctx.drawImage(img, 0, 0);\n                  var imgData = ctx.getImageData(\n                    0,\n                    0,\n                    canvas.width,\n                    canvas.height\n                  );\n\n                  const cellsData = new Uint8Array(\n                    memory.buffer,\n                    universe.cells(),\n                    width * height * 4\n                  );\n\n                  reset();\n\n                  for (var i = 0; i < width * height * 4; i++) {\n                    cellsData[i] = imgData.data[i];\n                  }\n                  universe.flush_undos();\n                  universe.push_undo();\n                  this.pause();\n                };\n              })\n              .catch(error => console.error(\"Error:\", error));\n          });\n      })\n      .catch(error => {\n        console.error(\"Error:\", error);\n      });\n  }\n  incScore() {\n    let { currentSubmission } = this.state;\n    let { id } = currentSubmission;\n    // creations/:id/vote\n    firebase\n      .auth()\n      .currentUser.getIdToken()\n      .then(token => {\n        fetch(functions._url(`api/creations/${id}/vote`), {\n          method: \"PUT\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n            Authorization: \"Bearer \" + token\n          }\n        })\n          .then(res => res.json())\n          .then(data => {\n            if (currentSubmission != null) {\n              console.log(data);\n              this.setState({\n                currentSubmission: { ...currentSubmission, data }\n              });\n            }\n          })\n          .catch(e => {\n            console.log(e);\n          });\n      });\n  }\n\n  render() {\n    let { size, paused, selectedElement, currentSubmission } = this.state;\n    let hash =\n      currentSubmission && currentSubmission.id\n        ? `#${currentSubmission.id}`\n        : \"\";\n    return (\n      <React.Fragment>\n        <button\n          onClick={() => this.togglePause()}\n          className={paused ? \"selected\" : \"\"}\n        >\n          {paused ? (\n            <svg height=\"20\" width=\"20\" id=\"d\" viewBox=\"0 0 300 300\">\n              <polygon id=\"play\" points=\"0,0 , 300,150 0,300\" />\n            </svg>\n          ) : (\n            <svg height=\"20\" width=\"20\" id=\"d\" viewBox=\"0 0 300 300\">\n              <polygon id=\"bar2\" points=\"0,0 110,0 110,300 0,300\" />\n              <polygon id=\"bar1\" points=\"190,0 300,0 300,300 190,300\" />\n            </svg>\n          )}\n        </button>\n        <button onClick={() => this.upload()}>Upload</button>\n        <Link\n          to={{\n            pathname: \"/browse/\",\n            hash\n          }}\n        >\n          <button>Browse</button>\n        </Link>\n\n        <button onClick={() => this.reset()}>Reset</button>\n        <Link\n          to={{\n            pathname: \"/info/\",\n            hash\n          }}\n        >\n          <button>Info</button>\n        </Link>\n\n        {/* {paused && <button onClick={() => universe.tick()}>Tick</button>} */}\n        <span className=\"sizes\">\n          {sizeMap.map((v, i) => (\n            <button\n              key={i}\n              className={i == size ? \"selected\" : \"\"}\n              onClick={e => this.setSize(e, i)}\n              style={{ padding: \"0px\" }}\n            >\n              <svg height=\"23\" width=\"23\" id=\"d\" viewBox=\"0 0 100 100\">\n                <circle cx=\"50\" cy=\"50\" r={2 + v} />\n              </svg>\n            </button>\n          ))}\n        </span>\n        <button\n          onClick={() => {\n            reset();\n            universe.pop_undo();\n          }}\n          style={{ fontSize: 35 }}\n        >\n          \n        </button>\n        <button\n          className={-1 == selectedElement ? \"selected\" : \"\"}\n          key={name}\n          onClick={() => {\n            this.setState({ selectedElement: -1 });\n          }}\n        >\n          Wind\n        </button>\n        {Object.keys(Species).map(n =>\n          ElementButton(n, selectedElement, id =>\n            this.setState({ selectedElement: id })\n          )\n        )}\n\n        {this.state.currentSubmission && (\n          <div className=\"submission-title\">\n            <button onClick={() => this.incScore()}>\n              +{this.state.currentSubmission.data.score}{\" \"}\n            </button>\n            {this.state.currentSubmission.data.title}\n          </div>\n        )}\n\n        {this.state.submissionMenuOpen && (\n          <Menu close={() => this.closeMenu()}>\n            <h4>Share your creation with the people!</h4>\n            <img src={this.state.data.dataURL} className=\"submissionImg\" />\n            <div style={{ display: \"flex\" }}>\n              <input\n                placeholder=\"title\"\n                onChange={e => this.setState({ title: e.target.value })}\n              />\n              <button\n                disabled={this.state.submitting}\n                onClick={() => this.submit()}\n              >\n                Submit\n              </button>\n            </div>\n          </Menu>\n        )}\n      </React.Fragment>\n    );\n  }\n}\n\nexport { sizeMap, Index };\n","import { height, universe, width } from \"./index.js\";\nimport { sizeMap } from \"./components/ui\";\nconst canvas = document.getElementById(\"sand-canvas\");\n\nconst eventDistance = (a, b) => {\n  return Math.sqrt(\n    Math.pow(a.clientX - b.clientX, 2) + Math.pow(a.clientY - b.clientY, 2),\n    2\n  );\n};\n\nconst magnitude = a => {\n  return Math.sqrt(Math.pow(a.clientX, 2) + Math.pow(a.clientY, 2), 2);\n};\n\nconst norm = a => {\n  let mag = magnitude(a);\n  return { clientX: a.clientX / mag, clientY: a.clientY / mag };\n};\nconst scale = (a, s) => {\n  return { clientX: a.clientX * s, clientY: a.clientY * s };\n};\nconst add = (a, b) => {\n  return { clientX: a.clientX + b.clientX, clientY: a.clientY + b.clientY };\n};\nconst sub = (a, b) => {\n  return { clientX: a.clientX - b.clientX, clientY: a.clientY - b.clientY };\n};\n\nlet painting = false;\nlet lastPaint = null;\nlet repeat = null;\n\ncanvas.addEventListener(\"mousedown\", event => {\n  event.preventDefault();\n  universe.push_undo();\n  painting = true;\n  clearInterval(repeat);\n  repeat = window.setInterval(() => paint(event), 100);\n  paint(event);\n  lastPaint = event;\n});\n\ndocument.body.addEventListener(\"mouseup\", event => {\n  clearInterval(repeat);\n  if (painting) {\n    event.preventDefault();\n    lastPaint = null;\n    painting = false;\n  }\n});\n\ncanvas.addEventListener(\"mousemove\", event => {\n  clearInterval(repeat);\n  smoothPaint(event);\n});\n\ncanvas.addEventListener(\"mouseleave\", event => {\n  clearInterval(repeat);\n  lastPaint = null;\n});\n\ncanvas.addEventListener(\"touchstart\", event => {\n  universe.push_undo();\n  if (event.cancelable) {\n    event.preventDefault();\n  }\n  painting = true;\n  lastPaint = event;\n  handleTouches(event);\n});\n\ncanvas.addEventListener(\"touchend\", event => {\n  if (event.cancelable) {\n    event.preventDefault();\n  }\n  lastPaint = null;\n  painting = false;\n  clearInterval(repeat);\n});\n\ncanvas.addEventListener(\"touchmove\", event => {\n  if (!window.paused) {\n    if (event.cancelable) {\n      event.preventDefault();\n    }\n  }\n  clearInterval(repeat);\n  handleTouches(event);\n});\n\nfunction smoothPaint(event) {\n  clearInterval(repeat);\n  repeat = window.setInterval(() => paint(event), 100);\n  let startEvent = { clientX: event.clientX, clientY: event.clientY };\n  if (!painting) {\n    return;\n  }\n  let size = sizeMap[window.UI.state.size];\n  let i = 0;\n  paint(startEvent);\n  if (lastPaint) {\n    while (eventDistance(startEvent, lastPaint) > size / 3) {\n      let d = eventDistance(startEvent, lastPaint);\n      startEvent = add(\n        startEvent,\n        scale(norm(sub(lastPaint, event)), Math.min(size / 3, d))\n      );\n      i++;\n      if (i > 1000) {\n        break;\n      }\n      paint(startEvent);\n    }\n  }\n  lastPaint = event;\n}\n\nconst handleTouches = event => {\n  let touches = Array.from(event.touches);\n  if (touches.length == 1) {\n    smoothPaint(touches[0]);\n  } else {\n    touches.forEach(paint);\n  }\n};\n\nconst paint = event => {\n  if (!painting) {\n    return;\n  }\n  const boundingRect = canvas.getBoundingClientRect();\n\n  const scaleX =\n    canvas.width / Math.ceil(window.devicePixelRatio) / boundingRect.width;\n  const scaleY =\n    canvas.height / Math.ceil(window.devicePixelRatio) / boundingRect.height;\n\n  const canvasLeft = (event.clientX - boundingRect.left) * scaleX;\n  const canvasTop = (event.clientY - boundingRect.top) * scaleY;\n\n  const x = Math.min(Math.floor(canvasLeft), width - 1);\n  const y = Math.min(Math.floor(canvasTop), height - 1);\n  if (window.UI.state.selectedElement < 0) return;\n  universe.paint(\n    x,\n    y,\n    sizeMap[window.UI.state.size],\n    window.UI.state.selectedElement\n  );\n};\n","import React from \"react\";\n\nconst Info = () => {\n  return (\n    <div className=\"Info\">\n      <h1>Sandspiel </h1>\n      <p>\n        Created by <a href=\"https://maxbittker.com\">max bittker</a>\n      </p>\n      <hr />\n      <br />\n      <p>\n        Welcome, and thanks for coming by! I hope that you enjoy exploring this\n        small game, and it brings you some calm.{\" \"}\n      </p>\n      <p>\n        Growing up, \"falling sand\" games like this one provided me hours of\n        entertainment and imagination. I want to particularly thank ha55ii's{\" \"}\n        <a href=\"https://dan-ball.jp/en/javagame/dust/\">Powder Game</a> as the\n        primary inspiration for sandspiel.\n      </p>\n      <br />\n      <p>\n        If you want to read more the inspiration, architecture, and history of\n        the game, I wrote a blog post (it gets technical in the middle):&nbsp;\n        <a href=\"https://maxbittker.com/making-sandspiel\">Making Sandspiel</a>\n      </p>\n      <br />\n      <p>\n        You can follow sandspiel on twitter for updates and new uploads:\n        <a href=\"https://twitter.com/sandspiel_feed\">@sandspiel_feed</a>\n      </p>\n      <br />\n      <p>\n        If you'd like, you can view the{\" \"}\n        <a href=\"https://github.com/maxbittker/sandspiel\">source code</a> or{\" \"}\n        <a href=\"https://github.com/maxbittker/sandspiel/issues\">report bugs</a>{\" \"}\n        on github or feel free to reach out on twitter and I'll try to answer!\n      </p>\n      <br />\n      <p>\n        Lastly, I want to say that if you enjoy this game or share your artwork\n        on it, your opinion is important to me and I want to do my best to\n        ensure sandspiel is a friendly and kind place to play, without bullying,\n        racism, or homophobia. If something is wrong or there's some way I can\n        help, feel free to contact me at [FirstnameLastname]@gmail.com\n      </p>\n      <br />\n      <hr />\n      <br />\n      <h2>Element Information:</h2>\n      <h4>Wall </h4>\n      Indestructible\n      <h4>Sand </h4>\n      Sinks in water\n      <h4>Water </h4>\n      Puts out fire\n      <h4>Stone </h4>\n      Forms arches, folds under pressure\n      <h4>Ice </h4>\n      Freezes Water, slippery!\n      <h4>Gas </h4>\n      Highly Flammable!\n      <h4>Cloner </h4>\n      Copies the first element it touches\n      <h4>Mite </h4>\n      Eats wood and plant, but loves dust! Slides on ice\n      <h4>Wood </h4>\n      Sturdy, but biodegradable\n      <h4>Plant </h4>\n      Thrives in wet enviroments\n      <h4>Fungus </h4>\n      Spreads over everything\n      <h4>Seed </h4>\n      Grows in sand\n      <h4>Fire </h4>\n      Hot!\n      <h4>Lava </h4>\n      Flammable and heavy\n      <h4>Acid </h4>\n      Corrodes other elements\n      <h4>Dust </h4>\n      Pretty, but dangerously explosive\n      <h4>Oil </h4>\n      Produces smoke\n      <h4>Rocket </h4>\n      Explodes into copies of the first element it touches\n      <hr />\n      <hr />\n      <hr />\n      <hr />\n    </div>\n  );\n};\n\nexport default Info;\n","import React from \"react\";\nimport { Link } from \"react-router-dom\";\n\nconst HyperText = ({ text }) => {\n  let tokens = text.split(\" \");\n\n  let nodes = tokens.map((t, i) => {\n    if (t.startsWith(\"#\") && t.length > 1) {\n      return (\n        <React.Fragment key={i}>\n          <Link\n            to={{\n              pathname: \"/browse/search/\",\n              search: `?title=${t.slice(1)}`\n            }}\n          >\n            {t}\n          </Link>{\" \"}\n        </React.Fragment>\n      );\n    } else {\n      return t + \" \";\n    }\n  });\n  return <React.Fragment>{nodes}</React.Fragment>;\n};\nexport default HyperText;\n","import React from \"react\";\n\nimport StyledFirebaseAuth from \"react-firebaseui/StyledFirebaseAuth\";\n\nclass SignInScreen extends React.Component {\n  // The component's Local state.\n  state = {\n    isSignedIn: false, // Local signed-in state.\n    expanded: true\n  };\n\n  // Configure FirebaseUI.\n  uiConfig = {\n    // Popup signin flow rather than redirect flow.\n    signInFlow: \"redirect\",\n    // We will display Google and email as auth providers.\n    signInOptions: [\n      firebase.auth.GoogleAuthProvider.PROVIDER_ID,\n      firebase.auth.GithubAuthProvider.PROVIDER_ID,\n      {\n        provider: firebase.auth.EmailAuthProvider.PROVIDER_ID,\n        requireDisplayName: false\n      }\n      // firebase.auth.FacebookAuthProvider.PROVIDER_ID\n    ],\n    callbacks: {\n      // Avoid redirects after sign-in.\n      signInSuccessWithAuthResult: () => false\n    }\n  };\n\n  // Listen to the Firebase Auth state and set the local state.\n  componentDidMount() {\n    this.setState({ isSignedIn: !!firebase.auth().currentUser });\n\n    this.unregisterAuthObserver = firebase\n      .auth()\n      .onAuthStateChanged(user => this.setState({ isSignedIn: !!user }));\n  }\n\n  // Make sure we un-register Firebase observers when the component unmounts.\n  componentWillUnmount() {\n    this.unregisterAuthObserver();\n  }\n\n  render() {\n    if (!this.state.isSignedIn) {\n      if (!this.state.expanded) {\n        return (\n          <span>\n            <p>\n              Please{\" \"}\n              <button onClick={() => this.setState({ expanded: true })}>\n                Sign in\n              </button>{\" \"}\n              to vote!{\" \"}\n            </p>\n            <span style={{ display: \"none\" }}>\n              {/* gross hack for completing login */}\n              <StyledFirebaseAuth\n                uiConfig={this.uiConfig}\n                firebaseAuth={firebase.auth()}\n              />\n            </span>\n          </span>\n        );\n      } else {\n        return (\n          <div>\n            <p>Sign-in to vote:</p>\n            <StyledFirebaseAuth\n              uiConfig={this.uiConfig}\n              firebaseAuth={firebase.auth()}\n            />\n          </div>\n        );\n      }\n    }\n    let { currentUser } = firebase.auth();\n\n    return (\n      <div>\n        <div style={{ display: \"flex\", alignItems: \"center\" }}>\n          <img\n            style={{ height: \"35px\", width: \"35px\", borderRadius: 50 }}\n            src={currentUser.photoURL}\n          />\n          {!currentUser.emailVerified &&\n            `Please Verify your email ${currentUser.email} to vote!`}\n          <button onClick={() => firebase.auth().signOut()}>Sign-out</button>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default SignInScreen;\n","import React from \"react\";\nimport { NavLink, Link, withRouter } from \"react-router-dom\";\n\nimport timeago from \"timeago.js\";\n\nimport HyperText from \"./hypertext.js\";\nimport { functions, storage } from \"../api.js\";\nimport SignInScreen from \"./signin.js\";\n\nconst ago = timeago();\n\nlet storageUrl =\n  \"https://firebasestorage.googleapis.com/v0/b/sandtable-8d0f7.appspot.com/o/creations%2F\";\n\nclass Submissions extends React.Component {\n  shouldComponentUpdate(nextProps) {\n    let { submissions, browseVotes } = this.props;\n    return (\n      nextProps.submissions !== submissions ||\n      Object.keys(nextProps.browseVotes).length !==\n        Object.keys(browseVotes).length\n    );\n  }\n  render() {\n    let { submissions, voteFromBrowse, browseVotes, report } = this.props;\n\n    if (!submissions) {\n      return <div style={{ height: \"90vh\" }}>Loading Submissions...</div>;\n    }\n    if (submissions.length == 0) {\n      return <div style={{ height: \"90vh\" }}>Didn't find anything!</div>;\n    }\n\n    return (\n      <div className=\"submissions\">\n        {submissions.map(submission => {\n          let displayTime = new Date(\n            submission.data.timestamp\n          ).toLocaleDateString();\n          let msAgo =\n            new Date().getTime() -\n            new Date(submission.data.timestamp).getTime();\n\n          if (msAgo < 24 * 60 * 60 * 1000) {\n            displayTime = ago.format(submission.data.timestamp);\n          }\n          return (\n            <div key={submission.id} className=\"submission\">\n              <Link\n                className=\"img-link\"\n                to={{\n                  pathname: \"/\",\n                  hash: `#${submission.id}`\n                }}\n                onClick={() => {\n                  window.UI.setState(\n                    () => ({\n                      currentSubmission: null\n                    }),\n                    window.UI.load\n                  );\n                }}\n              >\n                <img src={`${storageUrl}${submission.data.id}.png?alt=media`} />\n              </Link>\n              <div style={{ width: \"50%\" }}>\n                <h3 style={{ flexGrow: 1, wordWrap: \"break-word\" }}>\n                  <HyperText text={submission.data.title} />\n                </h3>\n                <button\n                  className=\"heart\"\n                  onClick={() => voteFromBrowse(submission)}\n                >\n                  {browseVotes[submission.id] ? \"\" : \"\"}\n                  {browseVotes[submission.id] || submission.data.score}\n                </button>\n\n                <h4>{displayTime}</h4>\n\n                <button\n                  className=\"report\"\n                  title=\"report\"\n                  onClick={() => report(submission.id)}\n                >\n                  !\n                </button>\n              </div>\n            </div>\n          );\n        })}\n      </div>\n    );\n  }\n}\n\nclass Browse extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      paused: false,\n      submitting: false,\n      dataURL: {},\n      submissions: null,\n      browseVotes: {},\n      search: \"\"\n    };\n  }\n  componentWillMount() {\n    console.log(\"mounted\");\n    this.loadSubmissions();\n  }\n  componentDidUpdate(prevProps) {\n    if (\n      prevProps.location.pathname != this.props.location.pathname ||\n      prevProps.location.search != this.props.location.search\n    ) {\n      this.loadSubmissions();\n    }\n  }\n  togglePause() {\n    window.paused = !this.state.paused;\n    this.setState({ paused: !this.state.paused });\n  }\n\n  setSize(event, size) {\n    event.preventDefault();\n    this.setState({\n      size\n    });\n  }\n\n  loadSubmissions() {\n    let { location } = this.props;\n    if (location.search.startsWith(\"?title=\")) {\n      // to load deep urls with a search query.\n      this.setState({ search: this.props.location.search.slice(7) });\n    }\n    let param = \"\";\n\n    if (location.pathname.startsWith(\"/browse/top/\")) {\n      param = \"?q=score\";\n    }\n    if (location.pathname.startsWith(\"/browse/top/day\")) {\n      param = \"?q=score&d=1\";\n    }\n    if (location.pathname.startsWith(\"/browse/top/week\")) {\n      param = \"?q=score&d=7\";\n    }\n    if (location.pathname.startsWith(\"/browse/top/month\")) {\n      param = \"?q=score&d=30\";\n    }\n    if (location.pathname.startsWith(\"/browse/search/\")) {\n      param = location.search;\n    }\n\n    this.setState({ submissions: null });\n    fetch(functions._url(\"api/creations\") + param, {\n      method: \"GET\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      }\n    })\n      .then(res => res.json())\n      .then(response => {\n        this.setState({ submissions: response });\n        // this.pause();\n      })\n      .catch(error => {\n        this.setState({ submissions: false });\n        console.error(\"Error:\", error);\n      });\n  }\n\n  voteFromBrowse(submission) {\n    // creations/:id/vote\n    firebase\n      .auth()\n      .currentUser.getIdToken()\n      .then(token => {\n        fetch(functions._url(`api/creations/${submission.id}/vote`), {\n          method: \"PUT\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n            Authorization: \"Bearer \" + token\n          }\n        })\n          .then(res => res.json())\n          .then(data => {\n            this.setState(({ browseVotes }) => ({\n              browseVotes: { [submission.id]: data.score, ...browseVotes }\n            }));\n          })\n          .catch(e => {\n            console.log(e);\n          });\n      });\n  }\n  report(id) {\n    fetch(functions._url(`api/creations/${id}/report`), {\n      method: \"PUT\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      }\n    })\n      .then(res => res.json())\n      .then(data => {\n        // this.setState(({ browseVotes }) => ({\n        //   browseVotes: { [submission.id]: data.score, ...browseVotes }\n        // }));\n      })\n      .catch(e => {\n        console.log(e);\n      });\n  }\n  render() {\n    const { search, submissions, browseVotes } = this.state;\n    return (\n      <React.Fragment>\n        <marquee>Stream \"60 on Scarborough\" on Spotify</marquee>\n        <SignInScreen />\n        <NavLink exact to=\"/browse/\">\n          <button>New</button>\n        </NavLink>\n        <NavLink to=\"/browse/top/day/\">\n          <button>Day</button>\n        </NavLink>\n        <NavLink to=\"/browse/top/week/\">\n          <button>Week</button>\n        </NavLink>\n        <NavLink to=\"/browse/top/month/\">\n          <button>Month</button>\n        </NavLink>\n        <NavLink exact to=\"/browse/top/\">\n          <button>All </button>\n        </NavLink>\n        <span style={{ display: \"inline-block\" }}>\n          <input\n            value={search}\n            onChange={e => this.setState({ search: e.target.value })}\n            onKeyDown={e =>\n              e.keyCode == 13 && // I think that's enter\n              this.props.history.push(`/browse/search/?title=${search}`)\n            }\n            placeholder=\"search\"\n          />\n          {search && (\n            <NavLink\n              to={{\n                pathname: \"/browse/search/\",\n                search: `?title=${search}`\n              }}\n            >\n              <button>Search</button>\n            </NavLink>\n          )}\n        </span>\n        <Submissions\n          submissions={submissions}\n          voteFromBrowse={submission => this.voteFromBrowse(submission)}\n          browseVotes={browseVotes}\n          report={id => this.report(id)}\n        />\n      </React.Fragment>\n    );\n  }\n}\n\nexport default withRouter(Browse);\n","import React from \"react\";\nimport { NavLink, Link, withRouter } from \"react-router-dom\";\n\nimport timeago from \"timeago.js\";\n\nimport HyperText from \"./hypertext.js\";\nimport SignInScreen from \"./signin\";\nimport { functions, storage } from \"../api.js\";\n\nconst ago = timeago();\n\nlet storageUrl =\n  \"https://firebasestorage.googleapis.com/v0/b/sandtable-8d0f7.appspot.com/o/creations%2F\";\n\nclass Submissions extends React.Component {\n  shouldComponentUpdate(nextProps) {\n    let { submissions, browseVotes } = this.props;\n    return (\n      nextProps.submissions !== submissions ||\n      Object.keys(nextProps.browseVotes).length !==\n        Object.keys(browseVotes).length\n    );\n  }\n  render() {\n    let { submissions, voteFromBrowse, browseVotes, judge } = this.props;\n\n    if (!submissions) {\n      return <div style={{ height: \"90vh\" }}>Loading Submissions...</div>;\n    }\n    if (submissions.length == 0) {\n      return (\n        <div style={{ height: \"90vh\" }}>No actionable reports! Thanks </div>\n      );\n    }\n\n    return (\n      <div className=\"submissions\">\n        {submissions.map(submission => {\n          let displayTime = new Date(\n            submission.data.timestamp\n          ).toLocaleDateString();\n          let msAgo =\n            new Date().getTime() -\n            new Date(submission.data.timestamp).getTime();\n\n          if (msAgo < 24 * 60 * 60 * 1000) {\n            displayTime = ago.format(submission.data.timestamp);\n          }\n          return (\n            <div key={submission.id} className=\"submission\">\n              <Link\n                className=\"img-link\"\n                to={{\n                  pathname: \"/\",\n                  hash: `#${submission.id}`\n                }}\n                onClick={() => {\n                  window.UI.setState(\n                    () => ({\n                      currentSubmission: null\n                    }),\n                    window.UI.load\n                  );\n                }}\n              >\n                <img src={`${storageUrl}${submission.data.id}.png?alt=media`} />\n              </Link>\n              <div style={{ width: \"50%\" }}>\n                <h3 style={{ flexGrow: 1, wordWrap: \"break-word\" }}>\n                  <HyperText text={submission.data.title} />\n                </h3>\n                <button\n                  className=\"heart\"\n                  onClick={() => voteFromBrowse(submission)}\n                >\n                  <h3>\n                    {browseVotes[submission.id] ? \"\" : \"\"}\n                    {browseVotes[submission.id] || submission.data.score}\n                  </h3>\n                </button>\n\n                <h4>{displayTime}</h4>\n                <h3>{submission.data.reports} reports</h3>\n\n                <div className=\"adminButtons\">\n                  <button\n                    className=\"delete\"\n                    title=\"delete\"\n                    onClick={() => judge(submission.id, true)}\n                  >\n                    delete \n                  </button>\n                  <button\n                    className=\"pardon\"\n                    title=\"pardon\"\n                    onClick={() => judge(submission.id, false)}\n                  >\n                    pardon \n                  </button>\n                </div>\n              </div>\n            </div>\n          );\n        })}\n      </div>\n    );\n  }\n}\n\nclass AdminBrowse extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      paused: false,\n      submissions: null,\n      decidedIds: [],\n      browseVotes: {},\n      search: \"\",\n      currentUser: firebase.auth().currentUser\n    };\n  }\n  componentWillMount() {\n    this.loadSubmissions();\n  }\n  componentDidUpdate(prevProps) {\n    if (prevProps.location.pathname != this.props.location.pathname) {\n      this.loadSubmissions();\n    }\n  }\n\n  voteFromBrowse(submission) {\n    // creations/:id/vote\n    firebase\n      .auth()\n      .currentUser.getIdToken(true)\n      .then(token => {\n        fetch(functions._url(`api/creations/${submission.id}/vote`), {\n          method: \"PUT\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n            Authorization: \"Bearer \" + token\n          }\n        })\n          .then(res => res.json())\n          .then(data => {\n            this.setState(({ browseVotes }) => ({\n              browseVotes: { [submission.id]: data.score, ...browseVotes }\n            }));\n          })\n          .catch(e => {\n            console.log(e);\n          });\n      });\n  }\n  loadSubmissions() {\n    // this.setState({ submissions: null });\n    fetch(functions._url(\"api/reports\"), {\n      method: \"GET\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      }\n    })\n      .then(res => res.json())\n      .then(response => {\n        this.setState({ submissions: response });\n        // this.pause();\n      })\n      .catch(error => {\n        this.setState({ submissions: false });\n        console.error(\"Error:\", error);\n      });\n  }\n  judge(id, ruling) {\n    this.setState(({ decidedIds }) => ({\n      decidedIds: [...decidedIds, id]\n    }));\n    firebase\n      .auth()\n      .currentUser.getIdToken(true)\n      .then(token => {\n        // set the __session cookie\n        fetch(\n          functions._url(`api/creations/${id}/judge`) + `?ruling=${ruling}`,\n          {\n            method: \"PUT\",\n            headers: {\n              \"Content-Type\": \"application/json\",\n              Authorization: \"Bearer \" + token\n            }\n          }\n        )\n          .then(res => res.json())\n          .then(data => {\n            this.loadSubmissions();\n          })\n          .catch(e => {\n            console.log(e);\n          });\n      });\n  }\n  doSignInWithGoogle() {\n    var provider = new firebase.auth.GoogleAuthProvider();\n    firebase.auth().signInWithRedirect(provider);\n  }\n  render() {\n    let { submissions, browseVotes, currentUser, decidedIds } = this.state;\n\n    submissions =\n      submissions &&\n      submissions.filter(submission => !decidedIds.includes(submission.id));\n    return (\n      <React.Fragment>\n        <SignInScreen />\n        <h2 style={{ display: \"inline-block\" }}>do it for doona </h2>\n\n        {submissions && <h3>{submissions.length} actionable reports:</h3>}\n        <NavLink to=\"/browse/\">\n          <button>Browse new</button>\n        </NavLink>\n        <Submissions\n          submissions={submissions}\n          voteFromBrowse={submission => this.voteFromBrowse(submission)}\n          browseVotes={browseVotes}\n          judge={(id, ruling) => this.judge(id, ruling)}\n        />\n      </React.Fragment>\n    );\n  }\n}\n\nexport default withRouter(AdminBrowse);\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { BrowserRouter as Router, Route, Link } from \"react-router-dom\";\n\nimport Info from \"./components/info\";\nimport { Index } from \"./components/ui\";\nimport Browse from \"./components/browse\";\nimport Admin from \"./components/admin\";\nimport Menu from \"./components/menu\";\nimport SignInScreen from \"./components/signin\";\n\nlet sizeMap = [2, 5, 10, 18, 30, 45];\n\nfunction BrowseRouter({ match, location }) {\n  return (\n    <Menu>\n      <Browse location={location} />\n    </Menu>\n  );\n}\n\nfunction AdminRouter({ match, location }) {\n  return (\n    <Menu>\n      <Admin location={location} />\n    </Menu>\n  );\n}\n\nfunction SigninRouter({ match, location }) {\n  return (\n    <Menu>\n      <SignInScreen location={location} />\n    </Menu>\n  );\n}\n\nfunction AppRouter() {\n  return (\n    <Router>\n      <Route path=\"/\" component={Index} />\n      <Route\n        exact\n        path=\"/info/\"\n        component={() => (\n          <Menu>\n            <Info />\n          </Menu>\n        )}\n      />\n      <Route path=\"/browse\" component={BrowseRouter} />\n      <Route path=\"/admin\" component={AdminRouter} />\n      <Route path=\"/login\" component={SigninRouter} />\n      <Route path=\"/__/auth/handler\" component={SigninRouter} />\n    </Router>\n  );\n}\n\nReactDOM.render(<AppRouter />, document.getElementById(\"ui\"));\n\nexport { sizeMap };\n","let baseVertex = require(\"./glsl/baseVertex.glsl\");\nlet clearShaderString = require(\"./glsl/clear.glsl\");\nlet displayShaderString = require(\"./glsl/display.glsl\");\nlet splatShaderString = require(\"./glsl/splat.glsl\");\nlet advectionManualFilteringShaderString = require(\"./glsl/advectionManualFilter.glsl\");\nlet advectionShaderString = require(\"./glsl/advection.glsl\");\nlet divergenceShaderString = require(\"./glsl/divergence.glsl\");\nlet curlShaderString = require(\"./glsl/curl.glsl\");\nlet vorticityShaderString = require(\"./glsl/vorticity.glsl\");\nlet pressureShaderString = require(\"./glsl/pressure.glsl\");\nlet gradientSubtractShaderString = require(\"./glsl/gradientSubtract.glsl\");\nlet velocityOutShaderString = require(\"./glsl/velocityOut.glsl\");\n\nfunction compileShaders(gl) {\n  function compileShader(type, source) {\n    const shader = gl.createShader(type);\n    gl.shaderSource(shader, source);\n    gl.compileShader(shader);\n\n    if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS))\n      throw gl.getShaderInfoLog(shader);\n\n    return shader;\n  }\n\n  const baseVertexShader = compileShader(gl.VERTEX_SHADER, baseVertex);\n  const clearShader = compileShader(gl.FRAGMENT_SHADER, clearShaderString);\n  const displayShader = compileShader(gl.FRAGMENT_SHADER, displayShaderString);\n  const splatShader = compileShader(gl.FRAGMENT_SHADER, splatShaderString);\n  const advectionManualFilteringShader = compileShader(\n    gl.FRAGMENT_SHADER,\n    advectionManualFilteringShaderString\n  );\n  const advectionShader = compileShader(\n    gl.FRAGMENT_SHADER,\n    advectionShaderString\n  );\n  const divergenceShader = compileShader(\n    gl.FRAGMENT_SHADER,\n    divergenceShaderString\n  );\n  const curlShader = compileShader(gl.FRAGMENT_SHADER, curlShaderString);\n  const vorticityShader = compileShader(\n    gl.FRAGMENT_SHADER,\n    vorticityShaderString\n  );\n  const pressureShader = compileShader(\n    gl.FRAGMENT_SHADER,\n    pressureShaderString\n  );\n  const gradientSubtractShader = compileShader(\n    gl.FRAGMENT_SHADER,\n    gradientSubtractShaderString\n  );\n  const velocityOutShader = compileShader(\n    gl.FRAGMENT_SHADER,\n    velocityOutShaderString\n  );\n\n  return {\n    baseVertexShader,\n    clearShader,\n    displayShader,\n    splatShader,\n    advectionManualFilteringShader,\n    advectionShader,\n    divergenceShader,\n    curlShader,\n    vorticityShader,\n    pressureShader,\n    gradientSubtractShader,\n    velocityOutShader\n  };\n}\n\nexport { compileShaders };\n","// MIT License\n\n// Copyright (c) 2017 Pavel Dobryakov\n\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in all\n// copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\n\"use strict\";\nimport * as dat from \"dat.gui\";\nimport { memory } from \"../crate/pkg/sandtable_bg\";\nimport { compileShaders } from \"./fluidShaders\";\nconst canvas = document.getElementById(\"fluid-canvas\");\nconst sandCanvas = document.getElementById(\"sand-canvas\");\n\nlet fluidColor = [1, 1, 0.8];\n\nfunction startFluid({ universe }) {\n  canvas.width = universe.width();\n  canvas.height = universe.height();\n  let config = {\n    TEXTURE_DOWNSAMPLE: 0,\n    DENSITY_DISSIPATION: 0.98,\n    VELOCITY_DISSIPATION: 0.99,\n    PRESSURE_DISSIPATION: 0.8,\n    PRESSURE_ITERATIONS: 25,\n    CURL: 30,\n    SPLAT_RADIUS: 0.005\n  };\n\n  let pointers = [];\n  let splatStack = [];\n\n  const { gl, ext } = getWebGLContext(canvas);\n  let {\n    baseVertexShader,\n    clearShader,\n    displayShader,\n    splatShader,\n    advectionManualFilteringShader,\n    advectionShader,\n    divergenceShader,\n    curlShader,\n    vorticityShader,\n    pressureShader,\n    gradientSubtractShader,\n    velocityOutShader\n  } = compileShaders(gl);\n  startGUI();\n\n  function getWebGLContext(canvas) {\n    const params = {\n      alpha: false,\n      depth: false,\n      stencil: false,\n      antialias: false,\n      preserveDrawingBuffer: false\n    };\n\n    let gl = canvas.getContext(\"webgl2\", params);\n    const isWebGL2 = !!gl;\n    if (!isWebGL2)\n      gl =\n        canvas.getContext(\"webgl\", params) ||\n        canvas.getContext(\"experimental-webgl\", params);\n\n    let halfFloat;\n    let supportLinearFiltering;\n    if (isWebGL2) {\n      gl.getExtension(\"EXT_color_buffer_float\");\n      supportLinearFiltering = gl.getExtension(\"OES_texture_float_linear\");\n    } else {\n      halfFloat = gl.getExtension(\"OES_texture_half_float\");\n      supportLinearFiltering = gl.getExtension(\"OES_texture_half_float_linear\");\n    }\n\n    gl.clearColor(0.0, 0.0, 0.0, 0.0);\n\n    const halfFloatTexType = isWebGL2\n      ? gl.HALF_FLOAT\n      : halfFloat.HALF_FLOAT_OES;\n    let formatRGBA;\n    let formatRG;\n    let formatR;\n\n    if (isWebGL2) {\n      formatRGBA = getSupportedFormat(\n        gl,\n        gl.RGBA16F,\n        gl.RGBA,\n        halfFloatTexType\n      );\n      formatRG = getSupportedFormat(gl, gl.RG16F, gl.RG, halfFloatTexType);\n      formatR = getSupportedFormat(gl, gl.R16F, gl.RED, halfFloatTexType);\n    } else {\n      formatRGBA = getSupportedFormat(gl, gl.RGBA, gl.RGBA, halfFloatTexType);\n      formatRG = getSupportedFormat(gl, gl.RGBA, gl.RGBA, halfFloatTexType);\n      formatR = getSupportedFormat(gl, gl.RGBA, gl.RGBA, halfFloatTexType);\n    }\n\n    return {\n      gl,\n      ext: {\n        formatRGBA,\n        formatRG,\n        formatR,\n        halfFloatTexType,\n        supportLinearFiltering\n      }\n    };\n  }\n\n  function getSupportedFormat(gl, internalFormat, format, type) {\n    if (!supportRenderTextureFormat(gl, internalFormat, format, type)) {\n      switch (internalFormat) {\n        case gl.R16F:\n          return getSupportedFormat(gl, gl.RG16F, gl.RG, type);\n        case gl.RG16F:\n          return getSupportedFormat(gl, gl.RGBA16F, gl.RGBA, type);\n        default:\n          return null;\n      }\n    }\n\n    return {\n      internalFormat,\n      format\n    };\n  }\n\n  function supportRenderTextureFormat(gl, internalFormat, format, type) {\n    let texture = gl.createTexture();\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n    gl.texImage2D(\n      gl.TEXTURE_2D,\n      0,\n      internalFormat,\n      4,\n      4,\n      0,\n      format,\n      type,\n      null\n    );\n\n    let fbo = gl.createFramebuffer();\n    gl.bindFramebuffer(gl.FRAMEBUFFER, fbo);\n    gl.framebufferTexture2D(\n      gl.FRAMEBUFFER,\n      gl.COLOR_ATTACHMENT0,\n      gl.TEXTURE_2D,\n      texture,\n      0\n    );\n\n    const status = gl.checkFramebufferStatus(gl.FRAMEBUFFER);\n    if (status != gl.FRAMEBUFFER_COMPLETE) return false;\n    return true;\n  }\n\n  function startGUI() {\n    var gui = new dat.GUI({ width: 300 });\n    gui\n      .add(config, \"TEXTURE_DOWNSAMPLE\", { Full: 0, Half: 1, Quarter: 2 })\n      .name(\"resolution\")\n      .onFinishChange(initFramebuffers);\n    gui.add(config, \"DENSITY_DISSIPATION\", 0.9, 1.0).name(\"density diffusion\");\n    gui\n      .add(config, \"VELOCITY_DISSIPATION\", 0.9, 1.0)\n      .name(\"velocity diffusion\");\n    gui\n      .add(config, \"PRESSURE_DISSIPATION\", 0.0, 1.0)\n      .name(\"pressure diffusion\");\n    gui.add(config, \"PRESSURE_ITERATIONS\", 1, 60).name(\"iterations\");\n    gui\n      .add(config, \"CURL\", 0, 50)\n      .name(\"vorticity\")\n      .step(1);\n    gui.add(config, \"SPLAT_RADIUS\", 0.0001, 0.01).name(\"splat radius\");\n\n    gui\n      .add(\n        {\n          fun: () => {\n            splatStack.push(parseInt(Math.random() * 20) + 5);\n          }\n        },\n        \"fun\"\n      )\n      .name(\"Random splats\");\n\n    gui.close();\n  }\n\n  function pointerPrototype() {\n    this.id = -1;\n    this.x = 0;\n    this.y = 0;\n    this.dx = 0;\n    this.dy = 0;\n    this.down = false;\n    this.moved = false;\n    this.color = [30, 300, 30];\n  }\n\n  pointers.push(new pointerPrototype());\n\n  class GLProgram {\n    constructor(vertexShader, fragmentShader) {\n      this.uniforms = {};\n      this.program = gl.createProgram();\n\n      gl.attachShader(this.program, vertexShader);\n      gl.attachShader(this.program, fragmentShader);\n      gl.linkProgram(this.program);\n\n      if (!gl.getProgramParameter(this.program, gl.LINK_STATUS))\n        throw gl.getProgramInfoLog(this.program);\n\n      const uniformCount = gl.getProgramParameter(\n        this.program,\n        gl.ACTIVE_UNIFORMS\n      );\n      for (let i = 0; i < uniformCount; i++) {\n        const uniformName = gl.getActiveUniform(this.program, i).name;\n        this.uniforms[uniformName] = gl.getUniformLocation(\n          this.program,\n          uniformName\n        );\n      }\n    }\n\n    bind() {\n      gl.useProgram(this.program);\n    }\n  }\n\n  let texWidth;\n  let texHeight;\n  let density;\n  let velocity;\n  let velocityOut;\n  let burns;\n  let cells;\n  let divergence;\n  let curl;\n  let pressure;\n  initFramebuffers();\n\n  const clearProgram = new GLProgram(baseVertexShader, clearShader);\n  const displayProgram = new GLProgram(baseVertexShader, displayShader);\n  const velocityOutProgram = new GLProgram(baseVertexShader, velocityOutShader);\n  const splatProgram = new GLProgram(baseVertexShader, splatShader);\n  const advectionProgram = new GLProgram(\n    baseVertexShader,\n    ext.supportLinearFiltering\n      ? advectionShader\n      : advectionManualFilteringShader\n  );\n  const divergenceProgram = new GLProgram(baseVertexShader, divergenceShader);\n  const curlProgram = new GLProgram(baseVertexShader, curlShader);\n  const vorticityProgram = new GLProgram(baseVertexShader, vorticityShader);\n  const pressureProgram = new GLProgram(baseVertexShader, pressureShader);\n  const gradientSubtractProgram = new GLProgram(\n    baseVertexShader,\n    gradientSubtractShader\n  );\n\n  function initFramebuffers() {\n    texWidth = gl.drawingBufferWidth >> config.TEXTURE_DOWNSAMPLE;\n    texHeight = gl.drawingBufferHeight >> config.TEXTURE_DOWNSAMPLE;\n\n    const texType = ext.halfFloatTexType;\n    const rgba = ext.formatRGBA;\n    const rg = ext.formatRG;\n    const r = ext.formatR;\n\n    velocity = createDoubleFBO(\n      0,\n      texWidth,\n      texHeight,\n      rg.internalFormat,\n      rg.format,\n      texType,\n      ext.supportLinearFiltering ? gl.LINEAR : gl.NEAREST\n    );\n    density = createDoubleFBO(\n      2,\n      texWidth,\n      texHeight,\n      rgba.internalFormat,\n      rgba.format,\n      texType,\n      ext.supportLinearFiltering ? gl.LINEAR : gl.NEAREST\n    );\n    divergence = createFBO(\n      4,\n      texWidth,\n      texHeight,\n      r.internalFormat,\n      r.format,\n      texType,\n      gl.NEAREST\n    );\n    curl = createFBO(\n      5,\n      texWidth,\n      texHeight,\n      r.internalFormat,\n      r.format,\n      texType,\n      gl.NEAREST\n    );\n    pressure = createDoubleFBO(\n      6,\n      texWidth,\n      texHeight,\n      r.internalFormat,\n      r.format,\n      texType,\n      gl.NEAREST\n    );\n    burns = createFBO(\n      8,\n      texWidth,\n      texHeight,\n      rg.internalFormat,\n      rg.format,\n      texType,\n      ext.supportLinearFiltering ? gl.LINEAR : gl.NEAREST\n    );\n    cells = createFBO(\n      10,\n      texWidth,\n      texHeight,\n      rg.internalFormat,\n      rg.format,\n      texType,\n      ext.supportLinearFiltering ? gl.LINEAR : gl.NEAREST\n    );\n    velocityOut = createFBO(\n      9,\n      texWidth,\n      texHeight,\n      gl.RGBA,\n      gl.RGBA,\n      gl.UNSIGNED_BYTE,\n      ext.supportLinearFiltering ? gl.LINEAR : gl.NEAREST\n    );\n  }\n\n  function createFBO(texId, w, h, internalFormat, format, type, param) {\n    gl.activeTexture(gl.TEXTURE0 + texId);\n    let texture = gl.createTexture();\n\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, param);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, param);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n    gl.texImage2D(\n      gl.TEXTURE_2D,\n      0,\n      internalFormat,\n      w,\n      h,\n      0,\n      format,\n      type,\n      null\n    );\n\n    let fbo = gl.createFramebuffer();\n    gl.bindFramebuffer(gl.FRAMEBUFFER, fbo);\n    gl.framebufferTexture2D(\n      gl.FRAMEBUFFER,\n      gl.COLOR_ATTACHMENT0,\n      gl.TEXTURE_2D,\n      texture,\n      0\n    );\n    gl.viewport(0, 0, w, h);\n    gl.clear(gl.COLOR_BUFFER_BIT);\n\n    return [texture, fbo, texId];\n  }\n\n  function createDoubleFBO(texId, w, h, internalFormat, format, type, param) {\n    let fbo1 = createFBO(texId, w, h, internalFormat, format, type, param);\n    let fbo2 = createFBO(texId + 1, w, h, internalFormat, format, type, param);\n\n    return {\n      get read() {\n        return fbo1;\n      },\n      get write() {\n        return fbo2;\n      },\n      swap() {\n        let temp = fbo1;\n        fbo1 = fbo2;\n        fbo2 = temp;\n      }\n    };\n  }\n\n  const blit = (() => {\n    gl.bindBuffer(gl.ARRAY_BUFFER, gl.createBuffer());\n    gl.bufferData(\n      gl.ARRAY_BUFFER,\n      new Float32Array([-1, -1, -1, 1, 1, 1, 1, -1]),\n      gl.STATIC_DRAW\n    );\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, gl.createBuffer());\n    gl.bufferData(\n      gl.ELEMENT_ARRAY_BUFFER,\n      new Uint16Array([0, 1, 2, 0, 2, 3]),\n      gl.STATIC_DRAW\n    );\n    gl.vertexAttribPointer(0, 2, gl.FLOAT, false, 0, 0);\n    gl.enableVertexAttribArray(0);\n\n    return destination => {\n      gl.bindFramebuffer(gl.FRAMEBUFFER, destination);\n      gl.drawElements(gl.TRIANGLES, 6, gl.UNSIGNED_SHORT, 0);\n    };\n  })();\n\n  let lastTime = Date.now();\n\n  // multipleSplats(parseInt(Math.random() * 20) + 5);\n\n  const width = universe.width();\n  const height = universe.height();\n\n  let winds = new Uint8Array(\n    memory.buffer,\n    universe.winds(),\n    width * height * 4\n  );\n\n  let burnsData = new Uint8Array(\n    memory.buffer,\n    universe.burns(),\n    width * height * 4\n  );\n\n  let cellsData = new Uint8Array(\n    memory.buffer,\n    universe.cells(),\n    width * height * 4\n  );\n\n  function reset() {\n    clearProgram.bind();\n\n    var texUnit = 0;\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, burns[0]);\n    gl.uniform1i(clearProgram.uniforms.uWind, texUnit++);\n\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, density.read[0]);\n    gl.uniform1i(clearProgram.uniforms.uTexture, texUnit++);\n\n    gl.uniform1f(clearProgram.uniforms.value, 0);\n\n    blit(density.write[1]);\n    density.swap();\n\n    var texUnit = 0;\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, burns[0]);\n    gl.uniform1i(clearProgram.uniforms.uWind, texUnit++);\n\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, pressure.read[0]);\n    gl.uniform1i(clearProgram.uniforms.uTexture, texUnit++);\n\n    gl.uniform1f(clearProgram.uniforms.value, 0);\n\n    blit(pressure.write[1]);\n    pressure.swap();\n\n    texUnit = 0;\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, burns[0]);\n    gl.uniform1i(clearProgram.uniforms.uWind, texUnit++);\n\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, velocity.read[0]);\n    gl.uniform1i(clearProgram.uniforms.uTexture, texUnit++);\n\n    gl.uniform1f(clearProgram.uniforms.value, 0);\n\n    blit(velocity.write[1]);\n    velocity.swap();\n  }\n\n  function update() {\n    winds = new Uint8Array(memory.buffer, universe.winds(), width * height * 4);\n\n    burnsData = new Uint8Array(\n      memory.buffer,\n      universe.burns(),\n      width * height * 4\n    );\n\n    let cell_pointer = universe.cells();\n    cellsData = new Uint8Array(memory.buffer, cell_pointer, width * height * 4);\n\n    // resizeCanvas();\n\n    const dt = Math.min((Date.now() - lastTime) / 1000, 0.016);\n    lastTime = Date.now();\n\n    gl.viewport(0, 0, texWidth, texHeight);\n\n    if (splatStack.length > 0) multipleSplats(splatStack);\n    // multipleSplats(1);\n\n    // ADVECTION\n    // velocityRead ->\n    // velocityWrite\n    advectionProgram.bind();\n\n    var texUnit = 0;\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, velocity.read[0]);\n    gl.uniform1i(advectionProgram.uniforms.uVelocity, texUnit++);\n\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, velocity.read[0]);\n    gl.uniform1i(advectionProgram.uniforms.uSource, texUnit++);\n\n    gl.uniform2f(\n      advectionProgram.uniforms.texelSize,\n      1.0 / texWidth,\n      1.0 / texHeight\n    );\n    // gl.uniform1i(advectionProgram.uniforms.uVelocity, velocity.read[2]);\n    // gl.uniform1i(advectionProgram.uniforms.uSource, velocity.read[2]);\n    gl.uniform1f(advectionProgram.uniforms.dt, dt);\n    gl.uniform1f(\n      advectionProgram.uniforms.dissipation,\n      config.VELOCITY_DISSIPATION\n    );\n    blit(velocity.write[1]);\n    velocity.swap();\n\n    gl.bindTexture(gl.TEXTURE_2D, burns[0]);\n    gl.texImage2D(\n      gl.TEXTURE_2D,\n      0,\n      gl.RGBA,\n      width,\n      height,\n      0,\n      gl.RGBA,\n      gl.UNSIGNED_BYTE,\n      burnsData\n    );\n\n    gl.bindTexture(gl.TEXTURE_2D, cells[0]);\n    gl.texImage2D(\n      gl.TEXTURE_2D,\n      0,\n      gl.RGBA,\n      width,\n      height,\n      0,\n      gl.RGBA,\n      gl.UNSIGNED_BYTE,\n      cellsData\n    );\n\n    // ADVECTION\n    // burns\n    // velocityRead\n    // densityRead ->\n    // densityWrite\n\n    var texUnit = 0;\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, burns[0]);\n    gl.uniform1i(advectionProgram.uniforms.uWind, texUnit++);\n\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, velocity.read[0]);\n    gl.uniform1i(advectionProgram.uniforms.uVelocity, texUnit++);\n\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, density.read[0]);\n    gl.uniform1i(advectionProgram.uniforms.uSource, texUnit++);\n\n    // gl.uniform1i(advectionProgram.uniforms.uWind, burns[2]);\n    // gl.uniform1i(advectionProgram.uniforms.uVelocity, velocity.read[2]);\n    // gl.uniform1i(advectionProgram.uniforms.uSource, density.read[2]);\n    gl.uniform1f(\n      advectionProgram.uniforms.dissipation,\n      config.DENSITY_DISSIPATION\n    );\n    blit(density.write[1]);\n    density.swap();\n\n    // Splat\n    // velocityRead -> velocityWrite\n    // densityRead -> velocityWrite\n    for (let i = 0; i < pointers.length; i++) {\n      const pointer = pointers[i];\n      if (pointer.moved && window.UI.state.selectedElement < 0) {\n        splat(pointer.x, pointer.y, pointer.dx, pointer.dy, pointer.color);\n        pointer.moved = false;\n      }\n    }\n\n    // CURL\n    // velocityRead -> curl\n    curlProgram.bind();\n\n    var texUnit = 0;\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, velocity.read[0]);\n    gl.uniform1i(curlProgram.uniforms.uVelocity, texUnit++);\n\n    gl.uniform2f(\n      curlProgram.uniforms.texelSize,\n      1.0 / texWidth,\n      1.0 / texHeight\n    );\n    // gl.uniform1i(curlProgram.uniforms.uVelocity, velocity.read[2]);\n    blit(curl[1]);\n\n    // VORTICITY\n    // velocityRead\n    // curl ->\n    // velocityWrite\n\n    vorticityProgram.bind();\n\n    var texUnit = 0;\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, velocity.read[0]);\n    gl.uniform1i(vorticityProgram.uniforms.uVelocity, texUnit++);\n\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, curl[0]);\n    gl.uniform1i(vorticityProgram.uniforms.uCurl, texUnit++);\n\n    gl.uniform2f(\n      vorticityProgram.uniforms.texelSize,\n      1.0 / texWidth,\n      1.0 / texHeight\n    );\n\n    // gl.uniform1i(vorticityProgram.uniforms.uVelocity, velocity.read[2]);\n    // gl.uniform1i(vorticityProgram.uniforms.uCurl, curl[2]);\n    gl.uniform1f(vorticityProgram.uniforms.curl, config.CURL);\n    gl.uniform1f(vorticityProgram.uniforms.dt, dt);\n    blit(velocity.write[1]);\n    velocity.swap();\n\n    // DIVERGENCE\n    // velocityRead ->\n    // divergence\n    divergenceProgram.bind();\n\n    var texUnit = 0;\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, velocity.read[0]);\n    gl.uniform1i(divergenceProgram.uniforms.uVelocity, texUnit++);\n\n    gl.uniform2f(\n      divergenceProgram.uniforms.texelSize,\n      1.0 / texWidth,\n      1.0 / texHeight\n    );\n    // gl.uniform1i(divergenceProgram.uniforms.uVelocity, velocity.read[2]);\n    blit(divergence[1]);\n\n    // CLEAR\n    // burns\n    // pressureRead->\n    // pressureWrite\n    clearProgram.bind();\n\n    var texUnit = 0;\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, burns[0]);\n    gl.uniform1i(clearProgram.uniforms.uWind, texUnit++);\n\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, pressure.read[0]);\n    gl.uniform1i(clearProgram.uniforms.uTexture, texUnit++);\n\n    let pressureTexId = texUnit - 1;\n\n    // let pressureTexId = pressure.read[2];\n    // gl.activeTexture(gl.TEXTURE0 + pressureTexId);\n    // gl.bindTexture(gl.TEXTURE_2D, pressure.read[0]);\n\n    // gl.uniform1i(clearProgram.uniforms.uWind, burns[2]);\n    // gl.uniform1i(clearProgram.uniforms.uTexture, pressureTexId);\n    gl.uniform1f(clearProgram.uniforms.value, config.PRESSURE_DISSIPATION);\n\n    blit(pressure.write[1]);\n    pressure.swap();\n\n    // PRESSURE\n    // divergence\n    // pressureRead->\n    // pressureWrite\n    pressureProgram.bind();\n    //TODO\n    var texUnit = 0;\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, divergence[0]);\n    gl.uniform1i(pressureProgram.uniforms.uDivergence, texUnit++);\n\n    // gl.activeTexture(gl.TEXTURE0 + texUnit);\n    // gl.bindTexture(gl.TEXTURE_2D, pressure.read[0]);\n    // gl.uniform1i(clearProgram.uniforms.uTexture, texUnit++);\n\n    gl.uniform2f(\n      pressureProgram.uniforms.texelSize,\n      1.0 / texWidth,\n      1.0 / texHeight\n    );\n    // gl.uniform1i(pressureProgram.uniforms.uDivergence, divergence[2]);\n    pressureTexId = pressure.read[2];\n    gl.uniform1i(pressureProgram.uniforms.uPressure, pressureTexId);\n    gl.activeTexture(gl.TEXTURE0 + pressureTexId);\n    for (let i = 0; i < config.PRESSURE_ITERATIONS; i++) {\n      gl.bindTexture(gl.TEXTURE_2D, pressure.read[0]);\n      blit(pressure.write[1]);\n      pressure.swap();\n    }\n\n    // VELOCITY OUT\n    // velocityRead\n    // pressureRead ->\n    // velocityOut\n    velocityOutProgram.bind();\n\n    var texUnit = 0;\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, velocity.read[0]);\n    gl.uniform1i(velocityOutProgram.uniforms.uTexture, texUnit++);\n\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, pressure.read[0]);\n    gl.uniform1i(velocityOutProgram.uniforms.uPressure, texUnit++);\n\n    // gl.uniform1i(velocityOutProgram.uniforms.uTexture, velocity.read[2]);\n    // gl.uniform1i(velocityOutProgram.uniforms.uPressure, pressure.read[2]);\n    blit(velocityOut[1]);\n    gl.readPixels(0, 0, width, height, gl.RGBA, gl.UNSIGNED_BYTE, winds);\n\n    // GRADIENT SUBTRACT\n    // burns\n    // pressureRead\n    // velocityRead\n    // sands ->\n    // velocityWrite\n    gradientSubtractProgram.bind();\n\n    var texUnit = 0;\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, burns[0]);\n    gl.uniform1i(gradientSubtractProgram.uniforms.uWind, texUnit++);\n\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, pressure.read[0]);\n    gl.uniform1i(gradientSubtractProgram.uniforms.uPressure, texUnit++);\n\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, velocity.read[0]);\n    gl.uniform1i(gradientSubtractProgram.uniforms.uVelocity, texUnit++);\n\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, cells[0]);\n    gl.uniform1i(gradientSubtractProgram.uniforms.uCells, texUnit++);\n\n    gl.uniform2f(\n      gradientSubtractProgram.uniforms.texelSize,\n      1.0 / texWidth,\n      1.0 / texHeight\n    );\n\n    // gl.uniform1i(gradientSubtractProgram.uniforms.uWind, burns[2]);\n    // gl.uniform1i(gradientSubtractProgram.uniforms.uPressure, pressure.read[2]);\n    // gl.uniform1i(gradientSubtractProgram.uniforms.uVelocity, velocity.read[2]);\n    blit(velocity.write[1]);\n    velocity.swap();\n\n    gl.viewport(0, 0, gl.drawingBufferWidth, gl.drawingBufferHeight);\n\n    // DISPLAY\n    // density ->\n    // null/renderbuffer?\n    displayProgram.bind();\n\n    var texUnit = 0;\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, density.read[0]);\n    gl.uniform1i(displayProgram.uniforms.uTexture, texUnit++);\n\n    // gl.uniform1i(displayProgram.uniforms.uTexture, density.read[2]);\n\n    blit(null);\n  }\n\n  function splat(x, y, dx, dy, color) {\n    splatProgram.bind();\n\n    var texUnit = 0;\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, velocity.read[0]);\n    gl.uniform1i(splatProgram.uniforms.uTarget, texUnit++);\n\n    // gl.uniform1i(splatProgram.uniforms.uTarget, velocity.read[2]);\n    gl.uniform1f(\n      splatProgram.uniforms.aspectRatio,\n      canvas.width / canvas.height\n    );\n    gl.uniform2f(\n      splatProgram.uniforms.point,\n      x / canvas.width,\n      1.0 - y / canvas.height\n    );\n    gl.uniform3f(splatProgram.uniforms.color, dx, -dy, 1.0);\n    gl.uniform1f(\n      splatProgram.uniforms.radius,\n      (window.UI.state.size + 1) / 600\n    );\n    blit(velocity.write[1]);\n    velocity.swap();\n\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, density.read[0]);\n    gl.uniform1i(splatProgram.uniforms.uTarget, texUnit++);\n\n    // gl.uniform1i(splatProgram.uniforms.uTarget, density.read[2]);\n    gl.uniform3f(splatProgram.uniforms.color, color[0], color[1], color[2]);\n    blit(density.write[1]);\n    density.swap();\n  }\n\n  function multipleSplats(amount) {\n    for (let i = 0; i < amount; i++) {\n      const color = fluidColor;\n      const x = canvas.width * Math.random();\n      const y = canvas.height * Math.random();\n      const dx = 1000 * (Math.random() - 0.5);\n      const dy = 1000 * (Math.random() - 0.5);\n      splat(x, y, dx, dy, color);\n    }\n  }\n\n  let boundingRect;\n  let scaleX;\n  let scaleY;\n\n  let resize = () => {\n    boundingRect = sandCanvas.getBoundingClientRect();\n    scaleX =\n      sandCanvas.width /\n      Math.ceil(window.devicePixelRatio) /\n      boundingRect.width;\n    scaleY =\n      sandCanvas.height /\n      Math.ceil(window.devicePixelRatio) /\n      boundingRect.height;\n  };\n  resize();\n  window.addEventListener(\"resize\", resize);\n  window.addEventListener(\"deviceorientation\", resize, true);\n\n  sandCanvas.addEventListener(\"mousemove\", e => {\n    const canvasLeft = (e.clientX - boundingRect.left) * scaleX;\n    const canvasTop = (e.clientY - boundingRect.top) * scaleY;\n    pointers[0].moved = pointers[0].down;\n    pointers[0].dx = (canvasLeft - pointers[0].x) * 10.0;\n    pointers[0].dy = (canvasTop - pointers[0].y) * 10.0;\n    pointers[0].x = canvasLeft;\n    pointers[0].y = canvasTop;\n  });\n\n  sandCanvas.addEventListener(\n    \"touchmove\",\n    e => {\n      if (!window.paused) {\n        if (e.cancelable) {\n          e.preventDefault();\n        }\n      }\n      const touches = e.targetTouches;\n      for (let i = 0; i < touches.length; i++) {\n        let pointer = pointers[i];\n        pointer.moved = pointer.down;\n\n        const canvasLeft = (touches[i].clientX - boundingRect.left) * scaleX;\n        const canvasTop = (touches[i].clientY - boundingRect.top) * scaleY;\n\n        pointer.dx = (canvasLeft - pointer.x) * 10.0;\n        pointer.dy = (canvasTop - pointer.y) * 10.0;\n        pointer.x = canvasLeft;\n        pointer.y = canvasTop;\n      }\n    },\n    false\n  );\n\n  sandCanvas.addEventListener(\"mousedown\", () => {\n    pointers[0].down = true;\n    pointers[0].color = fluidColor;\n  });\n\n  sandCanvas.addEventListener(\"touchstart\", e => {\n    if (e.cancelable) {\n      e.preventDefault();\n    }\n    const touches = e.targetTouches;\n    for (let i = 0; i < touches.length; i++) {\n      if (i >= pointers.length) pointers.push(new pointerPrototype());\n\n      const canvasLeft = (touches[i].clientX - boundingRect.left) * scaleX;\n      const canvasTop = (touches[i].clientY - boundingRect.top) * scaleY;\n\n      pointers[i].id = touches[i].identifier;\n      pointers[i].down = true;\n      pointers[i].x = canvasLeft;\n      pointers[i].y = canvasTop;\n      pointers[i].color = fluidColor;\n    }\n  });\n\n  window.addEventListener(\"mouseup\", () => {\n    pointers[0].down = false;\n  });\n\n  window.addEventListener(\"touchend\", e => {\n    const touches = e.changedTouches;\n    for (let i = 0; i < touches.length; i++)\n      for (let j = 0; j < pointers.length; j++)\n        if (touches[i].identifier == pointers[j].id) pointers[j].down = false;\n  });\n\n  return { update, reset };\n}\n\nexport { startFluid };\n","import \"./api\";\nimport { Universe } from \"../crate/pkg\";\n\nimport { startWebGL } from \"./render\";\nimport { fps } from \"./fps\";\nimport {} from \"./paint\";\nimport {} from \"./app\";\nimport { startFluid } from \"./fluid\";\n\nif (window.safari) {\n  history.pushState(null, null, location.href);\n  window.onpopstate = function(event) {\n    history.go(1);\n  };\n}\n\nfunction mobileAndTabletcheck() {\n  var check = false;\n  (function(a) {\n    if (\n      /(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(\n        a\n      ) ||\n      /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(\n        a.substr(0, 4)\n      )\n    )\n      check = true;\n  })(navigator.userAgent || navigator.vendor || window.opera);\n  return check;\n}\n\nif (mobileAndTabletcheck()) {\n  window.onbeforeunload = function() {\n    return true;\n  };\n}\n\nif (\"serviceWorker\" in navigator) {\n  window.addEventListener(\"load\", () => {\n    navigator.serviceWorker\n      .register(\"/service-worker.js\")\n      .then(registration => {\n        console.log(\"SW registered: \", registration);\n      })\n      .catch(registrationError => {\n        console.log(\"SW registration failed: \", registrationError);\n      });\n  });\n}\n\nlet n = 300;\nconst universe = Universe.new(n, n);\n\nlet width = n;\nlet height = n;\nconst canvas = document.getElementById(\"sand-canvas\");\nconst canvas2 = document.getElementById(\"fluid-canvas\");\n\ncanvas.height = n * Math.ceil(window.devicePixelRatio);\ncanvas.width = n * Math.ceil(window.devicePixelRatio);\n\ndocument.getElementById(\"background\").addEventListener(\"touchmove\", e => {\n  if (!window.paused) {\n    if (e.cancelable) {\n      e.preventDefault();\n    }\n  }\n});\n\nconst ui = document.getElementById(\"ui\");\n\nlet resize = () => {\n  let screen_width = window.innerWidth;\n  let uiheight = 50;\n  let screen_height = window.innerHeight - uiheight;\n\n  let canvasStyle = \"\";\n  let uiStyle = \"\";\n  let adStyle = \"display:none;\";\n  if (screen_width > screen_height) {\n    if (screen_width - window.innerHeight < 400) {\n      // landscape compressed\n\n      canvasStyle = `height: ${window.innerHeight}px; margin:3px`;\n      uiStyle = `width: ${screen_width -\n        window.innerHeight -\n        12}px; margin: 2px;`;\n    } else {\n      // landscape wide\n      canvasStyle = `\n       height: ${window.innerHeight}px;\n       width:${window.innerHeight}px;\n       margin:0;\n       left: auto;\n       right: 206px`;\n\n      // uiStyle = `width: ${(screen_width - window.innerHeight) / 2 -\n      //   7}px; margin: 2px;`;\n      uiStyle = `width: 200px; margin: 2px;`;\n\n      adStyle = `width: ${screen_width -\n        window.innerHeight -\n        (206 + 150)}px; margin: 1px;`;\n    }\n  } else {\n    //portrait (mobile)\n    canvasStyle = `width: ${screen_width}px; bottom:3px;`;\n    uiStyle = \"\";\n  }\n  ui.style = uiStyle;\n  canvas.style = canvasStyle;\n  canvas2.style = canvasStyle;\n  document.getElementsByClassName(\"adslot_1\")[0].style = adStyle;\n};\n\nresize();\nwindow.addEventListener(\"deviceorientation\", resize, true);\nwindow.addEventListener(\"resize\", resize);\n\nlet fluid = startFluid({ universe });\n\nlet drawSand = startWebGL({ canvas, universe });\n\nconst renderLoop = () => {\n  if (!window.paused) {\n    fps.render(); // new\n    universe.tick();\n    fluid.update();\n  }\n  drawSand();\n\n  window.animationId = requestAnimationFrame(renderLoop);\n};\n\nrenderLoop();\n\nfunction reset() {\n  fluid.reset();\n  fluid.update();\n  fluid.reset();\n  fluid.update();\n\n  universe.reset();\n}\nwindow.u = universe;\n\n(adsbygoogle = window.adsbygoogle || []).push({});\nexport { canvas, width, height, universe, reset };\n","import * as wasm from './sandtable_bg.wasm';\n\nfunction notDefined(what) { return () => { throw new Error(`${what} is not defined`); }; }\n\nlet cachedTextDecoder = new TextDecoder('utf-8');\n\nlet cachegetUint8Memory = null;\nfunction getUint8Memory() {\n    if (cachegetUint8Memory === null || cachegetUint8Memory.buffer !== wasm.memory.buffer) {\n        cachegetUint8Memory = new Uint8Array(wasm.memory.buffer);\n    }\n    return cachegetUint8Memory;\n}\n\nfunction getStringFromWasm(ptr, len) {\n    return cachedTextDecoder.decode(getUint8Memory().subarray(ptr, ptr + len));\n}\n/**\n*/\nexport const Species = Object.freeze({ Empty:0,Wall:1,Sand:2,Water:3,Stone:13,Ice:9,Gas:4,Cloner:5,Mite:15,Wood:7,Plant:11,Fungus:18,Seed:19,Fire:6,Lava:8,Acid:12,Dust:14,Oil:16,Rocket:17, });\n/**\n*/\nexport class Cell {\n\n    free() {\n        const ptr = this.ptr;\n        this.ptr = 0;\n\n        wasm.__wbg_cell_free(ptr);\n    }\n}\n/**\n*/\nexport class Universe {\n\n    static __wrap(ptr) {\n        const obj = Object.create(Universe.prototype);\n        obj.ptr = ptr;\n\n        return obj;\n    }\n\n    free() {\n        const ptr = this.ptr;\n        this.ptr = 0;\n\n        wasm.__wbg_universe_free(ptr);\n    }\n    /**\n    */\n    reset() {\n        wasm.universe_reset(this.ptr);\n    }\n    /**\n    */\n    tick() {\n        wasm.universe_tick(this.ptr);\n    }\n    /**\n    * @returns {number}\n    */\n    width() {\n        const ret = wasm.universe_width(this.ptr);\n        return ret;\n    }\n    /**\n    * @returns {number}\n    */\n    height() {\n        const ret = wasm.universe_height(this.ptr);\n        return ret;\n    }\n    /**\n    * @returns {number}\n    */\n    cells() {\n        const ret = wasm.universe_cells(this.ptr);\n        return ret;\n    }\n    /**\n    * @returns {number}\n    */\n    winds() {\n        const ret = wasm.universe_winds(this.ptr);\n        return ret;\n    }\n    /**\n    * @returns {number}\n    */\n    burns() {\n        const ret = wasm.universe_burns(this.ptr);\n        return ret;\n    }\n    /**\n    * @param {number} x\n    * @param {number} y\n    * @param {number} size\n    * @param {number} species\n    */\n    paint(x, y, size, species) {\n        wasm.universe_paint(this.ptr, x, y, size, species);\n    }\n    /**\n    */\n    push_undo() {\n        wasm.universe_push_undo(this.ptr);\n    }\n    /**\n    */\n    pop_undo() {\n        wasm.universe_pop_undo(this.ptr);\n    }\n    /**\n    */\n    flush_undos() {\n        wasm.universe_flush_undos(this.ptr);\n    }\n    /**\n    * @param {number} width\n    * @param {number} height\n    * @returns {Universe}\n    */\n    static new(width, height) {\n        const ret = wasm.universe_new(width, height);\n        return Universe.__wrap(ret);\n    }\n}\n/**\n*/\nexport class Wind {\n\n    free() {\n        const ptr = this.ptr;\n        this.ptr = 0;\n\n        wasm.__wbg_wind_free(ptr);\n    }\n}\n\nexport const __wbg_random_09364f2d8647f133 = typeof Math.random == 'function' ? Math.random : notDefined('Math.random');\n\nexport const __wbindgen_throw = function(arg0, arg1) {\n    throw new Error(getStringFromWasm(arg0, arg1));\n};\n\n","module.exports = \"precision highp float;\\n#define GLSLIFY 1\\nuniform float t;\\nuniform float dpi;\\nuniform vec2 resolution;\\nuniform bool isSnapshot;\\nuniform sampler2D backBuffer;\\nuniform sampler2D data;\\n\\nvarying vec2 uv;\\n\\n// clang-format off\\nvec3 hsv2rgb_3_0(vec3 c) {\\n  vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\\n  vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\\n  return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\\n}\\n\\n\\n\\n//\\n// Description : Array and textureless GLSL 2D/3D/4D simplex\\n//               noise functions.\\n//      Author : Ian McEwan, Ashima Arts.\\n//  Maintainer : ijm\\n//     Lastmod : 20110822 (ijm)\\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\\n//               Distributed under the MIT License. See LICENSE file.\\n//               https://github.com/ashima/webgl-noise\\n//\\n\\nvec3 mod289_1_1(vec3 x) {\\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\\n}\\n\\nvec4 mod289_1_1(vec4 x) {\\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\\n}\\n\\nvec4 permute_1_2(vec4 x) {\\n     return mod289_1_1(((x*34.0)+1.0)*x);\\n}\\n\\nvec4 taylorInvSqrt_1_3(vec4 r)\\n{\\n  return 1.79284291400159 - 0.85373472095314 * r;\\n}\\n\\nfloat snoise_1_4(vec3 v)\\n  {\\n  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\\n  const vec4  D_1_5 = vec4(0.0, 0.5, 1.0, 2.0);\\n\\n// First corner\\n  vec3 i  = floor(v + dot(v, C.yyy) );\\n  vec3 x0 =   v - i + dot(i, C.xxx) ;\\n\\n// Other corners\\n  vec3 g_1_6 = step(x0.yzx, x0.xyz);\\n  vec3 l = 1.0 - g_1_6;\\n  vec3 i1 = min( g_1_6.xyz, l.zxy );\\n  vec3 i2 = max( g_1_6.xyz, l.zxy );\\n\\n  //   x0 = x0 - 0.0 + 0.0 * C.xxx;\\n  //   x1 = x0 - i1  + 1.0 * C.xxx;\\n  //   x2 = x0 - i2  + 2.0 * C.xxx;\\n  //   x3 = x0 - 1.0 + 3.0 * C.xxx;\\n  vec3 x1 = x0 - i1 + C.xxx;\\n  vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\\n  vec3 x3 = x0 - D_1_5.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y\\n\\n// Permutations\\n  i = mod289_1_1(i);\\n  vec4 p = permute_1_2( permute_1_2( permute_1_2(\\n             i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\\n           + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))\\n           + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\\n\\n// Gradients: 7x7 points over a square, mapped onto an octahedron.\\n// The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)\\n  float n_ = 0.142857142857; // 1.0/7.0\\n  vec3  ns = n_ * D_1_5.wyz - D_1_5.xzx;\\n\\n  vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)\\n\\n  vec4 x_ = floor(j * ns.z);\\n  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\\n\\n  vec4 x = x_ *ns.x + ns.yyyy;\\n  vec4 y = y_ *ns.x + ns.yyyy;\\n  vec4 h = 1.0 - abs(x) - abs(y);\\n\\n  vec4 b0 = vec4( x.xy, y.xy );\\n  vec4 b1 = vec4( x.zw, y.zw );\\n\\n  //vec4 s0 = vec4(lessThan(b0,0.0))*2.0 - 1.0;\\n  //vec4 s1 = vec4(lessThan(b1,0.0))*2.0 - 1.0;\\n  vec4 s0 = floor(b0)*2.0 + 1.0;\\n  vec4 s1 = floor(b1)*2.0 + 1.0;\\n  vec4 sh = -step(h, vec4(0.0));\\n\\n  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\\n  vec4 a1_1_7 = b1.xzyw + s1.xzyw*sh.zzww ;\\n\\n  vec3 p0_1_8 = vec3(a0.xy,h.x);\\n  vec3 p1 = vec3(a0.zw,h.y);\\n  vec3 p2 = vec3(a1_1_7.xy,h.z);\\n  vec3 p3 = vec3(a1_1_7.zw,h.w);\\n\\n//Normalise gradients\\n  vec4 norm = taylorInvSqrt_1_3(vec4(dot(p0_1_8,p0_1_8), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\\n  p0_1_8 *= norm.x;\\n  p1 *= norm.y;\\n  p2 *= norm.z;\\n  p3 *= norm.w;\\n\\n// Mix final noise value\\n  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\\n  m = m * m;\\n  return 42.0 * dot( m*m, vec4( dot(p0_1_8,x0), dot(p1,x1),\\n                                dot(p2,x2), dot(p3,x3) ) );\\n  }\\n\\n\\n\\n//\\n// Description : Array and textureless GLSL 2D simplex noise function.\\n//      Author : Ian McEwan, Ashima Arts.\\n//  Maintainer : ijm\\n//     Lastmod : 20110822 (ijm)\\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\\n//               Distributed under the MIT License. See LICENSE file.\\n//               https://github.com/ashima/webgl-noise\\n//\\n\\nvec3 mod289_2_9(vec3 x) {\\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\\n}\\n\\nvec2 mod289_2_9(vec2 x) {\\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\\n}\\n\\nvec3 permute_2_10(vec3 x) {\\n  return mod289_2_9(((x*34.0)+1.0)*x);\\n}\\n\\nfloat snoise_2_11(vec2 v)\\n  {\\n  const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0\\n                      0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)\\n                     -0.577350269189626,  // -1.0 + 2.0 * C.x\\n                      0.024390243902439); // 1.0 / 41.0\\n// First corner\\n  vec2 i  = floor(v + dot(v, C.yy) );\\n  vec2 x0 = v -   i + dot(i, C.xx);\\n\\n// Other corners\\n  vec2 i1;\\n  //i1.x = step( x0.y, x0.x ); // x0.x > x0.y ? 1.0 : 0.0\\n  //i1.y = 1.0 - i1.x;\\n  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\\n  // x0 = x0 - 0.0 + 0.0 * C.xx ;\\n  // x1 = x0 - i1 + 1.0 * C.xx ;\\n  // x2 = x0 - 1.0 + 2.0 * C.xx ;\\n  vec4 x12 = x0.xyxy + C.xxzz;\\n  x12.xy -= i1;\\n\\n// Permutations\\n  i = mod289_2_9(i); // Avoid truncation effects in permutation\\n  vec3 p = permute_2_10( permute_2_10( i.y + vec3(0.0, i1.y, 1.0 ))\\n    + i.x + vec3(0.0, i1.x, 1.0 ));\\n\\n  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);\\n  m = m*m ;\\n  m = m*m ;\\n\\n// Gradients: 41 points uniformly over a line, mapped onto a diamond.\\n// The ring size 17*17 = 289 is close to a multiple of 41 (41*7 = 287)\\n\\n  vec3 x = 2.0 * fract(p * C.www) - 1.0;\\n  vec3 h = abs(x) - 0.5;\\n  vec3 ox = floor(x + 0.5);\\n  vec3 a0 = x - ox;\\n\\n// Normalise gradients implicitly by scaling m\\n// Approximation of: m *= inversesqrt( a0*a0 + h*h );\\n  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\\n\\n// Compute final noise value at P\\n  vec3 g;\\n  g.x  = a0.x  * x0.x  + h.x  * x0.y;\\n  g.yz = a0.yz * x12.xz + h.yz * x12.yw;\\n  return 130.0 * dot(m, g);\\n}\\n\\n\\n\\nhighp float random_4_12(vec2 co)\\n{\\n    highp float a = 12.9898;\\n    highp float b = 78.233;\\n    highp float c = 43758.5453;\\n    highp float dt= dot(co.xy ,vec2(a,b));\\n    highp float sn= mod(dt,3.14);\\n    return fract(sin(sn) * c);\\n}\\n\\n\\n\\n// clang-format on\\n\\nvoid main() {\\n  vec3 color;\\n  //   float r = abs(sin(t / 25.));\\n  //   if (length(uv) < r && length(uv) > r - 0.1) {\\n  // color = hsv2rgb(vec3(sin(t * 0.01), 0.5, 0.5));\\n\\n  vec2 textCoord = (uv * vec2(0.5, -0.5)) + vec2(0.5);\\n  // vec3 bb = texture2D(backBuffer, (uv * 0.5) + vec2(0.5)).rgb;\\n\\n  vec4 data = texture2D(data, textCoord);\\n  int type = int((data.r * 255.) + 0.1);\\n  float hue = 0.0;\\n  float saturation = 0.6;\\n  float lightness = 0.3 + data.g * 0.5;\\n  float noise = snoise_1_4(vec3(floor(uv * resolution / dpi), t * 0.05));\\n  float a = 1.0;\\n\\n  if (type == 0) {\\n    hue = 0.0;\\n    saturation = 0.1;\\n    lightness = 0.1;\\n    a = 0.1;\\n    if (isSnapshot) {\\n      saturation = 0.05;\\n      lightness = 1.01;\\n      a = 1.0;\\n    }\\n  } else if (type == 1) {\\n    hue = 0.1;\\n    saturation = 0.1;\\n    lightness = 0.4;\\n  } else if (type == 2) {\\n    hue = 0.1;\\n    saturation = 0.5;\\n    lightness += 0.3;\\n  } else if (type == 3) { // water\\n    hue = 0.6;\\n    lightness = 0.7 + data.g * 0.25 + noise * 0.1;\\n  } else if (type == 4) { // gas\\n    hue = 0.0;\\n    lightness += 0.4;\\n    saturation = 0.2 + (data.b * 1.5);\\n  } else if (type == 5) { // clone\\n    hue = 0.9;\\n    saturation = 0.3;\\n  } else if (type == 6) { // fire\\n    hue = (data.g * 0.1);\\n    saturation = 0.7;\\n\\n    lightness = 0.7 + (data.g * 0.3) + ((noise + 0.8) * 0.5);\\n  } else if (type == 7) { // wood\\n    hue = (data.g * 0.1);\\n    saturation = 0.3;\\n    lightness = 0.3 + data.g * 0.3;\\n  } else if (type == 8) { // lava\\n    hue = (data.g * 0.1);\\n    lightness = 0.7 + data.g * 0.25 + noise * 0.1;\\n  } else if (type == 9) { // ice\\n    hue = 0.6;\\n    saturation = 0.4;\\n    lightness = 0.7 + data.g * 0.5;\\n  } else if (type == 10) { // sink\\n    hue = 0.9;\\n    saturation = 0.4;\\n    lightness = 1.0;\\n  } else if (type == 11) { // plant\\n    hue = 0.4;\\n    saturation = 0.4;\\n  } else if (type == 12) { // acid\\n    hue = 0.18;\\n    saturation = 0.9;\\n    lightness = 0.8 + data.g * 0.2 + noise * 0.05;\\n  } else if (type == 13) { // stone\\n    hue = -0.4 + (data.g * 0.5);\\n    saturation = 0.1;\\n    // lightness = 0.2 + data.g * 0.5;\\n  } else if (type == 14) { // dust\\n    hue = (data.g * 2.0) + t * .0008;\\n    saturation = 0.4;\\n    lightness = 0.8;\\n  } else if (type == 15) { // mite\\n    hue = 0.8;\\n    saturation = 0.9;\\n    lightness = 0.8;\\n  } else if (type == 16) { // oil\\n    hue = (data.g * 5.0) + t * .008;\\n\\n    saturation = 0.2;\\n    lightness = 0.3;\\n  } else if (type == 17) { // Rocket\\n    hue = 0.0;\\n    saturation = 0.4 + data.b;\\n    lightness = 0.9;\\n  } else if (type == 18) { // fungus\\n    hue = (data.g * 0.15) - 0.1;\\n    saturation = (data.g * 0.8) - 0.05;\\n\\n    // (data.g * 0.00);\\n    lightness = 1.5 - (data.g * 0.2);\\n  } else if (type == 19) { // seed/flower\\n\\n    hue = fract(fract(data.b * 2.) * 0.5) - 0.3;\\n    saturation = 0.7 * (data.g + 0.4) + data.b * 0.2;\\n    lightness = 0.9 * (data.g + 0.9);\\n  }\\n  if (isSnapshot == false) {\\n    lightness *= (0.975 + snoise_2_11(floor(uv * resolution / dpi)) * 0.025);\\n  }\\n  color = hsv2rgb_3_0(vec3(hue, saturation, lightness));\\n  gl_FragColor = vec4(color, a);\\n}\"","module.exports = \"\\n// boring \\\"pass-through\\\" vertex shader\\nprecision mediump float;\\n#define GLSLIFY 1\\nattribute vec2 position;\\nvarying vec2 uv;\\nvoid main() {\\n  uv = position;\\n  gl_Position = vec4(position, 0, 1);\\n}\"","module.exports = \"precision highp float;\\nprecision mediump sampler2D;\\n#define GLSLIFY 1\\nattribute vec2 aPosition;\\nvarying vec2 vUv;\\nvarying vec2 vL;\\nvarying vec2 vR;\\nvarying vec2 vT;\\nvarying vec2 vB;\\nuniform vec2 texelSize;\\nvoid main() {\\n  vUv = aPosition * 0.5 + 0.5;\\n  vL = vUv - vec2(texelSize.x, 0.0);\\n  vR = vUv + vec2(texelSize.x, 0.0);\\n  vT = vUv + vec2(0.0, texelSize.y);\\n  vB = vUv - vec2(0.0, texelSize.y);\\n  gl_Position = vec4(aPosition, 0.0, 1.0);\\n}\\n\"","module.exports = \"precision highp float;\\nprecision mediump sampler2D;\\n#define GLSLIFY 1\\nvarying vec2 vUv;\\nuniform sampler2D uTexture;\\nuniform sampler2D uWind;\\nuniform float value;\\nvoid main() {\\n  float pressure = texture2D(uWind, vUv).z;\\n  pressure *= 512.;\\n  pressure *= pressure;\\n  gl_FragColor = value * (texture2D(uTexture, vUv) + vec4(pressure));\\n}\"","module.exports = \"precision highp float;\\nprecision mediump sampler2D;\\n#define GLSLIFY 1\\nvarying vec2 vUv;\\nuniform sampler2D uTexture;\\nvoid main() {\\n  vec3 color = texture2D(uTexture, vUv).rgb * 0.1;\\n  color *= 0.5;\\n  color = min(color, 0.9);\\n  color = vec3(1.0) - color;\\n  color *= vec3(0.95, 0.9, 0.9);\\n  // color *= 0.5;\\n  gl_FragColor = vec4(color, 1.0);\\n}\\n\"","module.exports = \"precision highp float;\\nprecision mediump sampler2D;\\n#define GLSLIFY 1\\nvarying vec2 vUv;\\nuniform sampler2D uTarget;\\nuniform float aspectRatio;\\nuniform vec3 color;\\nuniform vec2 point;\\nuniform float radius;\\nvoid main() {\\n  vec2 p = vUv - point.xy;\\n  p.x *= aspectRatio;\\n  vec3 splat = exp(-dot(p, p) / radius) * color;\\n  vec3 base = texture2D(uTarget, vUv).xyz;\\n  gl_FragColor = vec4(base + splat, 1.0);\\n}\"","module.exports = \"precision highp float;\\nprecision mediump sampler2D;\\n#define GLSLIFY 1\\nvarying vec2 vUv;\\nuniform sampler2D uVelocity;\\nuniform sampler2D uSource;\\nuniform sampler2D uWind;\\nuniform vec2 texelSize;\\nuniform float dt;\\nuniform float dissipation;\\nvec4 bilerp(in sampler2D sam, in vec2 p) {\\n  vec4 st;\\n  st.xy = floor(p - 0.5) + 0.5;\\n  st.zw = st.xy + 1.0;\\n  vec4 uv = st * texelSize.xyxy;\\n  vec4 a = texture2D(sam, uv.xy);\\n  vec4 b = texture2D(sam, uv.zy);\\n  vec4 c = texture2D(sam, uv.xw);\\n  vec4 d = texture2D(sam, uv.zw);\\n  vec2 f = p - st.xy;\\n  return mix(mix(a, b, f.x), mix(c, d, f.x), f.y);\\n}\\nvoid main() {\\n  vec2 coord = gl_FragCoord.xy - dt * texture2D(uVelocity, vUv).xy;\\n  float density = texture2D(uWind, vUv).w;\\n  if (density > 0.99) {\\n    density = 0.;\\n  }\\n  gl_FragColor = dissipation * (bilerp(uSource, coord) + vec4(density));\\n  gl_FragColor.a = 1.0;\\n}\"","module.exports = \"\\nprecision highp float;\\nprecision mediump sampler2D;\\n#define GLSLIFY 1\\nvarying vec2 vUv;\\nuniform sampler2D uVelocity;\\nuniform sampler2D uSource;\\nuniform sampler2D uWind;\\nuniform vec2 texelSize;\\nuniform float dt;\\nuniform float dissipation;\\nvoid main() {\\n  vec2 coord = vUv - dt * texture2D(uVelocity, vUv).xy * texelSize;\\n  float density = texture2D(uWind, vUv).w * 1.;\\n  if (density > 0.99) {\\n    density = 0.;\\n  }\\n\\n  gl_FragColor = dissipation * (texture2D(uSource, coord) + vec4(density));\\n  gl_FragColor.a = 1.0;\\n}\\n\"","module.exports = \"precision highp float;\\nprecision mediump sampler2D;\\n#define GLSLIFY 1\\nvarying vec2 vUv;\\nvarying vec2 vL;\\nvarying vec2 vR;\\nvarying vec2 vT;\\nvarying vec2 vB;\\nuniform sampler2D uVelocity;\\nvec2 sampleVelocity(in vec2 uv) {\\n  vec2 multiplier = vec2(1.0, 1.0);\\n  if (uv.x < 0.0) {\\n    uv.x = 0.0;\\n    multiplier.x = -1.0;\\n  }\\n  if (uv.x > 1.0) {\\n    uv.x = 1.0;\\n    multiplier.x = -1.0;\\n  }\\n  if (uv.y < 0.0) {\\n    uv.y = 0.0;\\n    multiplier.y = -1.0;\\n  }\\n  if (uv.y > 1.0) {\\n    uv.y = 1.0;\\n    multiplier.y = -1.0;\\n  }\\n  return multiplier * texture2D(uVelocity, uv).xy;\\n}\\nvoid main() {\\n  float L = sampleVelocity(vL).x;\\n  float R = sampleVelocity(vR).x;\\n  float T = sampleVelocity(vT).y;\\n  float B = sampleVelocity(vB).y;\\n  float div = 0.5 * (R - L + T - B);\\n  gl_FragColor = vec4(div, 0.0, 0.0, 1.0);\\n}\\n\"","module.exports = \"precision highp float;\\nprecision mediump sampler2D;\\n#define GLSLIFY 1\\nvarying vec2 vUv;\\nvarying vec2 vL;\\nvarying vec2 vR;\\nvarying vec2 vT;\\nvarying vec2 vB;\\nuniform sampler2D uVelocity;\\nvoid main() {\\n  float L = texture2D(uVelocity, vL).y;\\n  float R = texture2D(uVelocity, vR).y;\\n  float T = texture2D(uVelocity, vT).x;\\n  float B = texture2D(uVelocity, vB).x;\\n  float vorticity = R - L - T + B;\\n  gl_FragColor = vec4(vorticity, 0.0, 0.0, 1.0);\\n}\"","module.exports = \"precision highp float;\\nprecision mediump sampler2D;\\n#define GLSLIFY 1\\nvarying vec2 vUv;\\nvarying vec2 vT;\\nvarying vec2 vB;\\nuniform sampler2D uVelocity;\\nuniform sampler2D uCurl;\\nuniform float curl;\\nuniform float dt;\\nvoid main() {\\n  float T = texture2D(uCurl, vT).x;\\n  float B = texture2D(uCurl, vB).x;\\n  float C = texture2D(uCurl, vUv).x;\\n  vec2 force = vec2(abs(T) - abs(B), 0.0);\\n  force *= 1.0 / length(force + 0.00001) * curl * C;\\n  vec2 vel = texture2D(uVelocity, vUv).xy;\\n  gl_FragColor = vec4(vel + force * dt, 0.0, 1.0);\\n}\"","module.exports = \"precision highp float;\\nprecision mediump sampler2D;\\n#define GLSLIFY 1\\nvarying vec2 vUv;\\nvarying vec2 vL;\\nvarying vec2 vR;\\nvarying vec2 vT;\\nvarying vec2 vB;\\nuniform sampler2D uPressure;\\nuniform sampler2D uDivergence;\\nvec2 boundary(in vec2 uv) {\\n  uv = min(max(uv, 0.0), 1.0);\\n  return uv;\\n}\\nvoid main() {\\n  float L = texture2D(uPressure, boundary(vL)).x;\\n  float R = texture2D(uPressure, boundary(vR)).x;\\n  float T = texture2D(uPressure, boundary(vT)).x;\\n  float B = texture2D(uPressure, boundary(vB)).x;\\n  float C = texture2D(uPressure, vUv).x;\\n  float divergence = texture2D(uDivergence, vUv).x;\\n  float pressure = (L + R + B + T - divergence) * 0.25;\\n  gl_FragColor = vec4(pressure, 0.0, 0.0, 1.0);\\n}\"","module.exports = \"precision highp float;\\nprecision mediump sampler2D;\\n#define GLSLIFY 1\\nvarying vec2 vUv;\\nvarying vec2 vL;\\nvarying vec2 vR;\\nvarying vec2 vT;\\nvarying vec2 vB;\\nuniform sampler2D uPressure;\\nuniform sampler2D uVelocity;\\nuniform sampler2D uWind;\\nuniform sampler2D uCells;\\n\\nvec2 boundary(in vec2 uv) {\\n  uv = min(max(uv, 0.0), 1.0);\\n  return uv;\\n}\\nvoid main() {\\n  float L = texture2D(uPressure, boundary(vL)).x;\\n  float R = texture2D(uPressure, boundary(vR)).x;\\n  float T = texture2D(uPressure, boundary(vT)).x;\\n  float B = texture2D(uPressure, boundary(vB)).x;\\n  vec2 velocity = texture2D(uVelocity, vUv).xy;\\n  vec2 wind = texture2D(uWind, vUv).xy;\\n  vec2 cell = texture2D(uCells, vec2(vUv.x, 1.0 - (vUv.y + (1.0 / 300.)))).xy;\\n  velocity.xy -= vec2(R - L, T - B);\\n  velocity.xy += wind * 25.;\\n\\n  int type = int((cell.r * 255.) + 0.1);\\n\\n  // || type == 7 || type == 9\\n  if (type == 1 || type == 5) {\\n    velocity = vec2(0.);\\n  }\\n  if (type == 0 || type == 4 || type == 6) {\\n\\n  } else {\\n    velocity = velocity * 0.95;\\n  }\\n  // velocity = cell.rg * 100.;\\n  gl_FragColor = vec4(velocity, 0.0, 1.0);\\n}\"","module.exports = \"precision highp float;\\nprecision mediump sampler2D;\\n#define GLSLIFY 1\\nvarying vec2 vUv;\\nuniform sampler2D uTexture;\\nuniform sampler2D uPressure;\\nvoid main() {\\n  vec2 v = texture2D(uTexture, vUv).rg;\\n  float p = texture2D(uPressure, vUv).r;\\n  vec3 vp = vec3(v, p);\\n  vp = max(vp, vec3(-250.));\\n  vp = min(vp, vec3(250.));\\n  vp /= 500.;\\n  vp += vec3(0.5, 0.5, 0.);\\n  // v = vec2(0.5);\\n  gl_FragColor = vec4(vp, 0.0);\\n}\\n\""],"sourceRoot":""}