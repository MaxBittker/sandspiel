{"version":3,"sources":["webpack:///./js/boot.js","webpack:///./js/api.js","webpack:///./js/render.js","webpack:///./js/fps.js","webpack:///./js/components/signinButton.js","webpack:///./js/components/promotab.js","webpack:///./js/convertSVG.js","webpack:///./js/components/menu.js","webpack:///./js/components/ui.js","webpack:///./js/paint.js","webpack:///./js/components/info.js","webpack:///./js/components/signin.js","webpack:///./js/components/hypertext.js","webpack:///./js/components/Post.js","webpack:///./js/components/browse.js","webpack:///./js/components/admin.js","webpack:///./js/fluidShaders.js","webpack:///./js/fluid.js","webpack:///./js/benchmark.js","webpack:///./js/components/benchmarkRunner.js","webpack:///./js/app.js","webpack:///./js/index.js","webpack:///./js/glsl/baseVertex.glsl","webpack:///./js/glsl/clear.glsl","webpack:///./js/glsl/display.glsl","webpack:///./js/glsl/splat.glsl","webpack:///./js/glsl/advectionManualFilter.glsl","webpack:///./js/glsl/advection.glsl","webpack:///./js/glsl/divergence.glsl","webpack:///./js/glsl/curl.glsl","webpack:///./js/glsl/vorticity.glsl","webpack:///./js/glsl/pressure.glsl","webpack:///./js/glsl/gradientSubtract.glsl","webpack:///./js/glsl/velocityOut.glsl","webpack:///./js/layout.js","webpack:///./crate/pkg/sandtable_bg.js","webpack:///./js/glsl/sand.glsl","webpack:///./js/glsl/sandVertex.glsl"],"names":["sleep","ms","Promise","resolve","setTimeout","width","height","a","x","window","u","paint","Math","floor","sin","random","Species","Sand","stopboot","Seed","firebase","initializeApp","apiKey","storageBucket","authDomain","projectId","appId","messagingSenderId","storage","functions","reglBuilder","require","fsh","vsh","startWebGL","canvas","universe","isSnapshot","regl","attributes","preserveDrawingBuffer","cell_pointer","cells","Uint8Array","memory","buffer","dataTexture","texture","data","drawSand","frag","uniforms","t","tick","resolution","viewportWidth","viewportHeight","dpi","devicePixelRatio","vert","position","count","poll","samples","gtag","dataLayer","push","arguments","fps","this","document","getElementById","frames","lastFrameTimeStamp","performance","now","delta","length","shift","min","Infinity","max","sum","i","mean","console","log","round","value","textContent","SignInButton","isSignedIn","expanded","signInFlow","signInOptions","provider","auth","EmailAuthProvider","PROVIDER_ID","signInMethod","EMAIL_LINK_SIGN_IN_METHOD","emailLinkSignIn","url","handleCodeInApp","callbacks","signInSuccessWithAuthResult","setState","currentUser","unregisterAuthObserver","onAuthStateChanged","user","state","uiConfig","firebaseAuth","onClick","style","display","FirebaseAuth","props","children","React","Component","PullTab","useState","open","setOpen","id","className","YouTube","videoId","opts","playerVars","href","target","src","rgbaToSpecies","r","g","b","h","l","Wall","Empty","hueIndex","lightnessIndex","colorsToSpecies","Fire","Lava","Rocket","Wood","Gas","Plant","Dust","Acid","Water","Ice","Stone","Oil","Fungus","Cloner","Mite","species","svgToImageData","svgString","reject","doc","DOMParser","parseFromString","querySelector","documentElement","setAttribute","svgStringSized","XMLSerializer","serializeToString","blob","Blob","type","img","createElement","addEventListener","ctx","getContext","translate","rotate","PI","scale","drawImage","imgData","getImageData","error","URL","createObjectURL","Menu","close","to","pallette_data","Object","values","filter","Number","isInteger","range","Universe","reset","forEach","render","readPixels","RGBA","UNSIGNED_BYTE","colors","index","color","pallette","sizeMap","Index","submissionMenuOpen","paused","submitting","size","dataURL","currentSubmission","selectedElement","UI","location","pathname","pause","load","prevProps","hash","event","preventDefault","confirm","play","toDataURL","snapshot","context","createImageData","y","cell_index","img_index","putImageData","cellData","postList","JSON","parse","localStorage","getItem","post","Date","Sentry","title","payload","replace","uid","image","parent_id","setItem","stringify","getIdToken","then","token","fetch","_url","method","body","headers","Authorization","res","json","response","cellsData","len","flush_undos","push_undo","refFromURL","getDownloadURL","dlurl","Image","onload","e","Fragment","togglePause","viewBox","points","includes","upload","map","v","key","setSize","padding","cx","cy","pop_undo","fontSize","name","keys","parseInt","n","setElement","elementID","selected","background","backgroundColor","ElementButton","incScore","score","closeMenu","maxlength","placeholder","onChange","disabled","rateLimited","submit","eventDistance","sqrt","pow","clientX","clientY","norm","mag","magnitude","s","add","painting","lastPaint","repeat","smoothPaint","clearInterval","setInterval","startEvent","step","d","cancelable","handleTouches","touches","Array","from","boundingRect","getBoundingClientRect","scaleX","ceil","scaleY","canvasLeft","left","canvasTop","top","Info","SignInScreen","alignItems","flexGrow","margin","search","emailVerified","email","signOut","HyperText","nodes","text","split","startsWith","slice","Post","submission","voteFromBrowse","browseVotes","report","redundent_parent_id","redundent_child_id","nextPost","setNextPost","childrenPosts","setChildrenPosts","displayTime","timestamp","toLocaleDateString","getTime","ago","format","hasParent","classnames","expandedTop","expandedBottom","storageUrl","active","wordWrap","childData","timeago","Submissions","nextProps","submissions","Browse","loadSubmissions","param","gridColumn","exact","onKeyDown","keyCode","history","withRouter","judge","user_id","reports","AdminBrowse","decidedIds","ruling","GoogleAuthProvider","signInWithRedirect","baseVertex","clearShaderString","displayShaderString","splatShaderString","advectionManualFilteringShaderString","advectionShaderString","divergenceShaderString","curlShaderString","vorticityShaderString","pressureShaderString","gradientSubtractShaderString","velocityOutShaderString","sandCanvas","fluidColor","isIOS","navigator","platform","userAgent","startFluid","isWebGL2","gui","config","TEXTURE_DOWNSAMPLE","DENSITY_DISSIPATION","VELOCITY_DISSIPATION","PRESSURE_DISSIPATION","PRESSURE_ITERATIONS","CURL","SPLAT_RADIUS","pointers","splatStack","halfFloat","supportLinearFiltering","params","alpha","depth","stencil","antialias","gl","getExtension","clearColor","formatRGBA","formatRG","formatR","halfFloatTexType","HALF_FLOAT","HALF_FLOAT_OES","getSupportedFormat","RGBA16F","RG16F","RG","R16F","RED","ext","getWebGLContext","compileShader","source","shader","createShader","shaderSource","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","baseVertexShader","VERTEX_SHADER","clearShader","FRAGMENT_SHADER","displayShader","splatShader","advectionManualFilteringShader","advectionShader","divergenceShader","curlShader","vorticityShader","pressureShader","gradientSubtractShader","velocityOutShader","compileShaders","internalFormat","createTexture","bindTexture","TEXTURE_2D","texParameteri","TEXTURE_MIN_FILTER","NEAREST","TEXTURE_MAG_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","texImage2D","fbo","createFramebuffer","bindFramebuffer","FRAMEBUFFER","framebufferTexture2D","COLOR_ATTACHMENT0","checkFramebufferStatus","FRAMEBUFFER_COMPLETE","supportRenderTextureFormat","pointerPrototype","dx","dy","down","moved","dat","Full","Half","Quarter","onFinishChange","initFramebuffers","fun","texWidth","texHeight","density","velocity","velocityOut","burns","divergence","curl","pressure","GLProgram","vertexShader","fragmentShader","program","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","uniformCount","ACTIVE_UNIFORMS","uniformName","getActiveUniform","getUniformLocation","useProgram","clearProgram","displayProgram","velocityOutProgram","splatProgram","advectionProgram","divergenceProgram","curlProgram","vorticityProgram","pressureProgram","gradientSubtractProgram","drawingBufferWidth","drawingBufferHeight","texType","rgba","rg","createDoubleFBO","LINEAR","createFBO","texId","w","activeTexture","TEXTURE0","viewport","clear","COLOR_BUFFER_BIT","fbo1","fbo2","swap","temp","blit","bindBuffer","ARRAY_BUFFER","createBuffer","bufferData","Float32Array","STATIC_DRAW","ELEMENT_ARRAY_BUFFER","Uint16Array","pbo","PIXEL_PACK_BUFFER","vertexAttribPointer","FLOAT","enableVertexAttribArray","destination","drawElements","TRIANGLES","UNSIGNED_SHORT","lastTime","winds","burnsData","sync","undefined","splat","bind","texUnit","read","uniform1i","uTarget","uniform1f","aspectRatio","uniform2f","point","uniform3f","radius","write","resize","targetTouches","pointer","identifier","changedTouches","j","update","dt","amount","multipleSplats","pressureTexId","uVelocity","uSource","texelSize","dissipation","uWind","uCurl","uTexture","uDivergence","uPressure","fenceSync","SYNC_GPU_COMMANDS_COMPLETE","status","clientWaitSync","ALREADY_SIGNALED","CONDITION_SATISFIED","getBufferSubData","uCells","trial","m","fluid","t0","cpuTime","fluidTime","tcpu0","tcpu1","t1","runTest","cpuSum","cpuMin","cpuMax","fluidSum","fluidMin","fluidMax","world","Air","f","setup","toPrecision","dev","cDev","fDev","BenchmarkRunner","lines","show","run","addLogLine","newline","line","join","BrowseRouter","match","AdminRouter","SigninRouter","AppRouter","path","component","ReactDOM","host","dsn","integrations","Integrations","BrowserTracing","WasmIntegration","tracesSampleRate","check","isBench","safari","pushState","onpopstate","go","vendor","opera","test","substr","onbeforeunload","serviceWorker","register","registration","registrationError","renderLoop","animationId","requestAnimationFrame","boot","ctrlKey","metaKey","clipboardData","getData","loadSVG","adsbygoogle","module","exports","canvas2","ui","screen_width","innerWidth","canvasStyle","uiStyle","adStyle","innerHeight","getElementsByClassName","btnHeight","cachedTextDecoder","TextDecoder","ignoreBOM","fatal","decode","cachegetUint8Memory0","getStringFromWasm0","ptr","wasm","subarray","what","freeze","__destroy_into_raw","obj","create","prototype","ret","__wrap","__wbg_random_ca8b31dc0375c2d4","Error","__wbindgen_throw","arg0","arg1"],"mappings":"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","file":"2.b611a7204b208377c966.js","sourcesContent":["import { Species } from \"../crate/pkg\";\n\nfunction sleep(ms) {\n  return new Promise((resolve) => setTimeout(resolve, ms));\n}\n\nasync function boot(width, height) {\n  //   for (let r = 0; r <= width * 1.7; r += 28) {\n  //     for (let s = 6; s >= 1; s -= 1) {\n  //       let rr = r - s * 4;\n  //       window.u.paint(width / 2, height / 2, rr + 5, Species.Sand);\n  //       window.u.paint(width / 2, height / 2, rr, Species.Empty);\n  //       await sleep(16);\n  //     }\n  //   }\n\n  //   for (let x = 5; x <= width - 5; x += Math.random() * 9) {\n  //     window.u.paint(\n  //       x,\n  //       Math.floor(height - 40 + 20 * Math.sin(x / 50)),\n  //       3,\n  //       Species.Stone\n  //     );\n  //     await sleep(2);\n  //   }\n  for (let x = 5; x <= width - 5; x += 10) {\n    window.u.paint(\n      x,\n      Math.floor(height - 40 + 5 * Math.sin(x / 20)),\n      Math.random() * 6 + 10,\n      Species.Sand\n    );\n    // window.u.paint(\n    //   width - x,\n    //   Math.floor(height - 40 + 5 * Math.sin(x / 20)),\n    //   Math.random() * 6 + 10,\n    //   Species.Sand\n    // );\n    if (window.stopboot) return;\n    await sleep(16);\n  }\n  for (let x = 40; x <= width - 40; x += 50 + Math.random() * 10) {\n    window.u.paint(\n      x,\n      Math.floor(height / 2 + 20 * Math.sin(x / 20)),\n      6,\n      Species.Seed\n    );\n    if (window.stopboot) return;\n\n    await sleep(180);\n  }\n\n  //   for (let a = 0; a <= 180; a += 4) {\n  //     let x = (width / 3 + 10) * Math.cos(a * (Math.PI / 180));\n  //     let y = (height / 3 + 10) * Math.sin(a * (Math.PI / 180));\n  //     window.u.paint(width / 2 + x, height / 2 + y, 21, Species.Sand);\n  //     window.u.paint(width / 2 - x, height / 2 - y, 21, Species.Sand);\n  //     await sleep(8);\n  //   }\n}\nfunction drawBowl() {\n  window.u.paint(h, h, d + 2, Species.Sand);\n  window.u.paint(h, h, d - 2, Species.Empty);\n}\n\nexport { sleep, boot };\n","// Firebase App (the core Firebase SDK) is always required and must be listed first\nimport firebase from \"firebase/app\";\n\n// Add the Firebase products that you want to use\nimport \"firebase/auth\";\nimport \"firebase/storage\";\nimport \"firebase/functions\";\n\nwindow.firebase = firebase;\n\nfirebase.initializeApp({\n  apiKey: \"AIzaSyD2APPEyxCi9vB2olvUgzSsbgH1Pyz-as0\",\n  storageBucket: \"sandtable-8d0f7.appspot.com\",\n  authDomain: \"sandspiel.club\",\n  projectId: \"sandtable-8d0f7\",\n  appId: \"1:239719651525:web:80d3674408670521\",\n  messagingSenderId: \"239719651525\",\n});\n\nconst storage = firebase.storage();\nconst functions = firebase.functions();\n\n// functions.useEmulator(\"localhost\", 5001);\n\nexport { functions, storage };\n","const reglBuilder = require(\"regl\");\nimport { memory } from \"../crate/pkg/sandtable_bg\";\nimport { Species } from \"../crate/pkg/sandtable\";\nimport { Universe } from \"../crate/pkg\";\n\nlet fsh = require(\"./glsl/sand.glsl\");\nlet vsh = require(\"./glsl/sandVertex.glsl\");\n\nlet startWebGL = ({ canvas, universe, isSnapshot = false }) => {\n  const regl = reglBuilder({\n    canvas,\n    attributes: { preserveDrawingBuffer: isSnapshot },\n  });\n  // const lastFrame = regl.texture();\n  const width = universe.width();\n  const height = universe.height();\n  let cell_pointer = universe.cells();\n  let cells = new Uint8Array(memory.buffer, cell_pointer, width * height * 4);\n  const dataTexture = regl.texture({ width, height, data: cells });\n\n  let drawSand = regl({\n    frag: fsh,\n    uniforms: {\n      t: ({ tick }) => tick,\n      data: () => {\n        // if (cell_pointer != universe.cells()) {\n        //   console.log(cell_pointer);\n        // }\n        cell_pointer = universe.cells();\n        cells = new Uint8Array(memory.buffer, cell_pointer, width * height * 4);\n        // }\n\n        return dataTexture({ width, height, data: cells });\n      },\n      resolution: ({ viewportWidth, viewportHeight }) => [\n        viewportWidth,\n        viewportHeight,\n      ],\n      dpi: window.devicePixelRatio * 2,\n      isSnapshot,\n      // backBuffer: lastFrame\n    },\n\n    vert: vsh,\n    attributes: {\n      // Full screen triangle\n      position: [\n        [-1, 4],\n        [-1, -1],\n        [4, -1],\n      ],\n    },\n    // Our triangle has 3 vertices\n    count: 3,\n  });\n\n  return () => {\n    regl.poll();\n    drawSand();\n  };\n};\n\nlet snapshot = (universe) => {\n  let canvas = document.createElement(\"canvas\");\n  canvas.width = universe.width() / 2;\n  canvas.height = universe.height() / 2;\n  let render = startWebGL({ universe, canvas, isSnapshot: true });\n  render();\n\n  return canvas.toDataURL(\"image/png\");\n};\n\nlet pallette = () => {\n  let canvas = document.createElement(\"canvas\");\n\n  let species = Object.values(Species).filter((x) => Number.isInteger(x));\n  let range = Math.max(...species) + 1;\n  let universe = Universe.new(range, 1);\n  canvas.width = 3;\n  canvas.height = range;\n  universe.reset();\n\n  species.forEach((id) => universe.paint(id, 0, 1, id));\n\n  let render = startWebGL({ universe, canvas, isSnapshot: true });\n  render();\n  let ctx = canvas.getContext(\"webgl\");\n  let data = new Uint8Array(range * 4);\n  ctx.readPixels(0, 0, 1, range, ctx.RGBA, ctx.UNSIGNED_BYTE, data);\n  let colors = {};\n  species.forEach((id) => {\n    let index = (range - 1 - id) * 4;\n    let color = `rgba(${data[index]},${data[index + 1]}, ${\n      data[index + 2]\n    }, 0.25)`;\n    colors[id] = color;\n  });\n  return colors;\n};\n\nexport { startWebGL, snapshot, pallette };\n","let samples = 600;\n\nwindow.dataLayer = window.dataLayer || [];\n\nfunction gtag() {\n  dataLayer.push(arguments);\n}\n\nconst fps = new (class {\n  constructor() {\n    this.fps = document.getElementById(\"fps\");\n    this.frames = [];\n    this.lastFrameTimeStamp = performance.now();\n  }\n\n  render() {\n    // Convert the delta time since the last frame render into a measure\n    // of frames per second.\n    const now = performance.now();\n    const delta = now - this.lastFrameTimeStamp;\n    this.lastFrameTimeStamp = now;\n    const fps = (1 / delta) * 1000;\n\n    // Save only the latest 100 timings.\n    this.frames.push(fps);\n    if (this.frames.length > 30) {\n      this.frames.shift();\n    }\n\n    // Find the max, min, and mean of our 100 latest timings.\n    let min = Infinity;\n    let max = -Infinity;\n    let sum = 0;\n    for (let i = 0; i < this.frames.length; i++) {\n      sum += this.frames[i];\n      min = Math.min(this.frames[i], min);\n      max = Math.max(this.frames[i], max);\n    }\n    let mean = sum / this.frames.length;\n    samples--;\n    if (samples === 0) {\n      console.log(`sending fps ${Math.round(mean)} to ga`);\n      gtag(\"event\", \"fps\", {\n        value: Math.round(mean),\n      });\n      if (mean < 50) {\n        gtag(\"event\", \"fps-L50\", {\n          value: Math.round(mean),\n        });\n      }\n\n      if (mean < 40) {\n        gtag(\"event\", \"fps-L40\", {\n          value: Math.round(mean),\n        });\n      }\n      if (mean < 30) {\n        gtag(\"event\", \"fps-L30\", {\n          value: Math.round(mean),\n        });\n      }\n      if (mean < 20) {\n        gtag(\"event\", \"fps-L20\", {\n          value: Math.round(mean),\n        });\n      }\n    }\n    // Render the statistics.\n    this.fps.textContent = `FPS:${Math.round(mean)}`;\n  }\n})();\n\nexport { fps };\n","import React from \"react\";\n\nimport FirebaseAuth from \"react-firebaseui/FirebaseAuth\";\n\nclass SignInButton extends React.Component {\n  // The component's Local state.\n  state = {\n    isSignedIn: false, // Local signed-in state.\n    expanded: true,\n  };\n\n  // Configure FirebaseUI.\n  uiConfig = {\n    // Popup signin flow rather than redirect flow.\n    signInFlow: \"redirect\",\n    signInOptions: [\n      // firebase.auth.GoogleAuthProvider.PROVIDER_ID,\n      // {\n      //   provider: firebase.auth.EmailAuthProvider.PROVIDER_ID,\n      //   requireDisplayName: false,\n      // },\n      {\n        provider: firebase.auth.EmailAuthProvider.PROVIDER_ID,\n        signInMethod: firebase.auth.EmailAuthProvider.EMAIL_LINK_SIGN_IN_METHOD,\n        emailLinkSignIn: function () {\n          return {\n            // Additional state showPromo=1234 can be retrieved from URL on\n            // sign-in completion in signInSuccess callback by checking\n            // window.location.href.\n            url: \"https://sandspiel.club/browse\",\n            // Custom FDL domain.\n            // Always true for email link sign-in.\n            handleCodeInApp: true,\n          };\n        },\n      },\n      // firebase.auth.FacebookAuthProvider.PROVIDER_ID\n    ],\n    callbacks: {\n      // Avoid redirects after sign-in.\n      signInSuccessWithAuthResult: () => false,\n    },\n  };\n\n  // Listen to the Firebase Auth state and set the local state.\n  componentDidMount() {\n    this.setState({ isSignedIn: !!firebase.auth().currentUser });\n\n    this.unregisterAuthObserver = firebase\n      .auth()\n      .onAuthStateChanged((user) => this.setState({ isSignedIn: !!user }));\n  }\n\n  // Make sure we un-register Firebase observers when the component unmounts.\n  componentWillUnmount() {\n    this.unregisterAuthObserver();\n  }\n\n  render() {\n    if (!this.state.isSignedIn) {\n      if (!this.state.expanded) {\n        return (\n          <span>\n            <p>\n              Please{\" \"}\n              <button onClick={() => this.setState({ expanded: true })}>\n                Sign in\n              </button>{\" \"}\n              to vote!{\" \"}\n            </p>\n            <span style={{ display: \"none\" }}>\n              {/* gross hack for completing login */}\n              <FirebaseAuth\n                uiConfig={this.uiConfig}\n                FirebaseAuth={firebase.auth()}\n              />\n            </span>\n          </span>\n        );\n      } else {\n        return (\n          <div>\n            <p>Sign-in to post!</p>\n            <FirebaseAuth\n              uiConfig={this.uiConfig}\n              firebaseAuth={firebase.auth()}\n            />\n          </div>\n        );\n      }\n    }\n    let { currentUser } = firebase.auth();\n\n    return <>{this.props.children}</>;\n  }\n}\n\nexport default SignInButton;\n","import React, { useState } from \"react\";\n// import \"./styles.css\";\nimport YouTube from \"react-youtube\";\n\nexport default function PullTab() {\n  let [open, setOpen] = useState(\"\");\n  return (\n    <div id=\"PullTabContent\" className={open}>\n      {/* <img\n        id=\"logo\"\n        src=\"assets/SSStudio ColorLined Big.svg\"\n        alt=\"SANDSPIEL STUDIO\"\n      /> */}\n      <YouTube\n        videoId=\"ecCVor7mJ6o\"\n        opts={{\n          height: \"255\",\n          width: \"455\",\n          playerVars: {\n            // https://developers.google.com/youtube/player_parameters\n          },\n        }}\n      />{\" \"}\n      Explore infinite new elements and create your own worlds in Sandspiel\n      Studio!\n      <a className=\"CTA\" href=\"https://studio.sandspiel.club/\">\n        {\" \"}\n        Try Sandspiel Studio\n      </a>\n      <br></br>\n      <p>\n        See also: <br></br>\n        <a href=\"https://orb.farm\" target=\"_blank\">\n          orb.farm\n        </a>\n        <img src=\"https://orb.farm/assets/favicon.ico\" className=\"link-icon\" />\n        <br></br>\n        <a href=\"https://castle.xyz\" target=\"_blank\">\n          Castle: Make games on your phone\n        </a>\n        <img src=\"assets/castle-icon-onwhite.png\" className=\"link-icon\" />\n      </p>\n      <div\n        id=\"PullTab\"\n        onClick={() => {\n          if (open == \"open\") {\n            setOpen(\"dismissed\");\n          } else {\n            setOpen(\"open\");\n          }\n        }}\n      >\n        <img src=\"assets/tab.png\"></img>\n      </div>\n    </div>\n  );\n}\n","import { Species } from \"../crate/pkg/sandtable\";\n\nexport function rgbaToSpecies(r, g, b, a) {\n  // Transparent to Empty\n  if (a < 250) {\n    return 0;\n  }\n\n  r /= 255;\n  g /= 255;\n  b /= 255;\n\n  // https://github.com/Qix-/color-convert/blob/master/conversions.js#L58\n  const min = Math.min(r, g, b);\n  const max = Math.max(r, g, b);\n  const delta = max - min;\n  let h;\n  let s;\n\n  if (max === min) {\n    h = 0;\n  } else if (r === max) {\n    h = (g - b) / delta;\n  } else if (g === max) {\n    h = 2 + (b - r) / delta;\n  } else if (b === max) {\n    h = 4 + (r - g) / delta;\n  }\n\n  h = Math.min(h * 60, 360);\n\n  if (h < 0) {\n    h += 360;\n  }\n\n  const l = (min + max) / 2;\n\n  if (max === min) {\n    s = 0;\n  } else if (l <= 0.5) {\n    s = delta / (max + min);\n  } else {\n    s = delta / (2 - max - min);\n  }\n\n  // Greyscale options\n  if (s < 0.05) {\n    // Black to Wall\n    if (l < 0.05) {\n      return Species.Wall;\n    }\n    // White to Empty\n    if (l > 0.95) {\n      return Species.Empty;\n    }\n    // Light grey to Sand\n    if (l > 0.5) {\n      return Species.Sand;\n    }\n  }\n\n  // Color options\n  let hueIndex = Math.floor((h + 25.7) / 360 * 7);\n  let lightnessIndex = Math.floor(l * 4 - 0.25);\n\n  const colorsToSpecies = [\n    [ Species.Fire, Species.Lava, Species.Rocket], // Red\n    [ Species.Wood, null, Species.Gas], // Yellow\n    [ Species.Plant, Species.Dust, Species.Acid], // Green\n    [ Species.Plant, Species.Dust, Species.Acid ], // Green2: duplicate b/c they are perceptually close\n    [ Species.Water, Species.Ice, Species.Stone ], // Blue\n    [ Species.Oil, Species.Seed, Species.Fungus], // Purple\n    [ Species.Cloner, Species.Mite, null ], // Violet\n  ];\n\n  const species = colorsToSpecies?.[hueIndex]?.[lightnessIndex];\n\n  return species ? species : Species.Empty;\n}\n\nexport async function svgToImageData (svgString) {\n  const width = 300;\n  const height = 300;\n\n  return new Promise((resolve, reject) => {\n    const parser = new DOMParser();\n    const doc = parser.parseFromString(svgString, \"image/svg+xml\");\n  \n    const errorNode = doc.querySelector(\"parsererror\");\n    if (errorNode) {\n      reject(\"Error while parsing SVG.\");\n      return;\n    } \n    \n    // We want to fit any pasted SVG to the default Sandspiel universe size.\n    doc.documentElement.setAttribute(\"width\", width + \"px\");\n    doc.documentElement.setAttribute(\"height\", height + \"px\");\n  \n    const serializer = new XMLSerializer();\n    const svgStringSized = serializer.serializeToString(doc);\n\n    // Load the SVG into an image element\n    const blob = new Blob([svgStringSized], {type: 'image/svg+xml'});\n    const img = document.createElement(\"img\");\n    img.width = width;\n    img.height = height;\n  \n    img.addEventListener(\"load\", () => {\n      // Then we write the image pixels to a canvas.\n      const canvas = document.createElement(\"canvas\");\n      canvas.width = width;\n      canvas.height = height;\n      const ctx = canvas.getContext(\"2d\");\n      \n      // Transform context to match Sandspiel Universe\n      ctx.translate(canvas.width / 2, canvas.height / 2);\n      ctx.rotate((-90 * Math.PI) / 180);\n      ctx.scale(-1, 1.0);\n      ctx.translate(-canvas.width / 2, -canvas.height / 2);\n  \n      ctx.drawImage(img, 0, 0);\n  \n      const imgData = ctx.getImageData(0, 0, width, height);\n      resolve(imgData);\n    });\n\n    img.addEventListener('error', function (error) {\n      reject(error);\n    })\n\n    img.src = URL.createObjectURL(blob);\n  });\n}","import React from \"react\";\nimport { Link } from \"react-router-dom\";\n\nconst Menu = ({ close, children }) => {\n  return (\n    <div className=\"menu-scrim\">\n      <div className={\"menu\"}>\n        {children}\n        <Link to=\"/\" className=\"x\" onClick={close}>\n          <button> x</button>\n        </Link>\n      </div>\n    </div>\n  );\n};\nexport default Menu;\n","import React from \"react\";\nimport { Link } from \"react-router-dom\";\nimport * as Sentry from \"@sentry/browser\";\n\nimport { memory } from \"../../crate/pkg/sandtable_bg\";\nimport { Species } from \"../../crate/pkg/sandtable\";\n\nimport { height, universe, width, reset } from \"../index.js\";\nimport { snapshot, pallette } from \"../render.js\";\nimport { functions, storage } from \"../api.js\";\nimport SignInButton from \"./signinButton.js\";\nimport Promotab from \"./promotab\";\nimport { svgToImageData, rgbaToSpecies } from \"../convertSVG\";\n\nimport Menu from \"./menu\";\n\nwindow.species = Species;\nlet pallette_data = pallette();\n\nconst ElementButton = (name, selectedElement, setElement) => {\n  let elementID = Species[name];\n\n  let color = pallette_data[elementID];\n  let selected = elementID == selectedElement;\n\n  let background = \"inherit\";\n  if (elementID == 14) {\n    background = `linear-gradient(45deg, \n    rgba(202, 121, 125, 0.25), \n    rgba(169, 120, 200, 0.25), \n    rgba(117, 118, 195, 0.25), \n    rgba(117, 196, 193, 0.25), \n    rgba(122, 203, 168, 0.25), \n    rgba(185, 195, 117, 0.25), \n    rgba(204, 186, 122, 0.25))`;\n    if (selected) {\n      background = background.replace(/0.25/g, \"1.0\");\n    }\n  }\n  return (\n    <button\n      className={selected ? \"selected\" : \"\"}\n      key={name}\n      onClick={() => {\n        setElement(elementID);\n      }}\n      style={{\n        background,\n        backgroundColor: selected ? color.replace(\"0.25\", \"1.5\") : color,\n      }}\n    >\n      {\"  \"}\n      {name}\n      {\"  \"}\n    </button>\n  );\n};\n\nlet sizeMap = [1, 3, 7, 19, 39];\n\nclass Index extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      submissionMenuOpen: false,\n      paused: false,\n      submitting: false,\n      size: 2,\n      dataURL: {},\n      currentSubmission: null,\n      selectedElement: Species.Water,\n    };\n    window.UI = this;\n    //if we start in the background, pause;\n    if (\n      this.props.location.pathname !== \"/\" &&\n      this.props.location.pathname !== \"/school\"\n    ) {\n      window.setTimeout(() => this.pause(), 50);\n    }\n\n    this.load();\n  }\n\n  componentDidUpdate(prevProps) {\n    if (\n      this.props.location.pathname === \"/\" &&\n      prevProps.location.pathname !== \"/\" &&\n      this.state.currentSubmission\n    ) {\n      window.location = `#${this.state.currentSubmission.id}`;\n      return;\n    }\n    if (\n      this.props.location.pathname !== \"/\" &&\n      prevProps.location.pathname == \"/\"\n    ) {\n      this.pause();\n    }\n    if (\n      prevProps.location.hash === \"\" ||\n      prevProps.location.hash != this.props.location.hash\n    ) {\n      this.load();\n    }\n  }\n  togglePause() {\n    window.paused = !this.state.paused;\n    this.setState({ paused: !this.state.paused });\n  }\n  play() {\n    window.paused = false;\n    this.setState({ paused: false });\n  }\n  pause() {\n    window.paused = true;\n    this.setState({ paused: true });\n  }\n\n  setSize(event, size) {\n    event.preventDefault();\n    this.setState({\n      size,\n    });\n  }\n  reset() {\n    if (window.confirm(\"Are you sure you want to reset?\")) {\n      this.play();\n      window.location = \"#\";\n      this.setState({ currentSubmission: null });\n      reset();\n    }\n  }\n  menu() {\n    this.pause();\n    this.setState({ submissionMenuOpen: true });\n  }\n\n  closeMenu() {\n    this.play();\n    this.setState({ submissionMenuOpen: false });\n  }\n  upload() {\n    let dataURL = snapshot(universe);\n    const cells = new Uint8Array(\n      memory.buffer,\n      universe.cells(),\n      width * height * 4\n    );\n\n    // Create canvas\n    let canvas = document.createElement(\"canvas\"),\n      context = canvas.getContext(\"2d\"),\n      imgData = context.createImageData(width, height);\n\n    canvas.height = height;\n    canvas.width = width;\n\n    // fill imgData with data from cells\n    // transpose for historical compatability\n    for (let x = 0; x < width; x++) {\n      for (let y = 0; y < height; y++) {\n        let cell_index = (y + x * height) * 4;\n        let img_index = (x + y * width) * 4;\n        for (var i = 0; i < 4; i++) {\n          if (i % 4 == 3) {\n            imgData.data[img_index + i] = 255;\n          } else {\n            imgData.data[img_index + i] = cells[cell_index + i];\n          }\n        }\n      }\n    }\n    // put data to context at (0, 0)\n    context.putImageData(imgData, 0, 0);\n\n    let cellData = canvas.toDataURL(\"image/png\");\n\n    this.pause();\n    this.setState({\n      data: { dataURL, cells: cellData },\n      submissionMenuOpen: true,\n    });\n  }\n  rateLimited() {\n    var postList = JSON.parse(localStorage.getItem(\"postList\") || \"[]\");\n    postList = postList.filter((post) => Date.now() - 1000 * 60 * 5 < post);\n\n    if (postList.length >= 3) {\n      Sentry.captureMessage(\"RATELIMIT\");\n      return true;\n    }\n    return false;\n  }\n  submit() {\n    let { title, data, currentSubmission } = this.state;\n\n    let { dataURL, cells } = data;\n    let { currentUser } = firebase.auth();\n    title = title.replace(\n      \"[profile]\",\n      `https://sandspiel.club/browse/search/?user=${currentUser.uid}`\n    );\n\n    let payload = {\n      title,\n      image: dataURL,\n      parent_id: currentSubmission?.data?.id,\n      cells,\n    };\n\n    var postList = JSON.parse(localStorage.getItem(\"postList\") || \"[]\");\n\n    postList = postList.filter((post) => Date.now() - 1000 * 60 * 3 < post);\n    postList.push(Date.now());\n    localStorage.setItem(\"postList\", JSON.stringify(postList));\n\n    this.setState({ submitting: true });\n    currentUser.getIdToken().then((token) => {\n      fetch(functions._url(\"api/creations\"), {\n        method: \"POST\",\n        body: JSON.stringify(payload), // data can be `string` or {object}!\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: \"Bearer \" + token,\n        },\n      })\n        .then((res) => res.json())\n        .then((response) => {\n          console.log(\"Success:\", JSON.stringify(response));\n          this.play();\n        })\n        .catch((error) => console.error(\"Error:\", error))\n        .then(() => {\n          this.setState({ submissionMenuOpen: false, submitting: false });\n        });\n    });\n  }\n\n  async loadSVG(svgString) {\n    const imgData = await svgToImageData(svgString);\n\n    const cellsData = new Uint8Array(\n      memory.buffer,\n      universe.cells(),\n      width * height * 4\n    );\n\n    reset();\n    window.stopboot = true;\n\n    for (let i = 0, len = width * height * 4; i < len; i += 4) {\n      const species = rgbaToSpecies(\n        imgData.data[i],\n        imgData.data[i + 1],\n        imgData.data[i + 2],\n        imgData.data[i + 3]\n      );\n      cellsData[i] = species; // should be 0 to 19\n      cellsData[i + 1] = Math.floor(100 + Math.random() * 50); // register A\n      cellsData[i + 2] = 0; // register B\n      cellsData[i + 3] = 0; // clock\n    }\n    universe.flush_undos();\n    universe.push_undo();\n\n    this.pause();\n  }\n\n  load() {\n    let { location } = this.props;\n    let id = location.hash.replace(/#/, \"\");\n    if (id === \"\") {\n      return;\n    }\n\n    if (this.state.currentSubmission && this.state.currentSubmission.id == id) {\n      return;\n    }\n\n    fetch(functions._url(`api/creations/${id}`), {\n      method: \"GET\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n    })\n      .then((res) => res.json())\n      .then((data) => {\n        storage\n          .refFromURL(\n            `gs://sandtable-8d0f7.appspot.com/creations/${data.id}.data.png`\n          )\n          .getDownloadURL()\n          .then((dlurl) => {\n            fetch(dlurl, {\n              method: \"GET\",\n            })\n              .then((res) => res.blob())\n              .then((blob) => {\n                this.setState({ currentSubmission: { id, data } });\n\n                var url = URL.createObjectURL(blob);\n                var img = new Image();\n                img.src = url;\n                img.onload = () => {\n                  var canvas = document.createElement(\"canvas\");\n                  canvas.width = width;\n                  canvas.height = height;\n                  var ctx = canvas.getContext(\"2d\");\n\n                  ctx.translate(canvas.width / 2, canvas.height / 2);\n                  ctx.rotate((-90 * Math.PI) / 180);\n                  ctx.scale(-1, 1.0);\n                  ctx.translate(-canvas.width / 2, -canvas.height / 2);\n\n                  ctx.drawImage(img, 0, 0);\n                  var imgData = ctx.getImageData(\n                    0,\n                    0,\n                    canvas.width,\n                    canvas.height\n                  );\n\n                  const cellsData = new Uint8Array(\n                    memory.buffer,\n                    universe.cells(),\n                    width * height * 4\n                  );\n\n                  reset();\n                  window.stopboot = true;\n\n                  for (var i = 0; i < width * height * 4; i++) {\n                    cellsData[i] = imgData.data[i];\n                  }\n                  universe.flush_undos();\n                  universe.push_undo();\n                  this.pause();\n                };\n              })\n              .catch((error) => console.error(\"Error:\", error));\n          });\n      })\n      .catch((error) => {\n        console.error(\"Error:\", error);\n      });\n  }\n  incScore() {\n    let { currentSubmission } = this.state;\n    let { id } = currentSubmission;\n    // creations/:id/vote\n    firebase\n      .auth()\n      .currentUser.getIdToken()\n      .then((token) => {\n        fetch(functions._url(`api/creations/${id}/vote`), {\n          method: \"PUT\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n            Authorization: \"Bearer \" + token,\n          },\n        })\n          .then((res) => res.json())\n          .then((data) => {\n            if (currentSubmission != null) {\n              this.setState({\n                currentSubmission: { ...currentSubmission, data },\n              });\n            }\n          })\n          .catch((e) => {\n            console.error(e);\n          });\n      });\n  }\n\n  render() {\n    let { size, paused, selectedElement, currentSubmission } = this.state;\n    let hash =\n      currentSubmission && currentSubmission.id\n        ? `#${currentSubmission.id}`\n        : \"\";\n    return (\n      <React.Fragment>\n        <Promotab />\n        <button\n          onClick={() => this.togglePause()}\n          className={paused ? \"selected\" : \"\"}\n        >\n          {paused ? (\n            <svg height=\"20\" width=\"20\" id=\"d\" viewBox=\"0 0 300 300\">\n              <polygon id=\"play\" points=\"0,0 , 300,150 0,300\" />\n            </svg>\n          ) : (\n            <svg height=\"20\" width=\"20\" id=\"d\" viewBox=\"0 0 300 300\">\n              <polygon id=\"bar2\" points=\"0,0 110,0 110,300 0,300\" />\n              <polygon id=\"bar1\" points=\"190,0 300,0 300,300 190,300\" />\n            </svg>\n          )}\n        </button>\n\n        {!window.location.pathname.includes(\"school\") && (\n          <>\n            <button onClick={() => this.upload()}>Upload</button>\n            <Link\n              to={{\n                pathname: \"/browse/\",\n                hash,\n              }}\n            >\n              <button>Browse</button>\n            </Link>\n          </>\n        )}\n\n        <button onClick={() => this.reset()}>Reset</button>\n        <Link\n          to={{\n            pathname: \"/info/\",\n            hash,\n          }}\n        >\n          <button>Info</button>\n        </Link>\n\n        {/* {paused && <button onClick={() => universe.tick()}>Tick</button>} */}\n        <span className=\"sizes\">\n          {sizeMap.map((v, i) => (\n            <button\n              key={i}\n              className={i == size ? \"selected\" : \"\"}\n              onClick={(e) => this.setSize(e, i)}\n              style={{ padding: \"0px\" }}\n            >\n              <svg height=\"23\" width=\"23\" id=\"d\" viewBox=\"0 0 100 100\">\n                <circle cx=\"50\" cy=\"50\" r={3 + v} />\n              </svg>\n            </button>\n          ))}\n        </span>\n        <button\n          onClick={() => {\n            reset();\n            universe.pop_undo();\n          }}\n          style={{ fontSize: 35 }}\n        >\n          \n        </button>\n        <button\n          className={-1 == selectedElement ? \"selected\" : \"\"}\n          key={name}\n          onClick={() => {\n            this.setState({ selectedElement: -1 });\n          }}\n        >\n          Wind\n        </button>\n        {Object.keys(Species)\n          .filter((x) => !Number.isInteger(Number.parseInt(x)))\n          .map((n) =>\n            ElementButton(n, selectedElement, (id) =>\n              this.setState({ selectedElement: id })\n            )\n          )}\n        {/* <span className=\"promo\">\n          *new*{\" \"}\n          <a href=\"https://orb.farm\" target=\"_blank\">\n            orb.farm\n          </a>\n        </span> */}\n        {this.state.currentSubmission && (\n          <div className=\"submission-title\">\n            <button onClick={() => this.incScore()}>\n              +{this.state.currentSubmission.data.score}{\" \"}\n            </button>\n            {this.state.currentSubmission.data.title}\n          </div>\n        )}\n\n        {this.state.submissionMenuOpen && (\n          <Menu close={() => this.closeMenu()}>\n            <h4>Share your creation with the people! (try using #hashtags)</h4>\n            <p>\n              Please be nice. Users who post hateful or sexually explicit\n              content will be banned.\n            </p>\n            <img src={this.state.data.dataURL} className=\"submissionImg\" />\n            <SignInButton>\n              <div style={{ display: \"flex\" }}>\n                <input\n                  maxlength=\"200\"\n                  placeholder=\"Title\"\n                  onChange={(e) => this.setState({ title: e.target.value })}\n                />\n                <button\n                  disabled={this.state.submitting || this.rateLimited()}\n                  onClick={() => this.submit()}\n                >\n                  Submit\n                </button>\n              </div>\n            </SignInButton>\n          </Menu>\n        )}\n      </React.Fragment>\n    );\n  }\n}\n\nexport { sizeMap, Index };\n","import { height, universe, width } from \"./index.js\";\nimport { sizeMap } from \"./components/ui\";\nconst canvas = document.getElementById(\"sand-canvas\");\n\nconst eventDistance = (a, b) => {\n  return Math.sqrt(\n    Math.pow(a.clientX - b.clientX, 2) + Math.pow(a.clientY - b.clientY, 2),\n    2\n  );\n};\n\nconst magnitude = (a) => {\n  return Math.sqrt(Math.pow(a.clientX, 2) + Math.pow(a.clientY, 2), 2);\n};\n\nconst norm = (a) => {\n  let mag = magnitude(a);\n  return { clientX: a.clientX / mag, clientY: a.clientY / mag };\n};\nconst scale = (a, s) => {\n  return { clientX: a.clientX * s, clientY: a.clientY * s };\n};\nconst add = (a, b) => {\n  return { clientX: a.clientX + b.clientX, clientY: a.clientY + b.clientY };\n};\nconst sub = (a, b) => {\n  return { clientX: a.clientX - b.clientX, clientY: a.clientY - b.clientY };\n};\n\nlet painting = false;\nlet lastPaint = null;\nlet repeat = null;\n\ncanvas.addEventListener(\"mousedown\", (event) => {\n  event.preventDefault();\n  universe.push_undo();\n  painting = true;\n  clearInterval(repeat);\n  repeat = window.setInterval(() => paint(event), 100);\n  paint(event);\n  lastPaint = event;\n});\n\ndocument.body.addEventListener(\"mouseup\", (event) => {\n  clearInterval(repeat);\n  if (painting) {\n    event.preventDefault();\n    lastPaint = null;\n    painting = false;\n  }\n});\n\ncanvas.addEventListener(\"mousemove\", (event) => {\n  clearInterval(repeat);\n  smoothPaint(event);\n});\n\ncanvas.addEventListener(\"mouseleave\", (event) => {\n  clearInterval(repeat);\n  lastPaint = null;\n});\n\ncanvas.addEventListener(\"touchstart\", (event) => {\n  universe.push_undo();\n  if (event.cancelable) {\n    event.preventDefault();\n  }\n  painting = true;\n  lastPaint = event;\n  handleTouches(event);\n});\n\ncanvas.addEventListener(\"touchend\", (event) => {\n  if (event.cancelable) {\n    event.preventDefault();\n  }\n  lastPaint = null;\n  painting = false;\n  clearInterval(repeat);\n});\n\ncanvas.addEventListener(\"touchmove\", (event) => {\n  if (!window.paused) {\n    if (event.cancelable) {\n      event.preventDefault();\n    }\n  }\n  clearInterval(repeat);\n  handleTouches(event);\n});\n\nfunction smoothPaint(event) {\n  clearInterval(repeat);\n  repeat = window.setInterval(() => paint(event), 100);\n  let startEvent = { clientX: event.clientX, clientY: event.clientY };\n  if (!painting) {\n    return;\n  }\n  let size = sizeMap[window.UI.state.size];\n  let i = 0;\n  let step = Math.max(size / 5, 1);\n  if (lastPaint) {\n    while (eventDistance(startEvent, lastPaint) > step) {\n      let d = eventDistance(startEvent, lastPaint);\n      lastPaint = add(\n        lastPaint,\n        scale(norm(sub(lastPaint, event)), -Math.min(step, d))\n      );\n      i++;\n      if (i > 1000) {\n        break;\n      }\n      paint(lastPaint);\n    }\n  }\n  paint(startEvent);\n\n  lastPaint = event;\n}\n\nconst handleTouches = (event) => {\n  let touches = Array.from(event.touches);\n  if (touches.length == 1) {\n    smoothPaint(touches[0]);\n  } else {\n    touches.forEach(paint);\n  }\n};\n\nconst paint = (event) => {\n  if (!painting) {\n    return;\n  }\n  const boundingRect = canvas.getBoundingClientRect();\n\n  const scaleX =\n    canvas.width / Math.ceil(window.devicePixelRatio) / boundingRect.width;\n  const scaleY =\n    canvas.height / Math.ceil(window.devicePixelRatio) / boundingRect.height;\n\n  const canvasLeft = (event.clientX - boundingRect.left) * scaleX;\n  const canvasTop = (event.clientY - boundingRect.top) * scaleY;\n\n  const x = Math.min(Math.floor(canvasLeft), width - 1);\n  const y = Math.min(Math.floor(canvasTop), height - 1);\n  if (window.UI.state.selectedElement < 0) return;\n  universe.paint(\n    x,\n    y,\n    sizeMap[window.UI.state.size],\n    window.UI.state.selectedElement\n  );\n};\n","import React from \"react\";\n\nconst Info = () => {\n  return (\n    <div className=\"Info\">\n      <h1>Sandspiel </h1>\n      <p>\n        Created by <a href=\"https://maxbittker.com\">max bittker</a>\n      </p>\n      <hr />\n      <br />\n      <p>\n        Welcome, and thanks for coming by! I hope that you enjoy exploring this\n        small game, and it brings you some calm.{\" \"}\n      </p>\n      <p>\n        Growing up, \"falling sand\" games like this one provided me hours of\n        entertainment and imagination. I want to particularly thank ha55ii's{\" \"}\n        <a href=\"https://dan-ball.jp/en/javagame/dust/\">Powder Game</a> as the\n        primary inspiration for sandspiel.\n      </p>\n      <br />\n      <p>\n        If you want to read more the inspiration, architecture, and history of\n        the game, I wrote a blog post (it gets technical in the middle):&nbsp;\n        <a href=\"https://maxbittker.com/making-sandspiel\">Making Sandspiel</a>\n      </p>\n      <br />\n      <p>\n        If you'd like, you can view the{\" \"}\n        <a href=\"https://github.com/maxbittker/sandspiel\">source code</a> or{\" \"}\n        <a href=\"https://github.com/maxbittker/sandspiel/issues\">report bugs</a>{\" \"}\n        on github or feel free to reach out on twitter and I'll try to answer!\n      </p>\n      <br />\n      <p>\n        Lastly, I want to say that if you enjoy this game or share your artwork\n        on it, your opinion is important to me and I want to do my best to\n        ensure sandspiel is a friendly and kind place to play, without bullying,\n        racism, transphobia, homophobia, or any other forms of bigotry. If something is wrong or there's some way I can\n        help, feel free to contact me at <a href=\"mailto:maxbittker@gmail.com\">maxbittker@gmail.com</a> or <a href=\"https://twitter.com/maxbittker\">@maxbittker on twitter.</a>\n      </p>\n      <br />\n      <hr />\n      <br />\n      <h2>Element Information:</h2>\n      <h4>Wall </h4>\n      Indestructible.\n      <h4>Sand </h4>\n      Sinks in water.\n      <h4>Water </h4>\n      Puts out fire.\n      <h4>Stone </h4>\n      Forms arches, turns into sand under pressure.\n      <h4>Ice </h4>\n      Freezes Water, slippery!\n      <h4>Gas </h4>\n      Highly Flammable!\n      <h4>Cloner </h4>\n      Copies the first element it touches. \n      <h4>Mite </h4>\n      Eats wood and plant, but loves dust! Slides on ice..\n      <h4>Wood </h4>\n      Sturdy, but biodegradable.\n      <h4>Plant </h4>\n      Thrives in wet enviroments.\n      <h4>Fungus </h4>\n      Spreads over everything.\n      <h4>Seed </h4>\n      Grows on sand, plant, and fungus.\n      <h4>Fire </h4>\n      Hot!\n      <h4>Lava </h4>\n      Flammable and heavy.\n      <h4>Acid </h4>\n      Corrodes other elements.\n      <h4>Dust </h4>\n      Pretty, but dangerously explosive.\n      <h4>Oil </h4>\n      Produces smoke when set on fire.\n      <h4>Rocket </h4>\n      Explodes into copies of the first element it touches.\n      <h4>Empty </h4>\n      Erases.\n      <hr />\n      <hr />\n      <hr />\n      <hr />\n    </div>\n  );\n};\n\nexport default Info;\n","import React from \"react\";\nimport { NavLink } from \"react-router-dom\";\n\nimport FirebaseAuth from \"react-firebaseui/FirebaseAuth\";\n\nclass SignInScreen extends React.Component {\n  // The component's Local state.\n  state = {\n    isSignedIn: false, // Local signed-in state.\n    expanded: true,\n  };\n\n  // Configure FirebaseUI.\n  uiConfig = {\n    // Popup signin flow rather than redirect flow.\n    signInFlow: \"redirect\",\n    signInOptions: [\n      // firebase.auth.GoogleAuthProvider.PROVIDER_ID,\n      // {\n      //   provider: firebase.auth.EmailAuthProvider.PROVIDER_ID,\n      //   requireDisplayName: false,\n      // },\n      {\n        provider: firebase.auth.EmailAuthProvider.PROVIDER_ID,\n        signInMethod: firebase.auth.EmailAuthProvider.EMAIL_LINK_SIGN_IN_METHOD,\n        emailLinkSignIn: function () {\n          return {\n            // Additional state showPromo=1234 can be retrieved from URL on\n            // sign-in completion in signInSuccess callback by checking\n            // window.location.href.\n            url: \"https://sandspiel.club/browse\",\n            // Custom FDL domain.\n            // Always true for email link sign-in.\n            handleCodeInApp: true,\n          };\n        },\n      },\n      // firebase.auth.FacebookAuthProvider.PROVIDER_ID\n    ],\n    callbacks: {\n      // Avoid redirects after sign-in.\n      signInSuccessWithAuthResult: () => false,\n    },\n  };\n\n  // Listen to the Firebase Auth state and set the local state.\n  componentDidMount() {\n    this.setState({ isSignedIn: !!firebase.auth().currentUser });\n\n    this.unregisterAuthObserver = firebase\n      .auth()\n      .onAuthStateChanged((user) => this.setState({ isSignedIn: !!user }));\n  }\n\n  // Make sure we un-register Firebase observers when the component unmounts.\n  componentWillUnmount() {\n    this.unregisterAuthObserver();\n  }\n\n  render() {\n    if (!this.state.isSignedIn) {\n      if (!this.state.expanded) {\n        return (\n          <span>\n            <p>\n              Please{\" \"}\n              <button onClick={() => this.setState({ expanded: true })}>\n                Sign in\n              </button>{\" \"}\n              to vote!{\" \"}\n            </p>\n            <span style={{ display: \"none\" }}>\n              {/* gross hack for completing login */}\n              <FirebaseAuth\n                uiConfig={this.uiConfig}\n                FirebaseAuth={firebase.auth()}\n              />\n            </span>\n          </span>\n        );\n      } else {\n        return (\n          <>\n            Sign-in to post and to vote!\n            <FirebaseAuth\n              uiConfig={this.uiConfig}\n              firebaseAuth={firebase.auth()}\n            />\n          </>\n        );\n      }\n    }\n    let { currentUser } = firebase.auth();\n    // console.log(currentUser);\n    return (\n      <div>\n        <div style={{ display: \"flex\", alignItems: \"center\" }}>\n          <NavLink\n            style={{ flexGrow: 0, margin: \"0 4px\", fontSize: \"19px\" }}\n            to={{\n              pathname: \"/browse/search/\",\n              search: `?user=${currentUser.uid}`,\n            }}\n          >\n            [Post History]\n          </NavLink>\n          {!currentUser.emailVerified &&\n            `Please Verify your email ${currentUser.email} to vote!`}\n          <button\n            style={{ flexGrow: 0, margin: \"0 10px\" }}\n            onClick={() => {\n              if (window.confirm(\"Sign out?\")) {\n                firebase.auth().signOut();\n              }\n            }}\n          >\n            Sign-out\n          </button>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default SignInScreen;\n","import React from \"react\";\nimport { Link } from \"react-router-dom\";\n\nconst HyperText = ({ text }) => {\n  let tokens = text.split(\" \");\n\n  let nodes = tokens.map((t, i) => {\n    if (t.startsWith(\"#\") && t.length > 1) {\n      return (\n        <React.Fragment key={i}>\n          <Link\n            to={{\n              pathname: \"/browse/search/\",\n              search: `?title=${t.slice(1)}`,\n            }}\n          >\n            {t}\n          </Link>{\" \"}\n        </React.Fragment>\n      );\n    }\n    if (t.startsWith(\"https://sandspiel.club/browse/search/?user=\")) {\n      return (\n        <React.Fragment key={i}>\n          <Link\n            to={{\n              pathname: \"/browse/search/\",\n              search: t.slice(\"https://sandspiel.club/browse/search/\".length),\n            }}\n          >\n            [profile]\n          </Link>{\" \"}\n        </React.Fragment>\n      );\n    } else {\n      return t + \" \";\n    }\n  });\n  return <React.Fragment>{nodes}</React.Fragment>;\n};\nexport default HyperText;\n","import React, { useState } from \"react\";\nimport { Link } from \"react-router-dom\";\nimport HyperText from \"./hypertext.js\";\nimport classnames from \"classnames\";\nimport { ago, storageUrl } from \"./browse\";\nimport { functions } from \"../api.js\";\n\nexport function Post({\n  submission,\n  voteFromBrowse,\n  browseVotes,\n  report,\n  redundent_parent_id,\n  redundent_child_id,\n}) {\n  let [nextPost, setNextPost] = useState(null);\n  let [childrenPosts, setChildrenPosts] = useState(null);\n  let displayTime = new Date(submission.data.timestamp).toLocaleDateString();\n  let msAgo =\n    new Date().getTime() - new Date(submission.data.timestamp).getTime();\n\n  if (msAgo < 24 * 60 * 60 * 1000) {\n    displayTime = ago.format(submission.data.timestamp);\n  }\n\n  function fetchParent() {\n    fetch(\n      functions._url(`api/creations/${submission.data.parent_id.slice(0, 20)}`),\n      {\n        method: \"GET\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n      }\n    )\n      .then((res) => res.json())\n      .then((data) => {\n        setNextPost({ id: data.id, data });\n      });\n  }\n\n  function fetchChildren() {\n    fetch(functions._url(`api/creations?parent=${submission.data.id}`), {\n      method: \"GET\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n    })\n      .then((res) => res.json())\n      .then((data) => {\n        setChildrenPosts(data.filter(({ id }) => id !== redundent_child_id));\n      });\n  }\n\n  const hasParent = submission.data?.parent_id;\n  return (\n    <div className=\"thread\">\n      {nextPost && (\n        <Post\n          submission={nextPost}\n          voteFromBrowse={voteFromBrowse}\n          browseVotes={browseVotes}\n          report={report}\n          redundent_child_id={submission.id}\n        />\n      )}\n      <div\n        key={submission.id}\n        className={classnames(\"submission\", {\n          expandedTop: nextPost,\n          expandedBottom: childrenPosts,\n        })}\n      >\n        <Link\n          className=\"img-link\"\n          to={{\n            pathname: \"/\",\n            hash: `#${submission.id.slice(0, 20)}`,\n          }}\n          onClick={() => {\n            window.UI.setState(\n              () => ({\n                currentSubmission: null,\n              }),\n              window.UI.load\n            );\n          }}\n        >\n          <img src={`${storageUrl}${submission.data.id}.png?alt=media`} />\n        </Link>\n        <div style={{ width: \"50%\" }}>\n          {hasParent && !redundent_parent_id && (\n            <button\n              title=\"parent post\"\n              className={classnames(\"parent\", { active: nextPost })}\n              onClick={fetchParent}\n            >\n              \n            </button>\n          )}\n\n          <h3\n            style={{\n              flexGrow: 1,\n              wordWrap: \"break-word\",\n              fontSize: submission.data.title.length > 130 ? \" 1.0em\" : \"1.1em\",\n              //   marginTop: hasParent ? 35 : 0,\n            }}\n          >\n            {hasParent && <span className=\"blocker\" />}\n            <HyperText text={submission.data.title} />\n          </h3>\n          <span className=\"bottom-row\">\n            <span>{displayTime} </span>\n\n            <button\n              className=\"heart\"\n              onClick={() => voteFromBrowse(submission)}\n            >\n              {browseVotes[submission.id] || submission.data.score}\n              {browseVotes[submission.id] ? \"\" : \"\"}\n            </button>\n          </span>\n\n          <button\n            className=\"report\"\n            title=\"report\"\n            onClick={() => report(submission.id)}\n          >\n            !\n          </button>\n          {submission.data.children > (redundent_child_id ? 1 : 0) && (\n            <button\n              className={classnames(\"children\", { active: childrenPosts })}\n              title=\"show children\"\n              onClick={fetchChildren}\n            >\n              {submission.data.children}\n            </button>\n          )}\n        </div>\n      </div>\n\n      {childrenPosts &&\n        childrenPosts.map((childData) => (\n          <Post\n            key={childData.id}\n            submission={childData}\n            voteFromBrowse={voteFromBrowse}\n            browseVotes={browseVotes}\n            report={report}\n            redundent_parent_id={submission.id}\n          />\n        ))}\n    </div>\n  );\n}\n","import React from \"react\";\nimport { NavLink, withRouter } from \"react-router-dom\";\n\nimport timeago from \"timeago.js\";\n\nimport { functions } from \"../api.js\";\nimport SignInScreen from \"./signin.js\";\nimport { Post } from \"./Post\";\n\nexport const ago = timeago();\n\nexport let storageUrl =\n  \"https://firebasestorage.googleapis.com/v0/b/sandtable-8d0f7.appspot.com/o/creations%2F\";\n\nclass Submissions extends React.Component {\n  shouldComponentUpdate(nextProps) {\n    let { submissions, browseVotes } = this.props;\n    return (\n      nextProps.submissions !== submissions ||\n      Object.keys(nextProps.browseVotes).length !==\n        Object.keys(browseVotes).length\n    );\n  }\n  render() {\n    let { submissions, voteFromBrowse, browseVotes, report } = this.props;\n\n    if (!submissions) {\n      return <div style={{ height: \"90vh\" }}>Loading Submissions...</div>;\n    }\n    if (submissions.length == 0) {\n      return <div style={{ height: \"90vh\" }}>Didn't find anything!</div>;\n    }\n\n    return (\n      <div className=\"submissions\">\n        {submissions.map((submission) => {\n          return (\n            <Post\n              key={submission.id}\n              submission={submission}\n              voteFromBrowse={voteFromBrowse}\n              browseVotes={browseVotes}\n              report={report}\n            />\n          );\n        })}\n      </div>\n    );\n  }\n}\n\nclass Browse extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      paused: false,\n      submitting: false,\n      dataURL: {},\n      submissions: null,\n      browseVotes: {},\n      search: \"\",\n    };\n  }\n  componentWillMount() {\n    this.loadSubmissions();\n  }\n  componentDidUpdate(prevProps) {\n    if (\n      prevProps.location.pathname != this.props.location.pathname ||\n      prevProps.location.search != this.props.location.search\n    ) {\n      this.loadSubmissions();\n    }\n  }\n  togglePause() {\n    window.paused = !this.state.paused;\n    this.setState({ paused: !this.state.paused });\n  }\n\n  setSize(event, size) {\n    event.preventDefault();\n    this.setState({\n      size,\n    });\n  }\n\n  loadSubmissions() {\n    let { location } = this.props;\n    if (location.search.startsWith(\"?title=\")) {\n      // to load deep urls with a search query.\n      this.setState({ search: this.props.location.search.slice(7) });\n    }\n    let param = \"\";\n\n    if (location.pathname.startsWith(\"/browse/top/\")) {\n      param = \"?q=score\";\n    }\n    if (location.pathname.startsWith(\"/browse/top/day\")) {\n      param = \"?q=score&d=1\";\n    }\n    if (location.pathname.startsWith(\"/browse/top/week\")) {\n      param = \"?q=score&d=7\";\n    }\n    if (location.pathname.startsWith(\"/browse/top/month\")) {\n      param = \"?q=score&d=30\";\n    }\n    if (location.pathname.startsWith(\"/browse/search/\")) {\n      param = location.search;\n      if (location.user) {\n        param = location.user;\n      }\n    }\n\n    this.setState({ submissions: null });\n    fetch(functions._url(\"api/creations\") + param, {\n      method: \"GET\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n    })\n      .then((res) => res.json())\n      .then((response) => {\n        this.setState({ submissions: response });\n        // this.pause();\n      })\n      .catch((error) => {\n        this.setState({ submissions: false });\n        console.error(\"Error:\", error);\n      });\n  }\n\n  voteFromBrowse(submission) {\n    // creations/:id/vote\n    this.setState(({ browseVotes }) => ({\n      browseVotes: {\n        [submission.id]: submission.data.score + 1,\n        ...browseVotes,\n      },\n    }));\n    firebase\n      .auth()\n      .currentUser.getIdToken()\n      .then((token) => {\n        fetch(functions._url(`api/creations/${submission.id}/vote`), {\n          method: \"PUT\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n            Authorization: \"Bearer \" + token,\n          },\n        })\n          .then((res) => res.json())\n          .then((data) => {\n            this.setState(({ browseVotes }) => ({\n              browseVotes: { [submission.id]: data.score, ...browseVotes },\n            }));\n          })\n          .catch((e) => {\n            console.error(e);\n          });\n      });\n  }\n  report(id) {\n    firebase\n      .auth()\n      .currentUser.getIdToken()\n      .then((token) => {\n        fetch(functions._url(`api/creations/${id}/report`), {\n          method: \"PUT\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n            Authorization: \"Bearer \" + token,\n          },\n        })\n          .then((res) => res.json())\n          .then((data) => {\n            // this.setState(({ browseVotes }) => ({\n            //   browseVotes: { [submission.id]: data.score, ...browseVotes }\n            // }));\n          })\n          .catch((e) => {\n            console.error(e);\n          });\n      });\n  }\n  render() {\n    const { search, submissions, browseVotes } = this.state;\n    return (\n      <React.Fragment>\n        <SignInScreen />\n        <p style={{ gridColumn: \"auto / span 2\", margin: \"8px\", fontSize: 16 }}>\n          Check out <br></br>\n          <a href=\"https://studio.sandspiel.club\" target=\"_blank\">\n            {\" \"}\n            <b> SANDSPIEL STUDIO: Invent New Elements!</b>\n          </a>\n          <br></br>\n          <a href=\"https://orb.farm\" target=\"_blank\">\n            {\" \"}\n            Orb.Farm\n          </a>\n          {\"          \\xa0        \\xa0\\xa0\\xa0    \"}\n          <a\n            href=\"https://www.roblox.com/games/7000824340/Melon-Rancher\"\n            target=\"_blank\"\n          >\n            {\" \"}\n            Melon Rancher\n          </a>\n          <br></br>\n          <a href=\"https://www.youtube.com/watch?v=2qfjJ-0ZeVM\" target=\"_blank\">\n            {\" \"}\n            \"Top 9 ways to make Water\"\n          </a>\n        </p>\n        <NavLink exact to=\"/browse/\">\n          <button>New</button>\n        </NavLink>\n        <NavLink to=\"/browse/top/day/\">\n          <button>Day</button>\n        </NavLink>\n        <NavLink to=\"/browse/top/week/\">\n          <button>Week</button>\n        </NavLink>\n        <NavLink to=\"/browse/top/month/\">\n          <button>Month</button>\n        </NavLink>\n        <NavLink exact to=\"/browse/top/\">\n          <button>All </button>\n        </NavLink>\n        <span style={{ display: \"inline-block\" }}>\n          <input\n            value={search}\n            onChange={(e) => this.setState({ search: e.target.value })}\n            onKeyDown={(e) =>\n              e.keyCode == 13 && // I think that's enter\n              this.props.history.push(`/browse/search/?title=${search}`)\n            }\n            placeholder=\"search\"\n          />\n          {search && (\n            <NavLink\n              to={{\n                pathname: \"/browse/search/\",\n                search: `?title=${search}`,\n              }}\n            >\n              <button>Search</button>\n            </NavLink>\n          )}\n        </span>\n        <Submissions\n          submissions={submissions}\n          voteFromBrowse={(submission) => this.voteFromBrowse(submission)}\n          browseVotes={browseVotes}\n          report={(id) => this.report(id)}\n        />\n      </React.Fragment>\n    );\n  }\n}\n\nexport default withRouter(Browse);\n","import React from \"react\";\nimport { NavLink, Link, withRouter } from \"react-router-dom\";\n\nimport timeago from \"timeago.js\";\n\nimport HyperText from \"./hypertext.js\";\nimport SignInScreen from \"./signin\";\nimport { functions, storage } from \"../api.js\";\n\nlet n = 0;\nconst ago = timeago();\n\nlet storageUrl =\n  \"https://firebasestorage.googleapis.com/v0/b/sandtable-8d0f7.appspot.com/o/creations%2F\";\n\nclass Submissions extends React.Component {\n  shouldComponentUpdate(nextProps) {\n    let { submissions, browseVotes } = this.props;\n    return (\n      nextProps.submissions !== submissions ||\n      Object.keys(nextProps.browseVotes).length !==\n        Object.keys(browseVotes).length\n    );\n  }\n  render() {\n    let { submissions, voteFromBrowse, browseVotes, judge } = this.props;\n\n    if (!submissions) {\n      return <div style={{ height: \"90vh\" }}>Loading Submissions...</div>;\n    }\n    if (submissions.length == 0) {\n      return (\n        <div style={{ height: \"90vh\" }}>No actionable reports! Thanks </div>\n      );\n    }\n\n    return (\n      <div className=\"submissions admin\">\n        {submissions.map((submission) => {\n          let displayTime = new Date(\n            submission.data.timestamp\n          ).toLocaleDateString();\n          let msAgo =\n            new Date().getTime() -\n            new Date(submission.data.timestamp).getTime();\n\n          if (msAgo < 24 * 60 * 60 * 1000) {\n            displayTime = ago.format(submission.data.timestamp);\n          }\n          return (\n            <div key={submission.id} className=\"submission\">\n              <Link\n                className=\"img-link\"\n                to={{\n                  pathname: \"/\",\n                  hash: `#${submission.id}`,\n                }}\n                onClick={() => {\n                  window.UI.setState(\n                    () => ({\n                      currentSubmission: null,\n                    }),\n                    window.UI.load\n                  );\n                }}\n              >\n                <img src={`${storageUrl}${submission.data.id}.png?alt=media`} />\n              </Link>\n              <div style={{ width: \"50%\" }}>\n                <h3\n                  className=\"title\"\n                  style={{ flexGrow: 1, wordWrap: \"break-word\" }}\n                >\n                  <HyperText text={submission.data.title} />\n                </h3>\n                <button\n                  className=\"heart\"\n                  onClick={() => voteFromBrowse(submission)}\n                >\n                  <h3>\n                    {browseVotes[submission.id] ? \"\" : \"\"}\n                    {browseVotes[submission.id] || submission.data.score}\n                  </h3>\n                </button>\n\n                <NavLink\n                  to={{\n                    pathname: \"/browse/search/\",\n                    search: `?user=${submission.data.user_id}`,\n                  }}\n                >\n                  \n                </NavLink>\n\n                <h4>{displayTime}</h4>\n                <h3 style={{ flexGrow: 1 }}>\n                  {submission.data.reports} reports\n                </h3>\n                <div className=\"adminButtons\">\n                  <button\n                    className=\"BAN\"\n                    title=\"ban\"\n                    onClick={() => judge(submission.id, 2)}\n                  >\n                    ban \n                  </button>\n                  <button\n                    className=\"delete\"\n                    title=\"delete\"\n                    onClick={() => judge(submission.id, true)}\n                  >\n                    delete \n                  </button>\n                  <button\n                    className=\"pardon\"\n                    title=\"pardon\"\n                    onClick={() => judge(submission.id, false)}\n                  >\n                    pardon \n                  </button>\n                </div>\n              </div>\n            </div>\n          );\n        })}\n      </div>\n    );\n  }\n}\n\nclass AdminBrowse extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      paused: false,\n      submissions: null,\n      decidedIds: [],\n      browseVotes: {},\n      search: \"\",\n      currentUser: firebase.auth().currentUser,\n    };\n  }\n  componentWillMount() {\n    this.loadSubmissions();\n  }\n  componentDidUpdate(prevProps) {\n    if (prevProps.location.pathname != this.props.location.pathname) {\n      this.loadSubmissions();\n    }\n  }\n\n  voteFromBrowse(submission) {\n    // creations/:id/vote\n    firebase\n      .auth()\n      .currentUser.getIdToken()\n      .then((token) => {\n        fetch(functions._url(`api/creations/${submission.id}/vote`), {\n          method: \"PUT\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n            Authorization: \"Bearer \" + token,\n          },\n        })\n          .then((res) => res.json())\n          .then((data) => {\n            this.setState(({ browseVotes }) => ({\n              browseVotes: { [submission.id]: data.score, ...browseVotes },\n            }));\n          })\n          .catch((e) => {\n            console.error(e);\n          });\n      });\n  }\n  loadSubmissions() {\n    // this.setState({ submissions: null });\n    fetch(functions._url(\"api/reports\"), {\n      method: \"GET\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n    })\n      .then((res) => res.json())\n      .then((response) => {\n        this.setState({ submissions: response });\n        // this.pause();\n      })\n      .catch((error) => {\n        this.setState({ submissions: false });\n        console.error(\"Error:\", error);\n      });\n  }\n  judge(id, ruling) {\n    this.setState(({ decidedIds }) => ({\n      decidedIds: [...decidedIds, id],\n    }));\n    firebase\n      .auth()\n      .currentUser.getIdToken()\n      .then((token) => {\n        // set the __session cookie\n        fetch(\n          functions._url(`api/creations/${id}/judge`) + `?ruling=${ruling}`,\n          {\n            method: \"PUT\",\n            headers: {\n              \"Content-Type\": \"application/json\",\n              Authorization: \"Bearer \" + token,\n            },\n          }\n        )\n          .then((res) => res.json())\n          .then((data) => {\n            n++;\n            if (n > 20) {\n              this.loadSubmissions();\n              n = 0;\n            }\n          })\n          .catch((e) => {\n            console.error(e);\n          });\n      });\n  }\n  doSignInWithGoogle() {\n    var provider = new firebase.auth.GoogleAuthProvider();\n    firebase.auth().signInWithRedirect(provider);\n  }\n  render() {\n    let { submissions, browseVotes, currentUser, decidedIds } = this.state;\n\n    submissions =\n      submissions &&\n      submissions.filter((submission) => !decidedIds.includes(submission.id));\n    return (\n      <React.Fragment>\n        <SignInScreen />\n        <h2 style={{ display: \"inline-block\" }}>do it for doona </h2>\n\n        {submissions && <h3>{submissions.length} actionable reports:</h3>}\n        <NavLink to=\"/browse/\">\n          <button>Browse new</button>\n        </NavLink>\n        <Submissions\n          submissions={submissions}\n          voteFromBrowse={(submission) => this.voteFromBrowse(submission)}\n          browseVotes={browseVotes}\n          judge={(id, ruling) => this.judge(id, ruling)}\n        />\n      </React.Fragment>\n    );\n  }\n}\n\nexport default withRouter(AdminBrowse);\n","let baseVertex = require(\"./glsl/baseVertex.glsl\");\nlet clearShaderString = require(\"./glsl/clear.glsl\");\nlet displayShaderString = require(\"./glsl/display.glsl\");\nlet splatShaderString = require(\"./glsl/splat.glsl\");\nlet advectionManualFilteringShaderString = require(\"./glsl/advectionManualFilter.glsl\");\nlet advectionShaderString = require(\"./glsl/advection.glsl\");\nlet divergenceShaderString = require(\"./glsl/divergence.glsl\");\nlet curlShaderString = require(\"./glsl/curl.glsl\");\nlet vorticityShaderString = require(\"./glsl/vorticity.glsl\");\nlet pressureShaderString = require(\"./glsl/pressure.glsl\");\nlet gradientSubtractShaderString = require(\"./glsl/gradientSubtract.glsl\");\nlet velocityOutShaderString = require(\"./glsl/velocityOut.glsl\");\n\nfunction compileShaders(gl) {\n  function compileShader(type, source) {\n    const shader = gl.createShader(type);\n    gl.shaderSource(shader, source);\n    gl.compileShader(shader);\n\n    if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS))\n      throw gl.getShaderInfoLog(shader);\n\n    return shader;\n  }\n\n  const baseVertexShader = compileShader(gl.VERTEX_SHADER, baseVertex);\n  const clearShader = compileShader(gl.FRAGMENT_SHADER, clearShaderString);\n  const displayShader = compileShader(gl.FRAGMENT_SHADER, displayShaderString);\n  const splatShader = compileShader(gl.FRAGMENT_SHADER, splatShaderString);\n  const advectionManualFilteringShader = compileShader(\n    gl.FRAGMENT_SHADER,\n    advectionManualFilteringShaderString\n  );\n  const advectionShader = compileShader(\n    gl.FRAGMENT_SHADER,\n    advectionShaderString\n  );\n  const divergenceShader = compileShader(\n    gl.FRAGMENT_SHADER,\n    divergenceShaderString\n  );\n  const curlShader = compileShader(gl.FRAGMENT_SHADER, curlShaderString);\n  const vorticityShader = compileShader(\n    gl.FRAGMENT_SHADER,\n    vorticityShaderString\n  );\n  const pressureShader = compileShader(\n    gl.FRAGMENT_SHADER,\n    pressureShaderString\n  );\n  const gradientSubtractShader = compileShader(\n    gl.FRAGMENT_SHADER,\n    gradientSubtractShaderString\n  );\n  const velocityOutShader = compileShader(\n    gl.FRAGMENT_SHADER,\n    velocityOutShaderString\n  );\n\n  return {\n    baseVertexShader,\n    clearShader,\n    displayShader,\n    splatShader,\n    advectionManualFilteringShader,\n    advectionShader,\n    divergenceShader,\n    curlShader,\n    vorticityShader,\n    pressureShader,\n    gradientSubtractShader,\n    velocityOutShader\n  };\n}\n\nexport { compileShaders };\n","// MIT License\n\n// Copyright (c) 2017 Pavel Dobryakov\n\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in all\n// copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\n\"use strict\";\nimport * as dat from \"dat.gui\";\nimport { memory } from \"../crate/pkg/sandtable_bg\";\nimport { compileShaders } from \"./fluidShaders\";\nconst canvas = document.getElementById(\"fluid-canvas\");\nconst sandCanvas = document.getElementById(\"sand-canvas\");\n\nlet fluidColor = [1, 1, 0.8];\nfunction iOS() {\n  return (\n    [\n      \"iPad Simulator\",\n      \"iPhone Simulator\",\n      \"iPod Simulator\",\n      \"iPad\",\n      \"iPhone\",\n      \"iPod\",\n    ].includes(navigator.platform) ||\n    // iPad on iOS 13 detection\n    (navigator.userAgent.includes(\"Mac\") && \"ontouchend\" in document)\n  );\n}\n\nconst isIOS = iOS();\nfunction startFluid({ universe }) {\n  canvas.width = universe.width();\n  canvas.height = universe.height();\n  let config = {\n    TEXTURE_DOWNSAMPLE: 0,\n    DENSITY_DISSIPATION: 0.98,\n    VELOCITY_DISSIPATION: 0.99,\n    PRESSURE_DISSIPATION: 0.8,\n    PRESSURE_ITERATIONS: 25,\n    CURL: 15,\n    SPLAT_RADIUS: 0.005,\n  };\n\n  let pointers = [];\n  let splatStack = [];\n  let isWebGL2;\n\n  const { gl, ext } = getWebGLContext(canvas);\n  let {\n    baseVertexShader,\n    clearShader,\n    displayShader,\n    splatShader,\n    advectionManualFilteringShader,\n    advectionShader,\n    divergenceShader,\n    curlShader,\n    vorticityShader,\n    pressureShader,\n    gradientSubtractShader,\n    velocityOutShader,\n  } = compileShaders(gl);\n  startGUI();\n\n  function getWebGLContext(canvas) {\n    const params = {\n      alpha: false,\n      depth: false,\n      stencil: false,\n      antialias: false,\n      preserveDrawingBuffer: false,\n    };\n\n    let gl = canvas.getContext(\"webgl2\", params);\n    isWebGL2 = !!gl;\n    if (!isWebGL2)\n      gl =\n        canvas.getContext(\"webgl\", params) ||\n        canvas.getContext(\"experimental-webgl\", params);\n\n    let halfFloat;\n    let supportLinearFiltering;\n    if (isWebGL2) {\n      halfFloat = gl.getExtension(\"EXT_color_buffer_float\");\n      supportLinearFiltering = gl.getExtension(\"OES_texture_float_linear\");\n    } else {\n      halfFloat = gl.getExtension(\"OES_texture_half_float\");\n      supportLinearFiltering = gl.getExtension(\"OES_texture_half_float_linear\");\n    }\n\n    gl.clearColor(0.0, 0.0, 0.0, 0.0);\n\n    const halfFloatTexType = isWebGL2\n      ? gl.HALF_FLOAT\n      : halfFloat.HALF_FLOAT_OES;\n    let formatRGBA;\n    let formatRG;\n    let formatR;\n\n    if (isWebGL2) {\n      formatRGBA = getSupportedFormat(\n        gl,\n        gl.RGBA16F,\n        gl.RGBA,\n        halfFloatTexType\n      );\n      formatRG = getSupportedFormat(gl, gl.RG16F, gl.RG, halfFloatTexType);\n      formatR = getSupportedFormat(gl, gl.R16F, gl.RED, halfFloatTexType);\n    } else {\n      formatRGBA = getSupportedFormat(gl, gl.RGBA, gl.RGBA, halfFloatTexType);\n      formatRG = getSupportedFormat(gl, gl.RGBA, gl.RGBA, halfFloatTexType);\n      formatR = getSupportedFormat(gl, gl.RGBA, gl.RGBA, halfFloatTexType);\n    }\n\n    return {\n      gl,\n      ext: {\n        formatRGBA,\n        formatRG,\n        formatR,\n        halfFloatTexType,\n        supportLinearFiltering,\n      },\n    };\n  }\n\n  function getSupportedFormat(gl, internalFormat, format, type) {\n    if (!supportRenderTextureFormat(gl, internalFormat, format, type)) {\n      switch (internalFormat) {\n        case gl.R16F:\n          return getSupportedFormat(gl, gl.RG16F, gl.RG, type);\n        case gl.RG16F:\n          return getSupportedFormat(gl, gl.RGBA16F, gl.RGBA, type);\n        default:\n          return null;\n      }\n    }\n\n    return {\n      internalFormat,\n      format,\n    };\n  }\n\n  function supportRenderTextureFormat(gl, internalFormat, format, type) {\n    let texture = gl.createTexture();\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n    gl.texImage2D(\n      gl.TEXTURE_2D,\n      0,\n      internalFormat,\n      4,\n      4,\n      0,\n      format,\n      type,\n      null\n    );\n\n    let fbo = gl.createFramebuffer();\n    gl.bindFramebuffer(gl.FRAMEBUFFER, fbo);\n    gl.framebufferTexture2D(\n      gl.FRAMEBUFFER,\n      gl.COLOR_ATTACHMENT0,\n      gl.TEXTURE_2D,\n      texture,\n      0\n    );\n\n    const status = gl.checkFramebufferStatus(gl.FRAMEBUFFER);\n    if (status != gl.FRAMEBUFFER_COMPLETE) return false;\n    return true;\n  }\n\n  function startGUI() {\n    var gui = new dat.GUI({ width: 300 });\n    gui\n      .add(config, \"TEXTURE_DOWNSAMPLE\", { Full: 0, Half: 1, Quarter: 2 })\n      .name(\"resolution\")\n      .onFinishChange(initFramebuffers);\n    gui.add(config, \"DENSITY_DISSIPATION\", 0.9, 1.0).name(\"density diffusion\");\n    gui\n      .add(config, \"VELOCITY_DISSIPATION\", 0.9, 1.0)\n      .name(\"velocity diffusion\");\n    gui\n      .add(config, \"PRESSURE_DISSIPATION\", 0.0, 1.0)\n      .name(\"pressure diffusion\");\n    gui.add(config, \"PRESSURE_ITERATIONS\", 1, 60).name(\"iterations\");\n    gui.add(config, \"CURL\", 0, 50).name(\"vorticity\").step(1);\n    gui.add(config, \"SPLAT_RADIUS\", 0.0001, 0.01).name(\"splat radius\");\n\n    gui\n      .add(\n        {\n          fun: () => {\n            splatStack.push(parseInt(Math.random() * 20) + 5);\n          },\n        },\n        \"fun\"\n      )\n      .name(\"Random splats\");\n\n    gui.close();\n  }\n\n  function pointerPrototype() {\n    this.id = -1;\n    this.x = 0;\n    this.y = 0;\n    this.dx = 0;\n    this.dy = 0;\n    this.down = false;\n    this.moved = false;\n    this.color = [30, 300, 30];\n  }\n\n  pointers.push(new pointerPrototype());\n\n  class GLProgram {\n    constructor(vertexShader, fragmentShader) {\n      this.uniforms = {};\n      this.program = gl.createProgram();\n\n      gl.attachShader(this.program, vertexShader);\n      gl.attachShader(this.program, fragmentShader);\n      gl.linkProgram(this.program);\n\n      if (!gl.getProgramParameter(this.program, gl.LINK_STATUS))\n        throw gl.getProgramInfoLog(this.program);\n\n      const uniformCount = gl.getProgramParameter(\n        this.program,\n        gl.ACTIVE_UNIFORMS\n      );\n      for (let i = 0; i < uniformCount; i++) {\n        const uniformName = gl.getActiveUniform(this.program, i).name;\n        this.uniforms[uniformName] = gl.getUniformLocation(\n          this.program,\n          uniformName\n        );\n      }\n    }\n\n    bind() {\n      gl.useProgram(this.program);\n    }\n  }\n\n  let texWidth;\n  let texHeight;\n  let density;\n  let velocity;\n  let velocityOut;\n  let burns;\n  let cells;\n  let divergence;\n  let curl;\n  let pressure;\n  initFramebuffers();\n\n  const clearProgram = new GLProgram(baseVertexShader, clearShader);\n  const displayProgram = new GLProgram(baseVertexShader, displayShader);\n  const velocityOutProgram = new GLProgram(baseVertexShader, velocityOutShader);\n  const splatProgram = new GLProgram(baseVertexShader, splatShader);\n  const advectionProgram = new GLProgram(\n    baseVertexShader,\n    ext.supportLinearFiltering\n      ? advectionShader\n      : advectionManualFilteringShader\n  );\n  const divergenceProgram = new GLProgram(baseVertexShader, divergenceShader);\n  const curlProgram = new GLProgram(baseVertexShader, curlShader);\n  const vorticityProgram = new GLProgram(baseVertexShader, vorticityShader);\n  const pressureProgram = new GLProgram(baseVertexShader, pressureShader);\n  const gradientSubtractProgram = new GLProgram(\n    baseVertexShader,\n    gradientSubtractShader\n  );\n\n  function initFramebuffers() {\n    texWidth = gl.drawingBufferWidth >> config.TEXTURE_DOWNSAMPLE;\n    texHeight = gl.drawingBufferHeight >> config.TEXTURE_DOWNSAMPLE;\n\n    const texType = ext.halfFloatTexType;\n    const rgba = ext.formatRGBA;\n    const rg = ext.formatRG;\n    const r = ext.formatR;\n\n    velocity = createDoubleFBO(\n      0,\n      texWidth,\n      texHeight,\n      rg.internalFormat,\n      rg.format,\n      texType,\n      ext.supportLinearFiltering ? gl.LINEAR : gl.NEAREST\n    );\n    density = createDoubleFBO(\n      2,\n      texWidth,\n      texHeight,\n      rgba.internalFormat,\n      rgba.format,\n      texType,\n      ext.supportLinearFiltering ? gl.LINEAR : gl.NEAREST\n    );\n    divergence = createFBO(\n      4,\n      texWidth,\n      texHeight,\n      r.internalFormat,\n      r.format,\n      texType,\n      gl.NEAREST\n    );\n    curl = createFBO(\n      5,\n      texWidth,\n      texHeight,\n      r.internalFormat,\n      r.format,\n      texType,\n      gl.NEAREST\n    );\n    pressure = createDoubleFBO(\n      6,\n      texWidth,\n      texHeight,\n      r.internalFormat,\n      r.format,\n      texType,\n      gl.NEAREST\n    );\n    burns = createFBO(\n      8,\n      texWidth,\n      texHeight,\n      rg.internalFormat,\n      rg.format,\n      texType,\n      ext.supportLinearFiltering ? gl.LINEAR : gl.NEAREST\n    );\n    cells = createFBO(\n      10,\n      texWidth,\n      texHeight,\n      rg.internalFormat,\n      rg.format,\n      texType,\n      ext.supportLinearFiltering ? gl.LINEAR : gl.NEAREST\n    );\n    velocityOut = createFBO(\n      9,\n      texWidth,\n      texHeight,\n      gl.RGBA,\n      gl.RGBA,\n      gl.UNSIGNED_BYTE,\n      ext.supportLinearFiltering ? gl.LINEAR : gl.NEAREST\n    );\n  }\n\n  function createFBO(texId, w, h, internalFormat, format, type, param) {\n    gl.activeTexture(gl.TEXTURE0 + texId);\n    let texture = gl.createTexture();\n\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, param);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, param);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n    gl.texImage2D(\n      gl.TEXTURE_2D,\n      0,\n      internalFormat,\n      w,\n      h,\n      0,\n      format,\n      type,\n      null\n    );\n\n    let fbo = gl.createFramebuffer();\n    gl.bindFramebuffer(gl.FRAMEBUFFER, fbo);\n    gl.framebufferTexture2D(\n      gl.FRAMEBUFFER,\n      gl.COLOR_ATTACHMENT0,\n      gl.TEXTURE_2D,\n      texture,\n      0\n    );\n    gl.viewport(0, 0, w, h);\n    gl.clear(gl.COLOR_BUFFER_BIT);\n\n    return [texture, fbo, texId];\n  }\n\n  function createDoubleFBO(texId, w, h, internalFormat, format, type, param) {\n    let fbo1 = createFBO(texId, w, h, internalFormat, format, type, param);\n    let fbo2 = createFBO(texId + 1, w, h, internalFormat, format, type, param);\n\n    return {\n      get read() {\n        return fbo1;\n      },\n      get write() {\n        return fbo2;\n      },\n      swap() {\n        let temp = fbo1;\n        fbo1 = fbo2;\n        fbo2 = temp;\n      },\n    };\n  }\n\n  const width = universe.width();\n  const height = universe.height();\n\n  const blit = (() => {\n    gl.bindBuffer(gl.ARRAY_BUFFER, gl.createBuffer());\n    gl.bufferData(\n      gl.ARRAY_BUFFER,\n      new Float32Array([-1, -1, -1, 1, 1, 1, 1, -1]),\n      gl.STATIC_DRAW\n    );\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, gl.createBuffer());\n    gl.bufferData(\n      gl.ELEMENT_ARRAY_BUFFER,\n      new Uint16Array([0, 1, 2, 0, 2, 3]),\n      gl.STATIC_DRAW\n    );\n\n    if (isWebGL2 && !isIOS) {\n      const pbo = gl.createBuffer();\n      gl.bindBuffer(gl.PIXEL_PACK_BUFFER, pbo);\n      gl.bufferData(\n        gl.PIXEL_PACK_BUFFER,\n        new Uint8Array(width * height * 4),\n        gl.STATIC_DRAW\n      );\n    }\n\n    gl.vertexAttribPointer(0, 2, gl.FLOAT, false, 0, 0);\n    gl.enableVertexAttribArray(0);\n\n    return (destination) => {\n      gl.bindFramebuffer(gl.FRAMEBUFFER, destination);\n      gl.drawElements(gl.TRIANGLES, 6, gl.UNSIGNED_SHORT, 0);\n    };\n  })();\n\n  let lastTime = Date.now();\n\n  // multipleSplats(parseInt(Math.random() * 20) + 5);\n\n  let winds = new Uint8Array(\n    memory.buffer,\n    universe.winds(),\n    width * height * 4\n  );\n\n  let burnsData = new Uint8Array(\n    memory.buffer,\n    universe.burns(),\n    width * height * 4\n  );\n\n  let cellsData = new Uint8Array(\n    memory.buffer,\n    universe.cells(),\n    width * height * 4\n  );\n\n  function reset() {\n    clearProgram.bind();\n\n    var texUnit = 0;\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, burns[0]);\n    gl.uniform1i(clearProgram.uniforms.uWind, texUnit++);\n\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, density.read[0]);\n    gl.uniform1i(clearProgram.uniforms.uTexture, texUnit++);\n\n    gl.uniform1f(clearProgram.uniforms.value, 0);\n\n    blit(density.write[1]);\n    density.swap();\n\n    var texUnit = 0;\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, burns[0]);\n    gl.uniform1i(clearProgram.uniforms.uWind, texUnit++);\n\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, pressure.read[0]);\n    gl.uniform1i(clearProgram.uniforms.uTexture, texUnit++);\n\n    gl.uniform1f(clearProgram.uniforms.value, 0);\n\n    blit(pressure.write[1]);\n    pressure.swap();\n\n    texUnit = 0;\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, burns[0]);\n    gl.uniform1i(clearProgram.uniforms.uWind, texUnit++);\n\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, velocity.read[0]);\n    gl.uniform1i(clearProgram.uniforms.uTexture, texUnit++);\n\n    gl.uniform1f(clearProgram.uniforms.value, 0);\n\n    blit(velocity.write[1]);\n    velocity.swap();\n  }\n\n  let sync = undefined;\n\n  function update() {\n    winds = new Uint8Array(memory.buffer, universe.winds(), width * height * 4);\n\n    burnsData = new Uint8Array(\n      memory.buffer,\n      universe.burns(),\n      width * height * 4\n    );\n\n    let cell_pointer = universe.cells();\n    cellsData = new Uint8Array(memory.buffer, cell_pointer, width * height * 4);\n\n    // resizeCanvas();\n\n    const dt = Math.min((Date.now() - lastTime) / 1000, 0.016);\n    lastTime = Date.now();\n\n    gl.viewport(0, 0, texWidth, texHeight);\n\n    if (splatStack.length > 0) multipleSplats(splatStack);\n    // multipleSplats(1);\n\n    // ADVECTION\n    // velocityRead ->\n    // velocityWrite\n    advectionProgram.bind();\n\n    var texUnit = 0;\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, velocity.read[0]);\n    gl.uniform1i(advectionProgram.uniforms.uVelocity, texUnit++);\n\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, velocity.read[0]);\n    gl.uniform1i(advectionProgram.uniforms.uSource, texUnit++);\n\n    gl.uniform2f(\n      advectionProgram.uniforms.texelSize,\n      1.0 / texWidth,\n      1.0 / texHeight\n    );\n    // gl.uniform1i(advectionProgram.uniforms.uVelocity, velocity.read[2]);\n    // gl.uniform1i(advectionProgram.uniforms.uSource, velocity.read[2]);\n    gl.uniform1f(advectionProgram.uniforms.dt, dt);\n    gl.uniform1f(\n      advectionProgram.uniforms.dissipation,\n      config.VELOCITY_DISSIPATION\n    );\n    blit(velocity.write[1]);\n    velocity.swap();\n\n    gl.bindTexture(gl.TEXTURE_2D, burns[0]);\n    gl.texImage2D(\n      gl.TEXTURE_2D,\n      0,\n      gl.RGBA,\n      width,\n      height,\n      0,\n      gl.RGBA,\n      gl.UNSIGNED_BYTE,\n      burnsData\n    );\n\n    gl.bindTexture(gl.TEXTURE_2D, cells[0]);\n    gl.texImage2D(\n      gl.TEXTURE_2D,\n      0,\n      gl.RGBA,\n      width,\n      height,\n      0,\n      gl.RGBA,\n      gl.UNSIGNED_BYTE,\n      cellsData\n    );\n\n    // ADVECTION\n    // burns\n    // velocityRead\n    // densityRead ->\n    // densityWrite\n\n    var texUnit = 0;\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, burns[0]);\n    gl.uniform1i(advectionProgram.uniforms.uWind, texUnit++);\n\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, velocity.read[0]);\n    gl.uniform1i(advectionProgram.uniforms.uVelocity, texUnit++);\n\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, density.read[0]);\n    gl.uniform1i(advectionProgram.uniforms.uSource, texUnit++);\n\n    // gl.uniform1i(advectionProgram.uniforms.uWind, burns[2]);\n    // gl.uniform1i(advectionProgram.uniforms.uVelocity, velocity.read[2]);\n    // gl.uniform1i(advectionProgram.uniforms.uSource, density.read[2]);\n    gl.uniform1f(\n      advectionProgram.uniforms.dissipation,\n      config.DENSITY_DISSIPATION\n    );\n    blit(density.write[1]);\n    density.swap();\n\n    // Splat\n    // velocityRead -> velocityWrite\n    // densityRead -> velocityWrite\n    for (let i = 0; i < pointers.length; i++) {\n      const pointer = pointers[i];\n      if (pointer.moved && window.UI.state.selectedElement < 0) {\n        splat(pointer.x, pointer.y, pointer.dx, pointer.dy, pointer.color);\n        pointer.moved = false;\n      }\n    }\n\n    // CURL\n    // velocityRead -> curl\n    curlProgram.bind();\n\n    var texUnit = 0;\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, velocity.read[0]);\n    gl.uniform1i(curlProgram.uniforms.uVelocity, texUnit++);\n\n    gl.uniform2f(\n      curlProgram.uniforms.texelSize,\n      1.0 / texWidth,\n      1.0 / texHeight\n    );\n    // gl.uniform1i(curlProgram.uniforms.uVelocity, velocity.read[2]);\n    blit(curl[1]);\n\n    // VORTICITY\n    // velocityRead\n    // curl ->\n    // velocityWrite\n\n    vorticityProgram.bind();\n\n    var texUnit = 0;\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, velocity.read[0]);\n    gl.uniform1i(vorticityProgram.uniforms.uVelocity, texUnit++);\n\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, curl[0]);\n    gl.uniform1i(vorticityProgram.uniforms.uCurl, texUnit++);\n\n    gl.uniform2f(\n      vorticityProgram.uniforms.texelSize,\n      1.0 / texWidth,\n      1.0 / texHeight\n    );\n\n    // gl.uniform1i(vorticityProgram.uniforms.uVelocity, velocity.read[2]);\n    // gl.uniform1i(vorticityProgram.uniforms.uCurl, curl[2]);\n    gl.uniform1f(vorticityProgram.uniforms.curl, config.CURL);\n    gl.uniform1f(vorticityProgram.uniforms.dt, dt);\n    blit(velocity.write[1]);\n    velocity.swap();\n\n    // DIVERGENCE\n    // velocityRead ->\n    // divergence\n    divergenceProgram.bind();\n\n    var texUnit = 0;\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, velocity.read[0]);\n    gl.uniform1i(divergenceProgram.uniforms.uVelocity, texUnit++);\n\n    gl.uniform2f(\n      divergenceProgram.uniforms.texelSize,\n      1.0 / texWidth,\n      1.0 / texHeight\n    );\n    // gl.uniform1i(divergenceProgram.uniforms.uVelocity, velocity.read[2]);\n    blit(divergence[1]);\n\n    // CLEAR\n    // burns\n    // pressureRead->\n    // pressureWrite\n    clearProgram.bind();\n\n    var texUnit = 0;\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, burns[0]);\n    gl.uniform1i(clearProgram.uniforms.uWind, texUnit++);\n\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, pressure.read[0]);\n    gl.uniform1i(clearProgram.uniforms.uTexture, texUnit++);\n\n    let pressureTexId = texUnit - 1;\n\n    // let pressureTexId = pressure.read[2];\n    // gl.activeTexture(gl.TEXTURE0 + pressureTexId);\n    // gl.bindTexture(gl.TEXTURE_2D, pressure.read[0]);\n\n    // gl.uniform1i(clearProgram.uniforms.uWind, burns[2]);\n    // gl.uniform1i(clearProgram.uniforms.uTexture, pressureTexId);\n    gl.uniform1f(clearProgram.uniforms.value, config.PRESSURE_DISSIPATION);\n\n    blit(pressure.write[1]);\n    pressure.swap();\n\n    // PRESSURE\n    // divergence\n    // pressureRead->\n    // pressureWrite\n    pressureProgram.bind();\n    //TODO\n    var texUnit = 0;\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, divergence[0]);\n    gl.uniform1i(pressureProgram.uniforms.uDivergence, texUnit++);\n\n    // gl.activeTexture(gl.TEXTURE0 + texUnit);\n    // gl.bindTexture(gl.TEXTURE_2D, pressure.read[0]);\n    // gl.uniform1i(clearProgram.uniforms.uTexture, texUnit++);\n\n    gl.uniform2f(\n      pressureProgram.uniforms.texelSize,\n      1.0 / texWidth,\n      1.0 / texHeight\n    );\n    // gl.uniform1i(pressureProgram.uniforms.uDivergence, divergence[2]);\n    pressureTexId = pressure.read[2];\n    gl.uniform1i(pressureProgram.uniforms.uPressure, pressureTexId);\n    gl.activeTexture(gl.TEXTURE0 + pressureTexId);\n    for (let i = 0; i < config.PRESSURE_ITERATIONS; i++) {\n      gl.bindTexture(gl.TEXTURE_2D, pressure.read[0]);\n      blit(pressure.write[1]);\n      pressure.swap();\n    }\n\n    // VELOCITY OUT\n    // velocityRead\n    // pressureRead ->\n    // velocityOut\n    velocityOutProgram.bind();\n\n    var texUnit = 0;\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, velocity.read[0]);\n    gl.uniform1i(velocityOutProgram.uniforms.uTexture, texUnit++);\n\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, pressure.read[0]);\n    gl.uniform1i(velocityOutProgram.uniforms.uPressure, texUnit++);\n\n    // gl.uniform1i(velocityOutProgram.uniforms.uTexture, velocity.read[2]);\n    // gl.uniform1i(velocityOutProgram.uniforms.uPressure, pressure.read[2]);\n    blit(velocityOut[1]);\n    if (!isWebGL2 || isIOS) {\n      gl.readPixels(0, 0, width, height, gl.RGBA, gl.UNSIGNED_BYTE, winds);\n    } else if (sync === undefined) {\n      gl.readPixels(0, 0, width, height, gl.RGBA, gl.UNSIGNED_BYTE, 0);\n      sync = gl.fenceSync(gl.SYNC_GPU_COMMANDS_COMPLETE, 0);\n    } else {\n      const status = gl.clientWaitSync(sync, 0, 0);\n\n      if (status === gl.ALREADY_SIGNALED || status === gl.CONDITION_SATISFIED) {\n        gl.getBufferSubData(gl.PIXEL_PACK_BUFFER, 0, winds);\n        gl.readPixels(0, 0, width, height, gl.RGBA, gl.UNSIGNED_BYTE, 0);\n        sync = gl.fenceSync(gl.SYNC_GPU_COMMANDS_COMPLETE, 0);\n      }\n    }\n\n    // GRADIENT SUBTRACT\n    // burns\n    // pressureRead\n    // velocityRead\n    // sands ->\n    // velocityWrite\n    gradientSubtractProgram.bind();\n\n    var texUnit = 0;\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, burns[0]);\n    gl.uniform1i(gradientSubtractProgram.uniforms.uWind, texUnit++);\n\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, pressure.read[0]);\n    gl.uniform1i(gradientSubtractProgram.uniforms.uPressure, texUnit++);\n\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, velocity.read[0]);\n    gl.uniform1i(gradientSubtractProgram.uniforms.uVelocity, texUnit++);\n\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, cells[0]);\n    gl.uniform1i(gradientSubtractProgram.uniforms.uCells, texUnit++);\n\n    gl.uniform2f(\n      gradientSubtractProgram.uniforms.texelSize,\n      1.0 / texWidth,\n      1.0 / texHeight\n    );\n\n    // gl.uniform1i(gradientSubtractProgram.uniforms.uWind, burns[2]);\n    // gl.uniform1i(gradientSubtractProgram.uniforms.uPressure, pressure.read[2]);\n    // gl.uniform1i(gradientSubtractProgram.uniforms.uVelocity, velocity.read[2]);\n    blit(velocity.write[1]);\n    velocity.swap();\n\n    gl.viewport(0, 0, gl.drawingBufferWidth, gl.drawingBufferHeight);\n\n    // DISPLAY\n    // density ->\n    // null/renderbuffer?\n    displayProgram.bind();\n\n    var texUnit = 0;\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, density.read[0]);\n    gl.uniform1i(displayProgram.uniforms.uTexture, texUnit++);\n\n    // gl.uniform1i(displayProgram.uniforms.uTexture, density.read[2]);\n\n    blit(null);\n  }\n\n  function splat(x, y, dx, dy, color) {\n    splatProgram.bind();\n\n    var texUnit = 0;\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, velocity.read[0]);\n    gl.uniform1i(splatProgram.uniforms.uTarget, texUnit++);\n\n    // gl.uniform1i(splatProgram.uniforms.uTarget, velocity.read[2]);\n    gl.uniform1f(\n      splatProgram.uniforms.aspectRatio,\n      canvas.width / canvas.height\n    );\n    gl.uniform2f(\n      splatProgram.uniforms.point,\n      y / canvas.height,\n      x / canvas.width\n    );\n    gl.uniform3f(splatProgram.uniforms.color, dy, dx, 1.0);\n    gl.uniform1f(\n      splatProgram.uniforms.radius,\n      (window.UI.state.size + 1) / 600\n    );\n    blit(velocity.write[1]);\n    velocity.swap();\n\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, density.read[0]);\n    gl.uniform1i(splatProgram.uniforms.uTarget, texUnit++);\n\n    // gl.uniform1i(splatProgram.uniforms.uTarget, density.read[2]);\n    gl.uniform3f(splatProgram.uniforms.color, color[0], color[1], color[2]);\n    blit(density.write[1]);\n    density.swap();\n  }\n\n  function multipleSplats(amount) {\n    for (let i = 0; i < amount; i++) {\n      const color = fluidColor;\n      const x = canvas.width * Math.random();\n      const y = canvas.height * Math.random();\n      const dx = 1000 * (Math.random() - 0.5);\n      const dy = 1000 * (Math.random() - 0.5);\n      splat(x, y, dx, dy, color);\n    }\n  }\n\n  let boundingRect;\n  let scaleX;\n  let scaleY;\n\n  let resize = () => {\n    boundingRect = sandCanvas.getBoundingClientRect();\n    scaleX =\n      sandCanvas.width /\n      Math.ceil(window.devicePixelRatio) /\n      boundingRect.width;\n    scaleY =\n      sandCanvas.height /\n      Math.ceil(window.devicePixelRatio) /\n      boundingRect.height;\n  };\n  resize();\n  window.addEventListener(\"resize\", resize);\n  window.addEventListener(\"deviceorientation\", resize, true);\n\n  sandCanvas.addEventListener(\"mousemove\", (e) => {\n    const canvasLeft = (e.clientX - boundingRect.left) * scaleX;\n    const canvasTop = (e.clientY - boundingRect.top) * scaleY;\n    pointers[0].moved = pointers[0].down;\n    pointers[0].dx = (canvasLeft - pointers[0].x) * 10.0;\n    pointers[0].dy = (canvasTop - pointers[0].y) * 10.0;\n    pointers[0].x = canvasLeft;\n    pointers[0].y = canvasTop;\n  });\n\n  sandCanvas.addEventListener(\n    \"touchmove\",\n    (e) => {\n      if (!window.paused) {\n        if (e.cancelable) {\n          e.preventDefault();\n        }\n      }\n      const touches = e.targetTouches;\n      for (let i = 0; i < touches.length; i++) {\n        let pointer = pointers[i];\n        pointer.moved = pointer.down;\n\n        const canvasLeft = (touches[i].clientX - boundingRect.left) * scaleX;\n        const canvasTop = (touches[i].clientY - boundingRect.top) * scaleY;\n\n        pointer.dx = (canvasLeft - pointer.x) * 10.0;\n        pointer.dy = (canvasTop - pointer.y) * 10.0;\n        pointer.x = canvasLeft;\n        pointer.y = canvasTop;\n      }\n    },\n    false\n  );\n\n  sandCanvas.addEventListener(\"mousedown\", () => {\n    pointers[0].down = true;\n    pointers[0].color = fluidColor;\n  });\n\n  sandCanvas.addEventListener(\"touchstart\", (e) => {\n    if (e.cancelable) {\n      e.preventDefault();\n    }\n    const touches = e.targetTouches;\n    for (let i = 0; i < touches.length; i++) {\n      if (i >= pointers.length) pointers.push(new pointerPrototype());\n\n      const canvasLeft = (touches[i].clientX - boundingRect.left) * scaleX;\n      const canvasTop = (touches[i].clientY - boundingRect.top) * scaleY;\n\n      pointers[i].id = touches[i].identifier;\n      pointers[i].down = true;\n      pointers[i].x = canvasLeft;\n      pointers[i].y = canvasTop;\n      pointers[i].color = fluidColor;\n    }\n  });\n\n  window.addEventListener(\"mouseup\", () => {\n    pointers[0].down = false;\n  });\n\n  window.addEventListener(\"touchend\", (e) => {\n    const touches = e.changedTouches;\n    for (let i = 0; i < touches.length; i++)\n      for (let j = 0; j < pointers.length; j++)\n        if (touches[i].identifier == pointers[j].id) pointers[j].down = false;\n  });\n\n  return { update, reset };\n}\n\nexport { startFluid };\n","import { Universe, Species } from \"../crate/pkg\";\nimport { startWebGL } from \"./render\";\nimport { startFluid } from \"./fluid\";\n\nconst canvas = document.getElementById(\"sand-canvas\");\n\nfunction setup() {\n  let n = 300;\n  let h = n / 2.0;\n  let d = n * 0.9;\n  let universe = Universe.new(n, n);\n  universe.paint(10, 10, 10, Species.Sand);\n\n  universe.paint(h, h, d + 2, Species.Plant);\n  universe.paint(30, n - 10, 15, Species.Fire);\n  universe.paint(h - 30, n - 10, 15, Species.Fire);\n  universe.paint(h, h, n / 3, Species.Air);\n  universe.paint(h, h, n / 3, Species.Fire);\n\n  let fluid = startFluid({ universe });\n  let render = startWebGL({ canvas, universe });\n  window.f = fluid;\n  window.u = universe;\n  window.r = render;\n\n  return { universe, fluid, render };\n}\n\nfunction trial(m,{ universe, fluid, render }  ) {\n\n  const t0 = performance.now();\n  let cpuTime = 0;\n  let fluidTime = 0;\n  universe.push_undo();\n  for (let i = 0; i < m; i++) {\n    const tcpu0 = performance.now();\n    universe.tick();\n    const tcpu1 = performance.now();\n    cpuTime += tcpu1 - tcpu0;\n\n    fluid.update();\n    const tFluid = performance.now();\n    fluidTime += tFluid - tcpu1;\n\n    render();\n  }\n  const t1 = performance.now();\n  universe.pop_undo();\n\n  let delta = t1 - t0;\n  return [delta, cpuTime, fluidTime];\n}\nfunction runTest(n, m, log) {\n  let min = Infinity;\n  let max = 0;\n  let sum = 0;\n  let cpuSum = 0;\n  let cpuMin = Infinity;\n  let cpuMax = 0;\n  let fluidSum = 0;\n  let fluidMin = Infinity;\n  let fluidMax = 0;\n  log(`Running ${n} trials of ${m} reps`);\n  let world = setup();\n  for (let i = 0; i < n; i++) {\n    let [delta, cpuTime, fluidTime] = trial(m, world);\n    min = Math.min(delta, min);\n    max = Math.max(delta, max);\n    sum += delta;\n\n    cpuMin = Math.min(cpuTime, cpuMin);\n    cpuMax = Math.max(cpuTime, cpuMax);\n    cpuSum += cpuTime / n;\n\n    fluidMin = Math.min(fluidTime, fluidMin);\n    fluidMax = Math.max(fluidTime, fluidMax);\n    fluidSum += fluidTime / n;\n\n    let trialResult = ` t${i} ${(delta / m).toPrecision(3)}ms      ${(\n      cpuTime / m\n    ).toPrecision(3)}ms cpu  ${(fluidTime / m).toPrecision(3)}ms fluid `;\n    log(trialResult);\n  }\n  let avg = sum / n;\n  let dev = (max - min) / 2;\n  let cDev = (cpuMax - cpuMin) / 2;\n  let fDev = (fluidMax - fluidMin) / 2;\n  let resultString = `avg:${(avg / m).toPrecision(3)}${(dev / m).toPrecision(\n    2\n  )}ms ${(cpuSum / m).toPrecision(3)}${(cDev / m).toPrecision(2)}ms ${(\n    fluidSum / m\n  ).toPrecision(3)}${(fDev / m).toPrecision(2)}ms\n  `;\n  log(resultString);\n}\nfunction runBenchmark(addLogLine) {\n  window.paused = true;\n  console.log(\"running test\");\n  return runTest(50, 20, (line) => {\n    console.log(line);\n    addLogLine(line);\n  });\n}\nexport { runBenchmark };\n","import React from \"react\";\nimport { runBenchmark } from \"../benchmark\";\n\nclass BenchmarkRunner extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = { lines: [\"TESTING:\"], show: true };\n  }\n  componentDidMount() {\n    this.run();\n  }\n  run() {\n    runBenchmark((newline) =>\n      this.setState(({ lines }) => {\n        return {\n          lines: [...lines, newline],\n        };\n      })\n    );\n  }\n\n  render() {\n    let { lines, show } = this.state;\n\n    if (!show) {\n      return null;\n    }\n    return (\n      <div className=\"benchmark\">\n        <pre>{lines.join(\"\\n\")}</pre>\n        <span>\n          <button\n            onClick={() => {\n              this.run();\n            }}\n          >\n            {\" \"}\n            re-run\n          </button>\n          {\"    \"}\n          <button onClick={() => this.setState({ show: false })}> close</button>\n        </span>\n      </div>\n    );\n  }\n}\nexport default BenchmarkRunner;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { BrowserRouter as Router, Route, Link } from \"react-router-dom\";\n\nimport Info from \"./components/info\";\nimport { Index } from \"./components/ui\";\nimport Browse from \"./components/browse\";\nimport Admin from \"./components/admin\";\nimport Menu from \"./components/menu\";\nimport SignInScreen from \"./components/signin\";\nimport BenchmarkRunner from \"./components/benchmarkRunner\";\n\nlet sizeMap = [2, 5, 10, 18, 30, 45];\n\nfunction BrowseRouter({ match, location }) {\n  return (\n    <Menu>\n      <Browse location={location} />\n    </Menu>\n  );\n}\n\nfunction AdminRouter({ match, location }) {\n  return (\n    <Menu>\n      <Admin location={location} />\n    </Menu>\n  );\n}\n\nfunction SigninRouter({ match, location }) {\n  return (\n    <Menu>\n      <SignInScreen location={location} />\n    </Menu>\n  );\n}\n\nfunction AppRouter() {\n  return (\n    <Router>\n      <Route path=\"/\" component={Index} />\n      <Route\n        exact\n        path=\"/info/\"\n        component={() => (\n          <Menu>\n            <Info />\n          </Menu>\n        )}\n      />\n      <Route exact path=\"/bench\" component={BenchmarkRunner} />\n      <Route path=\"/browse\" component={BrowseRouter} />\n      <Route path=\"/admin\" component={AdminRouter} />\n      <Route path=\"/login\" component={SigninRouter} />\n      <Route path=\"/__/auth/handler\" component={SigninRouter} />\n    </Router>\n  );\n}\n\nReactDOM.render(<AppRouter />, document.getElementById(\"ui\"));\n\nexport { sizeMap };\n","import * as Sentry from \"@sentry/browser\";\nimport { Integrations } from \"@sentry/tracing\";\nimport { Wasm as WasmIntegration } from \"@sentry/wasm\";\nimport { boot } from \"./boot\";\nif (!window.location.host.startsWith(\"localhost\")) {\n  Sentry.init({\n    dsn: \"https://4bf8c3ab764f40569d573fc4021efe40@o40136.ingest.sentry.io/1331284\",\n\n    // Alternatively, use `process.env.npm_package_version` for a dynamic release version\n    // if your build tool supports it.\n    integrations: [new Integrations.BrowserTracing(), new WasmIntegration()],\n\n    // Set tracesSampleRate to 1.0 to capture 100%\n    // of transactions for performance monitoring.\n    // We recommend adjusting this value in production\n    tracesSampleRate: 0.01,\n  });\n}\n\nimport \"./api\";\nimport { Universe } from \"../crate/pkg\";\n\nimport { startWebGL } from \"./render\";\nimport { fps } from \"./fps\";\nimport {} from \"./paint\";\nimport {} from \"./app\";\nimport { startFluid } from \"./fluid\";\nimport {} from \"./layout\";\n\nconst isBench = window.location.pathname === \"/bench\";\nif (window.safari) {\n  history.pushState(null, null, location.href);\n  window.onpopstate = function (event) {\n    history.go(1);\n  };\n}\n\nfunction mobileAndTabletcheck() {\n  var check = false;\n  (function (a) {\n    if (\n      /(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(\n        a\n      ) ||\n      /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(\n        a.substr(0, 4)\n      )\n    )\n      check = true;\n  })(navigator.userAgent || navigator.vendor || window.opera);\n  return check;\n}\n\nif (mobileAndTabletcheck()) {\n  window.onbeforeunload = function () {\n    return true;\n  };\n}\n\nif (\"serviceWorker\" in navigator) {\n  window.addEventListener(\"load\", () => {\n    navigator.serviceWorker\n      .register(\"/service-worker.js\")\n      .then((registration) => {\n        console.log(\"SW registered: \", registration);\n        fetch(\"index.html\"); // refresh cache (?)\n      })\n      .catch((registrationError) => {\n        console.log(\"SW registration failed: \", registrationError);\n      });\n  });\n}\n\nlet n = 300;\nconst universe = isBench ? window.u : Universe.new(n, n);\n\nlet width = n;\nlet height = n;\nconst canvas = document.getElementById(\"sand-canvas\");\nconst canvas2 = document.getElementById(\"fluid-canvas\");\n\ncanvas.height = n * Math.ceil(window.devicePixelRatio);\ncanvas.width = n * Math.ceil(window.devicePixelRatio);\n\ndocument.getElementById(\"background\").addEventListener(\"touchmove\", (e) => {\n  if (!window.paused) {\n    if (e.cancelable) {\n      e.preventDefault();\n    }\n  }\n});\n\nlet fluid;\nlet drawSand;\nif (!isBench) {\n  fluid = startFluid({ universe });\n  drawSand = startWebGL({ canvas, universe });\n} else {\n  fluid = window.f;\n  drawSand = window.r;\n}\nconst renderLoop = () => {\n  if (!window.paused) {\n    fps.render(); // new\n    universe.tick();\n    fluid.update();\n  }\n  drawSand();\n\n  window.animationId = requestAnimationFrame(renderLoop);\n};\nrenderLoop();\nwindow.u = universe;\n\nif (!isBench) {\n  boot(width, height);\n}\n\nfunction reset() {\n  fluid.reset();\n  fluid.update();\n  fluid.reset();\n  fluid.update();\n\n  universe.reset();\n}\n\ndocument.addEventListener(\"keydown\", function (event) {\n  if ((event.ctrlKey || event.metaKey) && event.key === \"z\") {\n    reset();\n    universe.pop_undo();\n  }\n});\n\ndocument.addEventListener(\"paste\", function (event) {\n  const text = event.clipboardData.getData(\"text/plain\");\n  if (text.includes(\"<svg\")) {\n    event.preventDefault();\n    window.UI.loadSVG(text);\n  }\n});\n\n(adsbygoogle = window.adsbygoogle || []).push({});\nexport { canvas, width, height, universe, reset };\n","module.exports = \"precision highp float;\\nprecision mediump sampler2D;\\n#define GLSLIFY 1\\nattribute vec2 aPosition;\\nvarying vec2 vUv;\\nvarying vec2 vL;\\nvarying vec2 vR;\\nvarying vec2 vT;\\nvarying vec2 vB;\\nuniform vec2 texelSize;\\nvoid main() {\\n  vUv = aPosition * 0.5 + 0.5;\\n  vL = vUv - vec2(texelSize.x, 0.0);\\n  vR = vUv + vec2(texelSize.x, 0.0);\\n  vT = vUv + vec2(0.0, texelSize.y);\\n  vB = vUv - vec2(0.0, texelSize.y);\\n  gl_Position = vec4(aPosition, 0.0, 1.0);\\n}\\n\"","module.exports = \"precision highp float;\\nprecision mediump sampler2D;\\n#define GLSLIFY 1\\nvarying vec2 vUv;\\nuniform sampler2D uTexture;\\nuniform sampler2D uWind;\\nuniform float value;\\nvoid main() {\\n  float pressure = texture2D(uWind, vUv).z;\\n  pressure *= 512.;\\n  pressure *= pressure;\\n  gl_FragColor = value * (texture2D(uTexture, vUv) + vec4(pressure));\\n}\"","module.exports = \"precision highp float;\\nprecision mediump sampler2D;\\n#define GLSLIFY 1\\nvarying vec2 vUv;\\nuniform sampler2D uTexture;\\nvoid main() {\\n  vec3 color = texture2D(uTexture, vec2(1.0 - vUv.y,vUv.x)).rgb * 0.1;\\n  color *= 0.5;\\n  color = min(color, 0.9);\\n  color = vec3(1.0) - color;\\n  color *= vec3(0.95, 0.9, 0.9);\\n  // color *= 0.5;\\n  gl_FragColor = vec4(color, 1.0);\\n}\\n\"","module.exports = \"precision highp float;\\nprecision mediump sampler2D;\\n#define GLSLIFY 1\\nvarying vec2 vUv;\\nuniform sampler2D uTarget;\\nuniform float aspectRatio;\\nuniform vec3 color;\\nuniform vec2 point;\\nuniform float radius;\\nvoid main() {\\n  vec2 p = vUv - point.xy;\\n  p.x *= aspectRatio;\\n  vec3 splat = exp(-dot(p, p) / radius) * color;\\n  vec3 base = texture2D(uTarget, vUv).xyz;\\n  gl_FragColor = vec4(base + splat, 1.0);\\n}\"","module.exports = \"precision highp float;\\nprecision mediump sampler2D;\\n#define GLSLIFY 1\\nvarying vec2 vUv;\\nuniform sampler2D uVelocity;\\nuniform sampler2D uSource;\\nuniform sampler2D uWind;\\nuniform vec2 texelSize;\\nuniform float dt;\\nuniform float dissipation;\\nvec4 bilerp(in sampler2D sam, in vec2 p) {\\n  vec4 st;\\n  st.xy = floor(p - 0.5) + 0.5;\\n  st.zw = st.xy + 1.0;\\n  vec4 uv = st * texelSize.xyxy;\\n  vec4 a = texture2D(sam, uv.xy);\\n  vec4 b = texture2D(sam, uv.zy);\\n  vec4 c = texture2D(sam, uv.xw);\\n  vec4 d = texture2D(sam, uv.zw);\\n  vec2 f = p - st.xy;\\n  return mix(mix(a, b, f.x), mix(c, d, f.x), f.y);\\n}\\nvoid main() {\\n  vec2 coord = gl_FragCoord.xy - dt * texture2D(uVelocity, vUv).xy;\\n  float density = texture2D(uWind, vUv).w;\\n  if (density > 0.99) {\\n    density = 0.;\\n  }\\n  gl_FragColor = dissipation * (bilerp(uSource, coord) + vec4(density));\\n  gl_FragColor.a = 1.0;\\n}\"","module.exports = \"\\nprecision highp float;\\nprecision mediump sampler2D;\\n#define GLSLIFY 1\\nvarying vec2 vUv;\\nuniform sampler2D uVelocity;\\nuniform sampler2D uSource;\\nuniform sampler2D uWind;\\nuniform vec2 texelSize;\\nuniform float dt;\\nuniform float dissipation;\\nvoid main() {\\n  vec2 coord = vUv - dt * texture2D(uVelocity, vUv).xy * texelSize;\\n  float density = texture2D(uWind, vUv).w * 1.;\\n  if (density > 0.99) {\\n    density = 0.;\\n  }\\n\\n  gl_FragColor = dissipation * (texture2D(uSource, coord) + vec4(density));\\n  gl_FragColor.a = 1.0;\\n}\\n\"","module.exports = \"precision highp float;\\nprecision mediump sampler2D;\\n#define GLSLIFY 1\\nvarying vec2 vUv;\\nvarying vec2 vL;\\nvarying vec2 vR;\\nvarying vec2 vT;\\nvarying vec2 vB;\\nuniform sampler2D uVelocity;\\nvec2 sampleVelocity(in vec2 uv) {\\n  vec2 multiplier = vec2(1.0, 1.0);\\n  if (uv.x < 0.0) {\\n    uv.x = 0.0;\\n    multiplier.x = -1.0;\\n  }\\n  if (uv.x > 1.0) {\\n    uv.x = 1.0;\\n    multiplier.x = -1.0;\\n  }\\n  if (uv.y < 0.0) {\\n    uv.y = 0.0;\\n    multiplier.y = -1.0;\\n  }\\n  if (uv.y > 1.0) {\\n    uv.y = 1.0;\\n    multiplier.y = -1.0;\\n  }\\n  return multiplier * texture2D(uVelocity, uv).xy;\\n}\\nvoid main() {\\n  float L = sampleVelocity(vL).x;\\n  float R = sampleVelocity(vR).x;\\n  float T = sampleVelocity(vT).y;\\n  float B = sampleVelocity(vB).y;\\n  float div = 0.5 * (R - L + T - B);\\n  gl_FragColor = vec4(div, 0.0, 0.0, 1.0);\\n}\\n\"","module.exports = \"precision highp float;\\nprecision mediump sampler2D;\\n#define GLSLIFY 1\\nvarying vec2 vUv;\\nvarying vec2 vL;\\nvarying vec2 vR;\\nvarying vec2 vT;\\nvarying vec2 vB;\\nuniform sampler2D uVelocity;\\nvoid main() {\\n  float L = texture2D(uVelocity, vL).y;\\n  float R = texture2D(uVelocity, vR).y;\\n  float T = texture2D(uVelocity, vT).x;\\n  float B = texture2D(uVelocity, vB).x;\\n  float vorticity = R - L - T + B;\\n  gl_FragColor = vec4(vorticity, 0.0, 0.0, 1.0);\\n}\"","module.exports = \"precision highp float;\\nprecision mediump sampler2D;\\n#define GLSLIFY 1\\nvarying vec2 vUv;\\nvarying vec2 vT;\\nvarying vec2 vB;\\nuniform sampler2D uVelocity;\\nuniform sampler2D uCurl;\\nuniform float curl;\\nuniform float dt;\\nvoid main() {\\n  float T = texture2D(uCurl, vT).x;\\n  float B = texture2D(uCurl, vB).x;\\n  float C = texture2D(uCurl, vUv).x;\\n  vec2 force = vec2(abs(T) - abs(B), 0.0);\\n  force *= 1.0 / length(force + 0.00001) * curl * C;\\n  vec2 vel = texture2D(uVelocity, vUv).xy;\\n  gl_FragColor = vec4(vel + force * dt, 0.0, 1.0);\\n}\"","module.exports = \"precision highp float;\\nprecision mediump sampler2D;\\n#define GLSLIFY 1\\nvarying vec2 vUv;\\nvarying vec2 vL;\\nvarying vec2 vR;\\nvarying vec2 vT;\\nvarying vec2 vB;\\nuniform sampler2D uPressure;\\nuniform sampler2D uDivergence;\\nvec2 boundary(in vec2 uv) {\\n  uv = min(max(uv, 0.0), 1.0);\\n  return uv;\\n}\\nvoid main() {\\n  float L = texture2D(uPressure, boundary(vL)).x;\\n  float R = texture2D(uPressure, boundary(vR)).x;\\n  float T = texture2D(uPressure, boundary(vT)).x;\\n  float B = texture2D(uPressure, boundary(vB)).x;\\n  float C = texture2D(uPressure, vUv).x;\\n  float divergence = texture2D(uDivergence, vUv).x;\\n  float pressure = (L + R + B + T - divergence) * 0.25;\\n  gl_FragColor = vec4(pressure, 0.0, 0.0, 1.0);\\n}\"","module.exports = \"precision highp float;\\nprecision mediump sampler2D;\\n#define GLSLIFY 1\\nvarying vec2 vUv;\\nvarying vec2 vL;\\nvarying vec2 vR;\\nvarying vec2 vT;\\nvarying vec2 vB;\\nuniform sampler2D uPressure;\\nuniform sampler2D uVelocity;\\nuniform sampler2D uWind;\\nuniform sampler2D uCells;\\n\\nvec2 boundary(in vec2 uv) {\\n  uv = min(max(uv, 0.0), 1.0);\\n  return uv;\\n}\\nvoid main() {\\n  float L = texture2D(uPressure, boundary(vL)).x;\\n  float R = texture2D(uPressure, boundary(vR)).x;\\n  float T = texture2D(uPressure, boundary(vT)).x;\\n  float B = texture2D(uPressure, boundary(vB)).x;\\n  vec2 velocity = texture2D(uVelocity, vUv).xy;\\n  vec2 wind = texture2D(uWind, vUv).xy;\\n  vec2 cell = texture2D(uCells, vUv).xy;\\n  velocity.xy -= vec2(R - L, T - B);\\n  velocity.yx += wind * -25.; // hack, probably wrong for X\\n\\n  int type = int((cell.r * 255.) + 0.1);\\n\\n  // || type == 7 || type == 9\\n  if (type == 1 || type == 5) {\\n    velocity = vec2(0.);\\n  }\\n  if (type == 0 || type == 4 || type == 6) {\\n\\n  } else {\\n    velocity = velocity * 0.95;\\n  }\\n  // velocity = cell.rg * 100.;\\n  gl_FragColor = vec4(velocity, 0.0, 1.0);\\n}\"","module.exports = \"precision highp float;\\nprecision mediump sampler2D;\\n#define GLSLIFY 1\\nvarying vec2 vUv;\\nuniform sampler2D uTexture;\\nuniform sampler2D uPressure;\\nvoid main() {\\n  vec2 v = texture2D(uTexture, vUv).rg;\\n  float p = texture2D(uPressure, vUv).r;\\n  vec3 vp = vec3(v, p);\\n  vp = max(vp, vec3(-250.));\\n  vp = min(vp, vec3(250.));\\n  vp /= 500.;\\n  vp += vec3(0.5, 0.5, 0.);\\n  // v = vec2(0.5);\\n  gl_FragColor = vec4(vp, 0.0);\\n}\\n\"","const canvas = document.getElementById(\"sand-canvas\");\nconst canvas2 = document.getElementById(\"fluid-canvas\");\nconst ui = document.getElementById(\"ui\");\n\nlet resize = () => {\n  let screen_width = window.innerWidth;\n  let uiheight = 50;\n  let screen_height = window.innerHeight - uiheight;\n\n  let canvasStyle = \"\";\n  let uiStyle = \"\";\n  let adStyle = \"display:none;\";\n\n  if (screen_width > screen_height) {\n    if (screen_width - window.innerHeight < 400) {\n      // landscape compressed\n      canvasStyle = `height: ${window.innerHeight}px; margin:3px`;\n      uiStyle = `width: ${\n        screen_width - window.innerHeight - 12\n      }px; margin: 2px;`;\n    } else {\n      // landscape wide\n      canvasStyle = `\n       height: ${window.innerHeight}px;\n       width:${window.innerHeight}px;\n       margin:0;\n       left: auto;\n       right: 206px`;\n      uiStyle = `width: 200px; margin: 2px;`;\n      adStyle = `width: ${\n        screen_width - window.innerHeight - (206 + 150)\n      }px; margin: 1px;`;\n    }\n  } else {\n    //portrait (mobile)\n    canvasStyle = `width: ${screen_width}px; bottom:3px;`;\n    uiStyle = \"\";\n  }\n  ui.style = uiStyle;\n  canvas.style = canvasStyle;\n  canvas2.style = canvasStyle;\n  document.getElementsByClassName(\"adslot_1\")[0].style = adStyle;\n  let btnHeight = ui.getBoundingClientRect().height;\n  document.getElementById(\"PullTab\").style.top = btnHeight + \"px\";\n};\n\nresize();\nwindow.addEventListener(\"deviceorientation\", resize, true);\nwindow.addEventListener(\"resize\", resize);\n","import * as wasm from './sandtable_bg.wasm';\n\nconst lTextDecoder = typeof TextDecoder === 'undefined' ? (0, module.require)('util').TextDecoder : TextDecoder;\n\nlet cachedTextDecoder = new lTextDecoder('utf-8', { ignoreBOM: true, fatal: true });\n\ncachedTextDecoder.decode();\n\nlet cachegetUint8Memory0 = null;\nfunction getUint8Memory0() {\n    if (cachegetUint8Memory0 === null || cachegetUint8Memory0.buffer !== wasm.memory.buffer) {\n        cachegetUint8Memory0 = new Uint8Array(wasm.memory.buffer);\n    }\n    return cachegetUint8Memory0;\n}\n\nfunction getStringFromWasm0(ptr, len) {\n    return cachedTextDecoder.decode(getUint8Memory0().subarray(ptr, ptr + len));\n}\n\nfunction notDefined(what) { return () => { throw new Error(`${what} is not defined`); }; }\n/**\n*/\nexport const Species = Object.freeze({ Empty:0,\"0\":\"Empty\",Wall:1,\"1\":\"Wall\",Sand:2,\"2\":\"Sand\",Water:3,\"3\":\"Water\",Stone:13,\"13\":\"Stone\",Ice:9,\"9\":\"Ice\",Gas:4,\"4\":\"Gas\",Cloner:5,\"5\":\"Cloner\",Mite:15,\"15\":\"Mite\",Wood:7,\"7\":\"Wood\",Plant:11,\"11\":\"Plant\",Fungus:18,\"18\":\"Fungus\",Seed:19,\"19\":\"Seed\",Fire:6,\"6\":\"Fire\",Lava:8,\"8\":\"Lava\",Acid:12,\"12\":\"Acid\",Dust:14,\"14\":\"Dust\",Oil:16,\"16\":\"Oil\",Rocket:17,\"17\":\"Rocket\", });\n/**\n*/\nexport class Cell {\n\n    __destroy_into_raw() {\n        const ptr = this.ptr;\n        this.ptr = 0;\n\n        return ptr;\n    }\n\n    free() {\n        const ptr = this.__destroy_into_raw();\n        wasm.__wbg_cell_free(ptr);\n    }\n}\n/**\n*/\nexport class Universe {\n\n    static __wrap(ptr) {\n        const obj = Object.create(Universe.prototype);\n        obj.ptr = ptr;\n\n        return obj;\n    }\n\n    __destroy_into_raw() {\n        const ptr = this.ptr;\n        this.ptr = 0;\n\n        return ptr;\n    }\n\n    free() {\n        const ptr = this.__destroy_into_raw();\n        wasm.__wbg_universe_free(ptr);\n    }\n    /**\n    */\n    reset() {\n        wasm.universe_reset(this.ptr);\n    }\n    /**\n    */\n    tick() {\n        wasm.universe_tick(this.ptr);\n    }\n    /**\n    * @returns {number}\n    */\n    width() {\n        const ret = wasm.universe_width(this.ptr);\n        return ret;\n    }\n    /**\n    * @returns {number}\n    */\n    height() {\n        const ret = wasm.universe_height(this.ptr);\n        return ret;\n    }\n    /**\n    * @returns {number}\n    */\n    cells() {\n        const ret = wasm.universe_cells(this.ptr);\n        return ret;\n    }\n    /**\n    * @returns {number}\n    */\n    winds() {\n        const ret = wasm.universe_winds(this.ptr);\n        return ret;\n    }\n    /**\n    * @returns {number}\n    */\n    burns() {\n        const ret = wasm.universe_burns(this.ptr);\n        return ret;\n    }\n    /**\n    * @param {number} x\n    * @param {number} y\n    * @param {number} size\n    * @param {number} species\n    */\n    paint(x, y, size, species) {\n        wasm.universe_paint(this.ptr, x, y, size, species);\n    }\n    /**\n    */\n    push_undo() {\n        wasm.universe_push_undo(this.ptr);\n    }\n    /**\n    */\n    pop_undo() {\n        wasm.universe_pop_undo(this.ptr);\n    }\n    /**\n    */\n    flush_undos() {\n        wasm.universe_flush_undos(this.ptr);\n    }\n    /**\n    * @param {number} width\n    * @param {number} height\n    * @returns {Universe}\n    */\n    static new(width, height) {\n        const ret = wasm.universe_new(width, height);\n        return Universe.__wrap(ret);\n    }\n}\n/**\n*/\nexport class Wind {\n\n    __destroy_into_raw() {\n        const ptr = this.ptr;\n        this.ptr = 0;\n\n        return ptr;\n    }\n\n    free() {\n        const ptr = this.__destroy_into_raw();\n        wasm.__wbg_wind_free(ptr);\n    }\n}\n\nexport const __wbg_random_ca8b31dc0375c2d4 = typeof Math.random == 'function' ? Math.random : notDefined('Math.random');\n\nexport function __wbindgen_throw(arg0, arg1) {\n    throw new Error(getStringFromWasm0(arg0, arg1));\n};\n\n","module.exports = \"precision highp float;\\n#define GLSLIFY 1\\nuniform float t;\\nuniform float dpi;\\nuniform vec2 resolution;\\nuniform bool isSnapshot;\\nuniform sampler2D backBuffer;\\nuniform sampler2D data;\\n\\nvarying vec2 uv;\\n\\n// clang-format off\\nvec3 hsv2rgb_4_0(vec3 c) {\\n  vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\\n  vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\\n  return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\\n}\\n\\n\\n\\n//\\n// Description : Array and textureless GLSL 2D/3D/4D simplex\\n//               noise functions.\\n//      Author : Ian McEwan, Ashima Arts.\\n//  Maintainer : ijm\\n//     Lastmod : 20110822 (ijm)\\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\\n//               Distributed under the MIT License. See LICENSE file.\\n//               https://github.com/ashima/webgl-noise\\n//\\n\\nvec3 mod289_1_1(vec3 x) {\\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\\n}\\n\\nvec4 mod289_1_1(vec4 x) {\\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\\n}\\n\\nvec4 permute_1_2(vec4 x) {\\n     return mod289_1_1(((x*34.0)+1.0)*x);\\n}\\n\\nvec4 taylorInvSqrt_1_3(vec4 r)\\n{\\n  return 1.79284291400159 - 0.85373472095314 * r;\\n}\\n\\nfloat snoise_1_4(vec3 v)\\n  {\\n  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\\n  const vec4  D_1_5 = vec4(0.0, 0.5, 1.0, 2.0);\\n\\n// First corner\\n  vec3 i  = floor(v + dot(v, C.yyy) );\\n  vec3 x0 =   v - i + dot(i, C.xxx) ;\\n\\n// Other corners\\n  vec3 g_1_6 = step(x0.yzx, x0.xyz);\\n  vec3 l = 1.0 - g_1_6;\\n  vec3 i1 = min( g_1_6.xyz, l.zxy );\\n  vec3 i2 = max( g_1_6.xyz, l.zxy );\\n\\n  //   x0 = x0 - 0.0 + 0.0 * C.xxx;\\n  //   x1 = x0 - i1  + 1.0 * C.xxx;\\n  //   x2 = x0 - i2  + 2.0 * C.xxx;\\n  //   x3 = x0 - 1.0 + 3.0 * C.xxx;\\n  vec3 x1 = x0 - i1 + C.xxx;\\n  vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\\n  vec3 x3 = x0 - D_1_5.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y\\n\\n// Permutations\\n  i = mod289_1_1(i);\\n  vec4 p = permute_1_2( permute_1_2( permute_1_2(\\n             i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\\n           + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))\\n           + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\\n\\n// Gradients: 7x7 points over a square, mapped onto an octahedron.\\n// The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)\\n  float n_ = 0.142857142857; // 1.0/7.0\\n  vec3  ns = n_ * D_1_5.wyz - D_1_5.xzx;\\n\\n  vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)\\n\\n  vec4 x_ = floor(j * ns.z);\\n  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\\n\\n  vec4 x = x_ *ns.x + ns.yyyy;\\n  vec4 y = y_ *ns.x + ns.yyyy;\\n  vec4 h = 1.0 - abs(x) - abs(y);\\n\\n  vec4 b0 = vec4( x.xy, y.xy );\\n  vec4 b1 = vec4( x.zw, y.zw );\\n\\n  //vec4 s0 = vec4(lessThan(b0,0.0))*2.0 - 1.0;\\n  //vec4 s1 = vec4(lessThan(b1,0.0))*2.0 - 1.0;\\n  vec4 s0 = floor(b0)*2.0 + 1.0;\\n  vec4 s1 = floor(b1)*2.0 + 1.0;\\n  vec4 sh = -step(h, vec4(0.0));\\n\\n  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\\n  vec4 a1_1_7 = b1.xzyw + s1.xzyw*sh.zzww ;\\n\\n  vec3 p0_1_8 = vec3(a0.xy,h.x);\\n  vec3 p1 = vec3(a0.zw,h.y);\\n  vec3 p2 = vec3(a1_1_7.xy,h.z);\\n  vec3 p3 = vec3(a1_1_7.zw,h.w);\\n\\n//Normalise gradients\\n  vec4 norm = taylorInvSqrt_1_3(vec4(dot(p0_1_8,p0_1_8), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\\n  p0_1_8 *= norm.x;\\n  p1 *= norm.y;\\n  p2 *= norm.z;\\n  p3 *= norm.w;\\n\\n// Mix final noise value\\n  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\\n  m = m * m;\\n  return 42.0 * dot( m*m, vec4( dot(p0_1_8,x0), dot(p1,x1),\\n                                dot(p2,x2), dot(p3,x3) ) );\\n  }\\n\\n\\n\\n//\\n// Description : Array and textureless GLSL 2D simplex noise function.\\n//      Author : Ian McEwan, Ashima Arts.\\n//  Maintainer : ijm\\n//     Lastmod : 20110822 (ijm)\\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\\n//               Distributed under the MIT License. See LICENSE file.\\n//               https://github.com/ashima/webgl-noise\\n//\\n\\nvec3 mod289_2_9(vec3 x) {\\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\\n}\\n\\nvec2 mod289_2_9(vec2 x) {\\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\\n}\\n\\nvec3 permute_2_10(vec3 x) {\\n  return mod289_2_9(((x*34.0)+1.0)*x);\\n}\\n\\nfloat snoise_2_11(vec2 v)\\n  {\\n  const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0\\n                      0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)\\n                     -0.577350269189626,  // -1.0 + 2.0 * C.x\\n                      0.024390243902439); // 1.0 / 41.0\\n// First corner\\n  vec2 i  = floor(v + dot(v, C.yy) );\\n  vec2 x0 = v -   i + dot(i, C.xx);\\n\\n// Other corners\\n  vec2 i1;\\n  //i1.x = step( x0.y, x0.x ); // x0.x > x0.y ? 1.0 : 0.0\\n  //i1.y = 1.0 - i1.x;\\n  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\\n  // x0 = x0 - 0.0 + 0.0 * C.xx ;\\n  // x1 = x0 - i1 + 1.0 * C.xx ;\\n  // x2 = x0 - 1.0 + 2.0 * C.xx ;\\n  vec4 x12 = x0.xyxy + C.xxzz;\\n  x12.xy -= i1;\\n\\n// Permutations\\n  i = mod289_2_9(i); // Avoid truncation effects in permutation\\n  vec3 p = permute_2_10( permute_2_10( i.y + vec3(0.0, i1.y, 1.0 ))\\n    + i.x + vec3(0.0, i1.x, 1.0 ));\\n\\n  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);\\n  m = m*m ;\\n  m = m*m ;\\n\\n// Gradients: 41 points uniformly over a line, mapped onto a diamond.\\n// The ring size 17*17 = 289 is close to a multiple of 41 (41*7 = 287)\\n\\n  vec3 x = 2.0 * fract(p * C.www) - 1.0;\\n  vec3 h = abs(x) - 0.5;\\n  vec3 ox = floor(x + 0.5);\\n  vec3 a0 = x - ox;\\n\\n// Normalise gradients implicitly by scaling m\\n// Approximation of: m *= inversesqrt( a0*a0 + h*h );\\n  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\\n\\n// Compute final noise value at P\\n  vec3 g;\\n  g.x  = a0.x  * x0.x  + h.x  * x0.y;\\n  g.yz = a0.yz * x12.xz + h.yz * x12.yw;\\n  return 130.0 * dot(m, g);\\n}\\n\\n\\n\\nhighp float random_3_12(vec2 co)\\n{\\n    highp float a = 12.9898;\\n    highp float b = 78.233;\\n    highp float c = 43758.5453;\\n    highp float dt= dot(co.xy ,vec2(a,b));\\n    highp float sn= mod(dt,3.14);\\n    return fract(sin(sn) * c);\\n}\\n\\n\\n\\n// clang-format on\\n\\nvoid main() {\\n  vec3 color;\\n  //   float r = abs(sin(t / 25.));\\n  //   if (length(uv) < r && length(uv) > r - 0.1) {\\n  // color = hsv2rgb(vec3(sin(t * 0.01), 0.5, 0.5));\\n\\n  vec2 textCoord = ((uv * vec2(0.5, -0.5)) + vec2(0.5)).yx;\\n  // vec3 bb = texture2D(backBuffer, (uv * 0.5) + vec2(0.5)).rgb;\\n\\n  vec4 data = texture2D(data, textCoord);\\n  int type = int((data.r * 255.) + 0.1);\\n  float hue = 0.0;\\n  float saturation = 0.6;\\n  float lightness = 0.3 + data.g * 0.5;\\n  float noise = snoise_1_4(vec3(floor(uv * resolution / dpi), t * 0.05));\\n  float a = 1.0;\\n\\n  if (type == 0) {\\n    hue = 0.0;\\n    saturation = 0.1;\\n    lightness = 0.1;\\n    a = 0.1;\\n    if (isSnapshot) {\\n      saturation = 0.05;\\n      lightness = 1.01;\\n      a = 1.0;\\n    }\\n  } else if (type == 1) {\\n    hue = 0.1;\\n    saturation = 0.1;\\n    lightness = 0.4;\\n  } else if (type == 2) {\\n    hue = 0.1;\\n    saturation = 0.5;\\n    lightness += 0.3;\\n  } else if (type == 3) { // water\\n    hue = 0.6;\\n    lightness = 0.7 + data.g * 0.25 + noise * 0.1;\\n    int polarity = int( mod(data.g * 255. ,2.) + 0.1);\\n    if(polarity == 0){\\n      lightness += 0.01;\\n    }\\n\\n  } else if (type == 4) { // gas\\n    hue = 0.0;\\n    lightness += 0.4;\\n    saturation = 0.2 + (data.b * 1.5);\\n  } else if (type == 5) { // clone\\n    hue = 0.9;\\n    saturation = 0.3;\\n  } else if (type == 6) { // fire\\n  \\n    hue = (data.g * 0.1);\\n    saturation = 0.7;\\n\\n    lightness = 0.7 + (data.g * 0.3) + ((noise + 0.8) * 0.5);\\n    if(isSnapshot){\\n      lightness -=0.2;\\n    }\\n  } else if (type == 7) { // wood\\n    hue = (data.g * 0.1);\\n    saturation = 0.3;\\n    lightness = 0.3 + data.g * 0.3;\\n  } else if (type == 8) { // lava\\n    hue = (data.g * 0.1);\\n    lightness = 0.7 + data.g * 0.25 + noise * 0.1;\\n  } else if (type == 9) { // ice\\n    hue = 0.6;\\n    saturation = 0.4;\\n    lightness = 0.7 + data.g * 0.5;\\n  } else if (type == 10) { // sink\\n    hue = 0.9;\\n    saturation = 0.4;\\n    lightness = 1.0;\\n  } else if (type == 11) { // plant\\n    hue = 0.4;\\n    saturation = 0.4;\\n  } else if (type == 12) { // acid\\n    hue = 0.18;\\n    saturation = 0.9;\\n    lightness = 0.8 + data.g * 0.2 + noise * 0.05;\\n  } else if (type == 13) { // stone\\n    hue = -0.4 + (data.g * 0.5);\\n    saturation = 0.1;\\n    // lightness = 0.2 + data.g * 0.5;\\n  } else if (type == 14) { // dust\\n    hue = (data.g * 2.0) + t * .0008;\\n    saturation = 0.4;\\n    lightness = 0.8;\\n  } else if (type == 15) { // mite\\n    hue = 0.8;\\n    saturation = 0.9;\\n    lightness = 0.8;\\n  } else if (type == 16) { // oil\\n    hue = (data.g * 5.0) + t * .008;\\n\\n    saturation = 0.2;\\n    lightness = 0.3;\\n  } else if (type == 17) { // Rocket\\n    hue = 0.0;\\n    saturation = 0.4 + data.b;\\n    lightness = 0.9;\\n  } else if (type == 18) { // fungus\\n    hue = (data.g * 0.15) - 0.1;\\n    saturation = (data.g * 0.8) - 0.05;\\n\\n    // (data.g * 0.00);\\n    lightness = 1.5 - (data.g * 0.2);\\n  } else if (type == 19) { // seed/flower\\n\\n    hue = fract(fract(data.b * 2.) * 0.5) - 0.3;\\n    saturation = 0.7 * (data.g + 0.4) + data.b * 0.2;\\n    lightness = 0.9 * (data.g + 0.9);\\n  }\\n  if (isSnapshot == false) {\\n    lightness *= (0.975 + snoise_2_11(floor(uv * resolution / dpi)) * 0.025);\\n  }\\n  color = hsv2rgb_4_0(vec3(hue, saturation, lightness));\\n  gl_FragColor = vec4(color, a);\\n}\"","module.exports = \"\\n// boring \\\"pass-through\\\" vertex shader\\nprecision mediump float;\\n#define GLSLIFY 1\\nattribute vec2 position;\\nvarying vec2 uv;\\nvoid main() {\\n  uv = position;\\n  gl_Position = vec4(position, 0, 1);\\n}\""],"sourceRoot":""}